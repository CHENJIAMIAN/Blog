import{_ as s,o as n,c as a,O as l}from"./chunks/framework.4afe7240.js";const p="/assets/20230424120853.b76b58d7.png",o="/assets/20230411101658.1d003eed.png",e="/assets/20230419164035.2982d9ec.png",t="/assets/20230409173031.6fe667ff.png",c="/assets/20230411105231.21c82d25.png",r="/assets/20230426092257.bd252934.png",C="/assets/20230426092252.a72a1a95.png",f=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"Cesium.md","filePath":"Cesium.md"}'),y={name:"Cesium.md"},D=l(`<h2 id="资源" tabindex="-1">资源 <a class="header-anchor" href="#资源" aria-label="Permalink to &quot;资源&quot;">​</a></h2><p><a href="https://github.com/stefanciorici/gw3_construkted/blob/master/wp-content/themes/gowatch-child/js/construkted.js" target="_blank" rel="noreferrer">gw3_construkted/construkted.js at master · stefanciorici/gw3_construkted · GitHub</a>泄露了官方的测量/距离/面积/模型位置编辑器插件 <a href="https://github.com/Construkted-Reality/edd6b-Construkted/tree/ba5418eaa26710e0b63440167c177a5014e046e5" target="_blank" rel="noreferrer">Construkted-Reality/edd6b-Construkted</a>具体分支 <a href="https://github1s.com/Construkted-Reality/edd6b-Construkted/blob/master/edd-cesiumjs-customize/includes/js/CesiumIonSDKPlugin.js" target="_blank" rel="noreferrer">master</a><a href="https://github.com/Construkted-Reality/3DT-Local-viewer" target="_blank" rel="noreferrer">Construkted-Reality/3DT-Local-viewer: Local viewer for 3D Tiles --- Construkted-Reality/3DT-Local-viewer：3D Tiles 的本地查看器</a>2023年4月6日尝试了，不可用 <a href="https://github.com/Construkted-Reality/3DTG" target="_blank" rel="noreferrer">Construkted-Reality/3DTG：将 3d 模型转换为 3d tiles</a>目前该工具只接受带纹理的 OBJ 文件 <a href="https://ion.cesium.com/assets/" target="_blank" rel="noreferrer">My Assets | Cesium ion --- 我的资产 |铯离子</a>可以在线免费转3DTiles再下载下来</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Resource</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">fetchJson</span><span style="color:#A6ACCD;">(url)</span></span>
<span class="line"><span style="color:#A6ACCD;">原生支持加载glb</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">gltf </span><span style="color:#676E95;font-style:italic;">//用viewer.entities.add即可</span></span>
<span class="line"><span style="color:#A6ACCD;">经纬度转相机参数</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">postition世界坐标</span><span style="color:#F07178;">，</span><span style="color:#A6ACCD;">orientation相机朝向</span><span style="color:#89DDFF;">}</span><span style="color:#676E95;font-style:italic;">//官网《3D Models.html》有提到</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Scene</span><span style="color:#676E95;font-style:italic;">//是一个Cesium应用程序的根对象，它包含用于场景渲染和交互的所有元素。它是一个虚拟的3D环境，包括地球表面、天空、相机、光源等。</span></span>
<span class="line"><span style="color:#A6ACCD;">    View</span><span style="color:#676E95;font-style:italic;">//是Scene的一部分，表示场景中的一个视图，通常是一个图像帧或视频帧。它定义了一个矩形区域，指定场景中需要渲染的部分。</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">View</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prototype</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">createPotentiallyVisibleSet用于生成可能可见的命令frustumCommands</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">对象集合frustumCommands</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">commands。被Scene</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">executeCommandsInViewport调用</span></span>
<span class="line"><span style="color:#A6ACCD;">        函数首先获取相机的视点和方向，然后根据命令所在的 pass 类型将其添加到对应的命令数组中（computeList 或 overlayList），</span></span>
<span class="line"><span style="color:#A6ACCD;">        如果是普通渲染命令，函数会计算它与相机视锥体的交并得出它的可见性和深度信息，并将其添加到对应的块（bin）中。</span></span>
<span class="line"><span style="color:#A6ACCD;">        同时，函数还更新了 shadowNear 和 shadowFar 变量来记录所有能接收阴影且离相机最近的物体的近平面距离和远平面距离。</span></span>
<span class="line"><span style="color:#A6ACCD;">        最后，函数划分了相机视锥体的多个子锥体生成一组 frustumCommandsList 数组来存储所有在不同锥体内的可见命令，以及一个 frustumSplits 数组来存储每个子锥体的近平面或远平面位置。</span></span>
<span class="line"><span style="color:#A6ACCD;">总体而言，这个方法的作用是生成当前视野中需要绘制的物体集合，以便优化渲染性能并提高可视效果。</span></span>
<span class="line"><span style="color:#A6ACCD;">    Globe</span><span style="color:#676E95;font-style:italic;">//是Scene的一部分，表示在场景中渲染地球的部分。它包括地球的几何形状、地形、图像纹理和其他相关属性，使得场景中的地球可以进行交互和探索。</span></span></code></pre></div><h2 id="执行流程-与-对象" tabindex="-1">执行流程 与 对象 <a class="header-anchor" href="#执行流程-与-对象" aria-label="Permalink to &quot;执行流程 与 对象&quot;">​</a></h2><p><img src="`+p+`" alt=""></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">多源</span><span style="color:#676E95;font-style:italic;">//来源于遥感影像、摄像头、问卷调查、手机信令、GPS追踪等</span></span>
<span class="line"><span style="color:#A6ACCD;">异构</span><span style="color:#676E95;font-style:italic;">//结构化数据, 非结构化数据, 时空数据</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">如何压平</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    在压平区域的多边形正上方模拟一个相机，离屏渲染多边形区域的深度图，并将深度图传入模型（或者3DTile）的顶点着色器中，在顶点着色器中将模型顶点转换到模拟的相机空间下，</span></span>
<span class="line"><span style="color:#A6ACCD;">    然后转换到投影空间，投影空间下的坐标在【</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">~</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">】的范围内，并在多边形的区域内，使用多边形的高度，不在范围内不用处理</span></span>
<span class="line"><span style="color:#A6ACCD;">        模型的update更新循环方法，会一直调用updateModel方法</span></span>
<span class="line"><span style="color:#A6ACCD;">        u_isFlatten是关键 </span></span>
<span class="line"><span style="color:#A6ACCD;">             </span><span style="color:#FFCB6B;">Model</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prototype</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">update调用了Source</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">Scene</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">processPbrMaterials</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js的processPbrMaterials方法，进而遍历调用了generateTechnique生成着色器代码在返回的techniqueId对象里</span></span>
<span class="line"><span style="color:#89DDFF;">             </span><span style="color:#676E95;font-style:italic;">//processPbrMaterials：https://github.com/CesiumGS/cesium/blob/1.96/Source/Scene/processPbrMaterials.js#L448-L465 新版cesium已经废弃了它//详见https://cesium.com/blog/2022/10/05/tour-of-the-new-gltf-architecture-in-cesiumjs/</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">CEO解释如何渲染一帧</span><span style="color:#676E95;font-style:italic;">//https://cesium.com/blog/2015/05/14/graphics-tech-in-cesium/  https://cesium.com/blog/2015/05/26/graphics-tech-in-cesium-stack/</span></span>
<span class="line"><span style="color:#A6ACCD;">CesiumJS </span><span style="color:#F78C6C;">2022</span><span style="color:#89DDFF;">^</span><span style="color:#A6ACCD;"> 源码解读[</span><span style="color:#F78C6C;">7</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> 3DTiles 的请求、加载处理流程解析 _ </span><span style="color:#FFCB6B;">https</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;font-style:italic;">//www.cnblogs.com/onsummer/p/16432909.html    </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">初始化主更新循环 </span><span style="color:#676E95;font-style:italic;">//https://cdn.jsdelivr.net/npm/cesium@1.99.0/Build/CesiumUnminified/Cesium.js</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">startRenderLoop</span><span style="color:#A6ACCD;"> (Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js:</span><span style="color:#F78C6C;">212021</span><span style="color:#A6ACCD;">)  </span></span>
<span class="line"><span style="color:#A6ACCD;">	    </span><span style="color:#82AAFF;">在此requestAnimationFrame</span><span style="color:#A6ACCD;">(   </span><span style="color:#82AAFF;">render</span><span style="color:#A6ACCD;">(frameTime)</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">主更新循环体</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">  ) </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">set</span><span style="color:#A6ACCD;"> (Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js:</span><span style="color:#F78C6C;">212336</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">CesiumWidget</span><span style="color:#A6ACCD;"> (Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js:</span><span style="color:#F78C6C;">212236</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">Viewer</span><span style="color:#A6ACCD;"> (Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js:</span><span style="color:#F78C6C;">215480</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">DrawCommand</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prototype</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">execute 被谁调用，完整的调用链是什么样的：</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">简述</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 由Scene更新时遍历绘制命令触发gl的draw函数</span></span>
<span class="line"><span style="color:#A6ACCD;">    主更新循环体 → Scene</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">render → Scene</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">executeCommand </span></span>
<span class="line"><span style="color:#A6ACCD;">    → 遍历了frustumCommands</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">commands[Pass_default</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">GLOBE]  → DrawCommand</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">execute </span></span>
<span class="line"><span style="color:#A6ACCD;">    → Context</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">draw → Context</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">continueDraw → gl绘制调用drawElements</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">【Cesium 历史博客】Cesium 中的图形技术：渲染体系结构  </span><span style="color:#FFCB6B;">https</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;font-style:italic;">//www.cnblogs.com/onsummer/p/14022405.html   </span></span>
<span class="line"><span style="color:#A6ACCD;">czm_xxx</span><span style="color:#676E95;font-style:italic;">//如 czm_getWgs84EllipsoidEC() ，如czm_viewRotation，Cesium 提供了一个庞大的 GLSL 函数库，包括函数、结构体、常量。如果你的代码需要用到自定义 glsl 代码，你完全可以不声明、不加入 #include 预编译指令，可以直接使用它们。</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 模型分析（裁剪、压平、淹没） 基础类</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//原理：利用绘制的点数组，先计算其外包矩形，然后根据点创建一个polygonGeometry，然后利用此geometry创建指令，绘制出polygon纹理，</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//源码里会根据此纹理判断模型顶点是否在polygon纹理中，如果在就进行后续操作</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//多处压平思考：创建多个polygon纹理有点不大合理，一张FBO里多个polygon纹理，可能会导致压平闪烁（因为到着色器里，增大了顶点和polygon纹理的比对误差）</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//多处压平思路之一张FBO里多个polygon纹理：就是想办法在我创建的FBO帧缓存里绘制多少polygon纹理，创建polygon数组，每次绘制都是往这里添加polygon，</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//遍历polygon，依次创建指令绘制到fbo里</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//建筑物混合遮挡 // 1.楼块不能遮挡道路、水系、绿地和标注等地图元素；// 2.楼快之间，需要实现不透明的实际遮挡效果。</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//原理：自己创建FBO，把收集到的所有瓦片绘制指令，都绘制到这个FBO里，开启深度检测，然后再贴屏</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//场景雾效果</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//原理：根据深度图的深度值，对片元进行不同程度的模糊</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 雪覆盖 效果 </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//原理：法线越垂直与地面越白 </span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//后处理实现倒影</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//原理：利用空间镜面反射技术，计算倒影射线的UV进行采样</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//视频融合（投射3D，贴物体表面）</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//原理：在可视域的基础上，着色器里传入纹理，再计算UV进行贴图</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//视频融合（投射2D平面）</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//原理：根据相机位置，方向等参数，在相机前面生成一个平面，然后贴视频纹理</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">BaiduMercatorTilingScheme</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该对象定义了一个使用百度墨卡托投影的切片方案。</span></span>
<span class="line"><span style="color:#FFCB6B;">Batched3DModel3DTileContent</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该类表示一个可以用于渲染大批量三维模型的瓦片内容。</span></span>
<span class="line"><span style="color:#A6ACCD;">BoundingSphere 是一个用于表示包围球的类，</span><span style="color:#82AAFF;">可以用它来描述一个物体</span><span style="color:#A6ACCD;">(几何体)的边界。</span></span>
<span class="line"><span style="color:#A6ACCD;">CallbackProperty 是cesium中的一个属性，当属性被访问时，会执行指定的函数从而得到新值，常用于动态渲染场景。 </span><span style="color:#F78C6C;">1536</span></span>
<span class="line"><span style="color:#A6ACCD;">Cartesian2 是由两个实数表示的二维笛卡尔坐标空间中的点。比如在屏幕上，鼠标点击事件的位置就可以使用Cartesian2 来进行确定。</span></span>
<span class="line"><span style="color:#A6ACCD;">Cartesian3 是由三个实数表示的三维笛卡尔坐标系中的点。常常被用于描述具有位置信息的对象，例如地图上的标记点。</span></span>
<span class="line"><span style="color:#FFCB6B;">Cartographic</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该类表示地球上的一个经纬度位置。</span></span>
<span class="line"><span style="color:#FFCB6B;">Cesium3DTileset</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该类表示一个包含3D瓦片集合的场景，可以用于高性能的3D可视化。</span></span>
<span class="line"><span style="color:#A6ACCD;">CesiumMath是 Cesium 中的一个数学工具库，提供了循环函数、随机数生成等一些与数学计算相关的API。</span></span>
<span class="line"><span style="color:#FFCB6B;">CesiumTerrainProvider</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该类提供了一个获取Cesium自己的地形数据的接口。</span></span>
<span class="line"><span style="color:#FFCB6B;">checkHalfAxes</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该函数可以检查给定的值是否为HalfAxis对象。</span></span>
<span class="line"><span style="color:#FFCB6B;">Clock</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该类表示一个时钟，可以用于控制时间相关功能。</span></span>
<span class="line"><span style="color:#FFCB6B;">Composite3DTileContent</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该类表示一个复合的3D瓦片内容，可以由多个子瓦片组成。</span></span>
<span class="line"><span style="color:#A6ACCD;">ComputeCommand 表示对 GPU 计算渲染器的命令（使用老式 GPGPU</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">即在NVIDIA CUDA和OpenCL之前的一种GPGPU编程方式，早期使用GPU进行通用计算时，通常需要借助可编程图形渲染管线（例如OpenGL或Direct3D）以及专门的API和库来实现。这种方法存在诸多限制和难点，相比于现代的CUDA和OpenCL编程方式已经不太常用。）</span></span>
<span class="line"><span style="color:#A6ACCD;">defaultValue 用于判断某个值是不是 </span><span style="color:#89DDFF;">undefined</span><span style="color:#A6ACCD;"> 或null。若是，则返回defaultValue中的默认值，否则返回该值本身。</span></span>
<span class="line"><span style="color:#FFCB6B;">defined</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该函数可以检查给定的值是否已被定义。</span></span>
<span class="line"><span style="color:#A6ACCD;">destroyObject 可以销毁一个物体（对象），并将其置为无效状态，在内存回收方面会很有帮助。</span></span>
<span class="line"><span style="color:#FFCB6B;">Ellipsoid</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该类表示一个椭球体，用于处理地球几何学计算。</span></span>
<span class="line"><span style="color:#FFCB6B;">EllipsoidGeometry</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该类表示一个椭球体的几何形状。</span></span>
<span class="line"><span style="color:#FFCB6B;">EllipsoidTerrainProvider</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该类提供了一个获取Cesium默认椭球体地形数据的接口。</span></span>
<span class="line"><span style="color:#FFCB6B;">Entity</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该类表示一个可视化实体，如点、线和面等等。</span></span>
<span class="line"><span style="color:#FFCB6B;">EntityCollection</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该类表示多个实体的集合。</span></span>
<span class="line"><span style="color:#FFCB6B;">FrameState</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该类表示当前场景的状态和参数。</span></span>
<span class="line"><span style="color:#FFCB6B;">GBTilingScheme</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该对象定义了一个使用国测局投影的切片方案。</span></span>
<span class="line"><span style="color:#FFCB6B;">GeographicProjection</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该类表示一个基于经纬度坐标系的投影方式。</span></span>
<span class="line"><span style="color:#FFCB6B;">GeographicTilingScheme</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该对象定义了一个使用经纬度投影的切片方案。</span></span>
<span class="line"><span style="color:#FFCB6B;">GeoJsonDataSource</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该类表示从GeoJSON格式数据创建的数据源。</span></span>
<span class="line"><span style="color:#A6ACCD;">getHeadingPitchRoll 是Cesium中的一个方法，可以用于计算相机的朝向角度x，俯仰角度y和平行旋转角度z。</span></span>
<span class="line"><span style="color:#A6ACCD;">getWidgetOrigin 返回一个屏幕上的原点（左上角），一般用来修正页面偏移。</span></span>
<span class="line"><span style="color:#FFCB6B;">GlobeFS</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该对象包含了Globe着色器程序的代码。</span></span>
<span class="line"><span style="color:#FFCB6B;">GlobeSurfaceShaderSet</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该类管理了表达地球表面材质的所有着色器。</span></span>
<span class="line"><span style="color:#FFCB6B;">GlobeSurfaceTileProvider</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该类表示一个提供地球表面图块数据的提供者。</span></span>
<span class="line"><span style="color:#A6ACCD;">GlobeVS：定义所有 3D 地球场景（又名“球体”）上的“顶点着色器”，这些着色器负责管理非常大的几何对象，例如地形和 3D 模型。</span></span>
<span class="line"><span style="color:#FFCB6B;">GroundAtmosphere</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该类管理和呈现地球大气层。</span></span>
<span class="line"><span style="color:#A6ACCD;">HeadingPitchRoll 是由三个实数分别表示方向角、俯仰角、旋转角的类。</span></span>
<span class="line"><span style="color:#FFCB6B;">ImageryLayerCollection</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该类表示多个图像图层的集合。</span></span>
<span class="line"><span style="color:#FFCB6B;">Instanced3DModel3DTileContent</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该类表示一个可重用的3D模型实例。</span></span>
<span class="line"><span style="color:#FFCB6B;">JulianDate</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该类表示一个儒略日日期。</span></span>
<span class="line"><span style="color:#FFCB6B;">kdbush</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该类提供了一种使用kd树进行快速空间搜索的方法。</span></span>
<span class="line"><span style="color:#A6ACCD;">knockout 用于一个变量跟另一个变量联动，是 JavaScript 的 MVVM 框架，也是Cesium中关键的一部分，是cesium总体架构中，MVC 模式实现MVVM的另一种表现方式。提供相关的工具函数，常常作为依赖注入框架使用。</span></span>
<span class="line"><span style="color:#FFCB6B;">Math</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该对象包含了常用的数学函数和常量。</span></span>
<span class="line"><span style="color:#A6ACCD;">Matrix3是 Cesium 中的一个矩阵类，用于计算三维点之间的各种运算。</span></span>
<span class="line"><span style="color:#A6ACCD;">Matrix4类表示四乘四矩阵，用于对三维坐标系中的向量和旋转矩阵进行操作运算。</span></span>
<span class="line"><span style="color:#FFCB6B;">ModelInstanceCollection</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该类表示多个3D模型实例的集合。</span></span>
<span class="line"><span style="color:#FFCB6B;">PerspectiveOffCenterFrustum</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该类表示一个透视投影视锥体。</span></span>
<span class="line"><span style="color:#FFCB6B;">QuadtreePrimitive</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该类表示一个波段化的网格，并将其存储在四叉树用于高效的提取和渲染。</span></span>
<span class="line"><span style="color:#A6ACCD;">Quaternion 是由四个实数表示的 xywz四元素 对象，它们广泛应用于旋转问题，特别是在3D游戏引擎领域中被广泛使用。</span></span>
<span class="line"><span style="color:#FFCB6B;">Rectangle</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该类表示地球上的一个矩形区域。</span></span>
<span class="line"><span style="color:#FFCB6B;">RequestScheduler</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 该类管理异步请求和处理它们的顺序。</span></span>
<span class="line"><span style="color:#A6ACCD;">Resource：一个工具类，用于从异步 URL 加载并使用 HTTP 访问各种类型资源。</span></span>
<span class="line"><span style="color:#A6ACCD;">RotationEditor 是Cesium中的一个编辑器，主要用于控制场景中的物体</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">相机对象的旋转。</span></span>
<span class="line"><span style="color:#A6ACCD;">ScaleEditor 是一个CESIUM编辑器，用于缩放 场景物体。</span></span>
<span class="line"><span style="color:#A6ACCD;">SceneMode：定义 3D 场景的模式，可以是 3D、2D 或 单独的 Columbus 视图。</span></span>
<span class="line"><span style="color:#A6ACCD;">SceneTransforms 是cesium中的一个位于场景中的任意点位置。可以将任意三维坐标</span></span>
<span class="line"><span style="color:#FFCB6B;">ShaderSource</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 定义导入外部光源的光来计算阴影，并将其添加到当前材质的蒙版中的片段着色器。</span></span>
<span class="line"><span style="color:#FFCB6B;">Simon1994PlanetaryPositions</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 根据 Simon J</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;"> Kring 提供方法计算太阳系行星的位置。</span></span>
<span class="line"><span style="color:#FFCB6B;">TerrainQuantization</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 用于划分地面高程数据以便更有效地处理和传输。BITS12 属性代表使用 </span><span style="color:#F78C6C;">12</span><span style="color:#A6ACCD;"> 位无符号整数量化高度值时的位数。这可以用来确定地形的精度等级，也可以用来计算每个节点所需的字节数</span></span>
<span class="line"><span style="color:#A6ACCD;">Transforms：旋转、平移和尺度转换功能使用户在转换不同坐标系统和参考框架时轻松操作数据。</span></span>
<span class="line"><span style="color:#A6ACCD;">Transforms</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">computeIcrfToFixedMatrix 是一个转换矩阵计算函数，用于计算从平均值为零，单位比例的坐标系（也称惯性坐标系，即国际天文学联合会参考系）到固定参考系（如地心连续参考系或某些基准系）的四维变换矩阵。</span></span>
<span class="line"><span style="color:#A6ACCD;">Transforms</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">computeTemeToPseudoFixedMatrix是一个函数，用于计算由True Equator Mean </span><span style="color:#82AAFF;">Equinox</span><span style="color:#A6ACCD;"> (TEME)参考系转换到Pseudo</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">Fixed参考系的4x4变换矩阵。TEME是基于地球的特定时刻而定义的参考系。它的轴和赤道面与平均恒星时定义有关。Pseudo</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">Fixed参考系是在地球自转平衡的理想参考系，其中地球的自转速率是常量，该速率等于观测到的太阳周围平均旋转速率。 这个函数返回一个视图矩阵，允许将从TEME参考系下的位置和方向转换到Pseudo</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">Fixed参考系下的位置和方向。</span></span>
<span class="line"><span style="color:#A6ACCD;">TranslationEditor 是 cesium 中提供的位移编辑器，常用于控制场景中物体的位置。能够相对地图自由的移动三维模型（Transforms）和倾斜摄影结果（QuadtreeTile）。</span></span>
<span class="line"><span style="color:#A6ACCD;">turfEx是 cesium中的一个拓展库，封装了大量GIS分析和处理函数，可以有效地减少开发者书写GIS分析和处理代码的时间。</span></span>
<span class="line"><span style="color:#A6ACCD;">VertexFormat：定义属性化对象的顶点集合格式。 例如，颜色、纹理坐标或法线。 它还包含其他有用的参数，例如顶点大小以及定制顶点格式的创建方法。</span></span>
<span class="line"><span style="color:#A6ACCD;">WebMercatorProjection：一个处理与 Web Mercator 投影相关的数学类。</span></span>
<span class="line"><span style="color:#FFCB6B;">WebMercatorTilingScheme</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 以经典的WebMercator投影方式对图层进行瓦片化</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">构建瓦片树网格结构</span></span>
<span class="line"><span style="color:#A6ACCD;">when：一个实用工具，对带有错误处理的 promise 进行分装， 允许等待所有 promise 完成以及在适当的时间捕获潜在的失败。</span></span></code></pre></div><h2 id="类图" tabindex="-1">类图 <a class="header-anchor" href="#类图" aria-label="Permalink to &quot;类图&quot;">​</a></h2><p><a href="http://mars3d.cn/dev/img/jiagou/cesium.jpg" target="_blank" rel="noreferrer">cesium.jpg (3561×3574)</a></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">通用类</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">空间计算</span></span>
<span class="line"><span style="color:#A6ACCD;">	Cartesian3</span></span>
<span class="line"><span style="color:#A6ACCD;">	Catographic</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">Matrix3</span><span style="color:#A6ACCD;">(3x3矩阵，旋转变换)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">Quaternion</span><span style="color:#A6ACCD;">(围绕某个向量旋转一定角度的变换)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">Matrix4</span><span style="color:#A6ACCD;">(4x4矩阵，旋转加平移变换)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">Transforms</span><span style="color:#A6ACCD;">(包含将位置转换为各种参考系的功能)</span></span>
<span class="line"><span style="color:#A6ACCD;">Viewer</span></span>
<span class="line"><span style="color:#A6ACCD;">	其他一大堆UI组件</span></span>
<span class="line"><span style="color:#A6ACCD;">		Animation</span></span>
<span class="line"><span style="color:#A6ACCD;">		BaseLayerPicker</span></span>
<span class="line"><span style="color:#A6ACCD;">		Cesium3DTilesInspector</span></span>
<span class="line"><span style="color:#A6ACCD;">		CesiumInspector</span></span>
<span class="line"><span style="color:#A6ACCD;">		CesiumWidget</span></span>
<span class="line"><span style="color:#A6ACCD;">		FullscreenButton</span></span>
<span class="line"><span style="color:#A6ACCD;">		Geocoder</span></span>
<span class="line"><span style="color:#A6ACCD;">		HomeButton</span></span>
<span class="line"><span style="color:#A6ACCD;">		InfoBox</span></span>
<span class="line"><span style="color:#A6ACCD;">		NavigationHelpButton</span></span>
<span class="line"><span style="color:#A6ACCD;">		ProjectionPicker</span></span>
<span class="line"><span style="color:#A6ACCD;">		SceneModePicker</span></span>
<span class="line"><span style="color:#A6ACCD;">		SelectionIndicator</span></span>
<span class="line"><span style="color:#A6ACCD;">		Timeline</span></span>
<span class="line"><span style="color:#A6ACCD;">		VRButton</span></span>
<span class="line"><span style="color:#A6ACCD;">    CesiumWidget</span><span style="color:#676E95;font-style:italic;">//不包含任何UI组件的viewer，纯地球和星空</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//Viewer.scene === Viewer.cesiumWidget.scene</span></span>
<span class="line"><span style="color:#A6ACCD;">        Scene</span><span style="color:#676E95;font-style:italic;">//用来操作一切</span></span>
<span class="line"><span style="color:#A6ACCD;">			Event 事件</span></span>
<span class="line"><span style="color:#A6ACCD;">		        pick</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">drillpick</span></span>
<span class="line"><span style="color:#A6ACCD;">				preUpdate</span></span>
<span class="line"><span style="color:#A6ACCD;">				postUpdate</span></span>
<span class="line"><span style="color:#A6ACCD;">				preRender</span></span>
<span class="line"><span style="color:#A6ACCD;">				postRender</span></span>
<span class="line"><span style="color:#A6ACCD;">            Camera</span></span>
<span class="line"><span style="color:#A6ACCD;">	            </span><span style="color:#82AAFF;">position</span><span style="color:#A6ACCD;">(位置)</span></span>
<span class="line"><span style="color:#A6ACCD;">				</span><span style="color:#82AAFF;">heading</span><span style="color:#A6ACCD;">(方位角)</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">绕z轴旋转</span></span>
<span class="line"><span style="color:#A6ACCD;">				</span><span style="color:#82AAFF;">pitch</span><span style="color:#A6ACCD;">(俯仰角)</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">绕y轴旋转</span></span>
<span class="line"><span style="color:#A6ACCD;">				</span><span style="color:#82AAFF;">roll</span><span style="color:#A6ACCD;">(翻滚角)</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">绕x轴旋转</span></span>
<span class="line"><span style="color:#A6ACCD;">            环境对象</span></span>
<span class="line"><span style="color:#A6ACCD;">	            </span><span style="color:#82AAFF;">skyAtmosphere</span><span style="color:#A6ACCD;">(大气圈)</span></span>
<span class="line"><span style="color:#A6ACCD;">				</span><span style="color:#82AAFF;">skyBox</span><span style="color:#A6ACCD;">(天空盒)</span></span>
<span class="line"><span style="color:#A6ACCD;">				</span><span style="color:#82AAFF;">sun</span><span style="color:#A6ACCD;">(太阳)</span></span>
<span class="line"><span style="color:#A6ACCD;">				</span><span style="color:#82AAFF;">moon</span><span style="color:#A6ACCD;">(月亮)</span></span>
<span class="line"><span style="color:#A6ACCD;">				</span><span style="color:#82AAFF;">flog</span><span style="color:#A6ACCD;">(雾化)</span></span>
<span class="line"><span style="color:#A6ACCD;">				</span><span style="color:#82AAFF;">ParticleSystem</span><span style="color:#A6ACCD;">(粒子系统)</span></span>
<span class="line"><span style="color:#A6ACCD;">            Globe </span><span style="color:#676E95;font-style:italic;">//地球</span></span>
<span class="line"><span style="color:#A6ACCD;">				terrainProvider 地形</span></span>
<span class="line"><span style="color:#A6ACCD;">	                ArcGISTiledElevationTerrainProvider</span></span>
<span class="line"><span style="color:#A6ACCD;">					CesiumTerrainProvider</span></span>
<span class="line"><span style="color:#A6ACCD;">					EllipsoidTerrainProvider</span></span>
<span class="line"><span style="color:#A6ACCD;">					GoogleEarthEnterpriseTerrainProvider</span></span>
<span class="line"><span style="color:#A6ACCD;">					VRTheWorldTerrainProvider</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#FFCB6B;">imageryLayers</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">ImageryLayerCollection影像</span></span>
<span class="line"><span style="color:#A6ACCD;">                    ImageryLayer</span></span>
<span class="line"><span style="color:#A6ACCD;">                    ImageryProvider</span></span>
<span class="line"><span style="color:#A6ACCD;">                        xxxImageryProvider</span></span>
<span class="line"><span style="color:#A6ACCD;">	                    ArcGisMapServerImageryProvider</span></span>
<span class="line"><span style="color:#A6ACCD;">						BingMapsImageryProvider</span></span>
<span class="line"><span style="color:#A6ACCD;">						GoogleEarthEnterpriselmageryProvider</span></span>
<span class="line"><span style="color:#A6ACCD;">						</span><span style="color:#82AAFF;">GridImageryProvider</span><span style="color:#A6ACCD;">(开发调试)</span></span>
<span class="line"><span style="color:#A6ACCD;">						IonImageryProvider</span></span>
<span class="line"><span style="color:#A6ACCD;">						MapboxImageryProvider</span></span>
<span class="line"><span style="color:#A6ACCD;">						MapboxStylelmageryProvider</span></span>
<span class="line"><span style="color:#A6ACCD;">						OpenStreetMapImageryProvider</span></span>
<span class="line"><span style="color:#A6ACCD;">						SingleTilelmageryProvider</span></span>
<span class="line"><span style="color:#A6ACCD;">						</span><span style="color:#82AAFF;">TileCoordinatesImageryProvider</span><span style="color:#A6ACCD;">(开发调试)</span></span>
<span class="line"><span style="color:#A6ACCD;">						TileMapServicelmageryProvider</span></span>
<span class="line"><span style="color:#A6ACCD;">						UrITemplateImageryProvider</span></span>
<span class="line"><span style="color:#A6ACCD;">						WebMapServicelmageryProvider</span></span>
<span class="line"><span style="color:#A6ACCD;">						WebMapTileServicelmageryProvider</span></span>
<span class="line"><span style="color:#A6ACCD;">                Ellipsoid</span><span style="color:#676E95;font-style:italic;">//平面的地形</span></span>
<span class="line"><span style="color:#A6ACCD;">                Color</span></span>
<span class="line"><span style="color:#A6ACCD;">            ScreenSpaceCameraController  </span></span>
<span class="line"><span style="color:#A6ACCD;">                enableRotate</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">enableTranslate</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">enableZoom等</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">primitives</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">PrimitiveCollection </span><span style="color:#676E95;font-style:italic;">//它的removeAll()会把Cesium自己添加的东西也移除掉,慎用!</span></span>
<span class="line"><span style="color:#A6ACCD;">	            Visualizer </span><span style="color:#676E95;font-style:italic;">//对象（呈现 3D 几何图形的实例）转换为 \`Primitive\` 并呈现在场景中</span></span>
<span class="line"><span style="color:#A6ACCD;">			        GeometryVisualizer：用于 </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">GeometryInstance</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">                Primitive</span></span>
<span class="line"><span style="color:#A6ACCD;">	                modelMatrix</span></span>
<span class="line"><span style="color:#A6ACCD;">                    Appearance</span></span>
<span class="line"><span style="color:#A6ACCD;">                        XXXAppearance</span></span>
<span class="line"><span style="color:#A6ACCD;">                            material   MaterialProperty</span></span>
<span class="line"><span style="color:#A6ACCD;">	                            ColorMaterialProperty颜色材质</span></span>
<span class="line"><span style="color:#A6ACCD;">								ImageMaterialProperty贴图材质</span></span>
<span class="line"><span style="color:#A6ACCD;">								CheckerboardMaterialProperty棋盘纹理</span></span>
<span class="line"><span style="color:#A6ACCD;">								StripeMaterialProperty条纹纹理</span></span>
<span class="line"><span style="color:#A6ACCD;">								GridMaterialProperty网格</span></span>
<span class="line"><span style="color:#A6ACCD;">								PolylineGlowMaterialProperty发光材质</span></span>
<span class="line"><span style="color:#A6ACCD;">								PolylineOutlineMaterialProperty外轮廓材质</span></span>
<span class="line"><span style="color:#A6ACCD;">								PolylineArrowMaterialProperty带有箭头的线</span></span>
<span class="line"><span style="color:#A6ACCD;">								PolylineDashMaterialProperty</span></span>
<span class="line"><span style="color:#A6ACCD;">                            renderState</span></span>
<span class="line"><span style="color:#A6ACCD;">						EllipsoidSurfaceAppearance</span></span>
<span class="line"><span style="color:#A6ACCD;">						MaterialAppearance</span></span>
<span class="line"><span style="color:#A6ACCD;">						PerInstanceColorAppearance</span></span>
<span class="line"><span style="color:#A6ACCD;">							</span><span style="color:#FFCB6B;">可设置renderState</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">depthTest</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">enabled</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">}}</span></span>
<span class="line"><span style="color:#A6ACCD;">						PolylineColorAppearance</span></span>
<span class="line"><span style="color:#A6ACCD;">						PolylineMaterialAppearance</span></span>
<span class="line"><span style="color:#A6ACCD;">                   GeometryInstance，1或n个</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">每个可以有自己的modelMatrix</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">                        XXXGeometry</span></span>
<span class="line"><span style="color:#A6ACCD;">                            geometry</span></span>
<span class="line"><span style="color:#A6ACCD;">                            modelMatrix</span></span>
<span class="line"><span style="color:#A6ACCD;">						BoxGeometry</span><span style="color:#89DDFF;">/</span><span style="color:#82AAFF;">BoxOutlineGeometry</span><span style="color:#A6ACCD;">(立方体)</span></span>
<span class="line"><span style="color:#A6ACCD;">						CircleGeometry</span><span style="color:#89DDFF;">/</span><span style="color:#82AAFF;">CircleOutlineGeometry</span><span style="color:#A6ACCD;">(圆形或者拉伸的圆形)</span></span>
<span class="line"><span style="color:#A6ACCD;">						CoplanarPolygonGeometry</span><span style="color:#89DDFF;">/</span><span style="color:#82AAFF;">CoplanarPolygonOutlineGeometry</span><span style="color:#A6ACCD;">(任意面组成的多边形)</span></span>
<span class="line"><span style="color:#A6ACCD;">						CorridorGeometry</span><span style="color:#89DDFF;">/</span><span style="color:#82AAFF;">CorridorOutlineGeometry</span><span style="color:#A6ACCD;">(走廊)</span></span>
<span class="line"><span style="color:#A6ACCD;">						CylinderGeometryy</span><span style="color:#89DDFF;">/</span><span style="color:#82AAFF;">CylinderOutlineGeometry</span><span style="color:#A6ACCD;">(圆柱、圆锥或者载断的圆锥)</span></span>
<span class="line"><span style="color:#A6ACCD;">						EllipseGeometry</span><span style="color:#89DDFF;">/</span><span style="color:#82AAFF;">EllipseOutlineGeometry</span><span style="color:#A6ACCD;">(椭圆或者拉伸的椭圆)</span></span>
<span class="line"><span style="color:#A6ACCD;">						EllipsoidGeometry</span><span style="color:#89DDFF;">/</span><span style="color:#82AAFF;">EllipsoidOutlineGeometry</span><span style="color:#A6ACCD;">(球)</span></span>
<span class="line"><span style="color:#A6ACCD;">						FrustumGeometry</span><span style="color:#89DDFF;">/</span><span style="color:#82AAFF;">FrustumOutlineGeometry</span><span style="color:#A6ACCD;">(视体)</span></span>
<span class="line"><span style="color:#A6ACCD;">						PlaneGeometry</span><span style="color:#89DDFF;">/</span><span style="color:#82AAFF;">PlaneOutlineGeometry</span><span style="color:#A6ACCD;">(原点为中心的平面的几何形状)</span></span>
<span class="line"><span style="color:#A6ACCD;">						PolygonGeometry</span><span style="color:#89DDFF;">/</span><span style="color:#82AAFF;">PolygonOutlineGeometry</span><span style="color:#A6ACCD;">(多边形，可以具有空洞或者拉伸一定的的高度)</span></span>
<span class="line"><span style="color:#A6ACCD;">						PolylineGeometry</span><span style="color:#89DDFF;">/</span><span style="color:#82AAFF;">SimplePolylineGeometry</span><span style="color:#A6ACCD;">(多段线，可以具有一定的宽度)</span></span>
<span class="line"><span style="color:#A6ACCD;">						PolylineVolumeGeometry</span><span style="color:#89DDFF;">/</span><span style="color:#82AAFF;">PolylineVolumeOutlineGeometry</span><span style="color:#A6ACCD;">(多段线柱体)</span></span>
<span class="line"><span style="color:#A6ACCD;">						RectangleGeometry</span><span style="color:#89DDFF;">/</span><span style="color:#82AAFF;">RectangleOutlineGeometry</span><span style="color:#A6ACCD;">(矩形或者拉伸的矩形)</span></span>
<span class="line"><span style="color:#A6ACCD;">						SphereGeometry</span><span style="color:#89DDFF;">/</span><span style="color:#82AAFF;">SphereOutlineGeometry</span><span style="color:#A6ACCD;">(球体)</span></span>
<span class="line"><span style="color:#A6ACCD;">						WallGeometry</span><span style="color:#89DDFF;">/</span><span style="color:#82AAFF;">WallOutlineGeometry</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">                BillboardCollection </span><span style="color:#676E95;font-style:italic;">//面朝屏幕的图片, 广告牌</span></span>
<span class="line"><span style="color:#A6ACCD;">                LabelCollection</span><span style="color:#676E95;font-style:italic;">//面朝屏幕的文字</span></span>
<span class="line"><span style="color:#A6ACCD;">                GroundPolylinePrimitive</span></span>
<span class="line"><span style="color:#A6ACCD;">					GeometryInstance</span></span>
<span class="line"><span style="color:#A6ACCD;">						GroundPolylineGeometry</span></span>
<span class="line"><span style="color:#A6ACCD;">					Appearance</span></span>
<span class="line"><span style="color:#A6ACCD;">				GroundPrimitive</span></span>
<span class="line"><span style="color:#A6ACCD;">					GeometryInstance</span></span>
<span class="line"><span style="color:#A6ACCD;">					Appearance</span></span>
<span class="line"><span style="color:#A6ACCD;">				Cesium3DTileset</span></span>
<span class="line"><span style="color:#A6ACCD;">                    classificationType </span><span style="color:#676E95;font-style:italic;">//将这个3dtile变成ClassificationPrimitive</span></span>
<span class="line"><span style="color:#A6ACCD;">				ClassificationPrimitive</span><span style="color:#676E95;font-style:italic;">//一个不可见封闭的体,被它罩住的,就要用它的颜色附着</span></span>
<span class="line"><span style="color:#A6ACCD;">					GeometryInstance</span></span>
<span class="line"><span style="color:#A6ACCD;">					Appearance</span></span>
<span class="line"><span style="color:#A6ACCD;">				PointPrimitiveCollection</span></span>
<span class="line"><span style="color:#A6ACCD;">				PolylineCollection</span></span>
<span class="line"><span style="color:#A6ACCD;">				Model</span></span>
<span class="line"><span style="color:#A6ACCD;">				ParticleSystem</span></span>
<span class="line"><span style="color:#A6ACCD;">            grounPrimitives</span><span style="color:#676E95;font-style:italic;">//贴地的</span></span>
<span class="line"><span style="color:#A6ACCD;">                GroundPolylinePrimitive  </span></span>
<span class="line"><span style="color:#A6ACCD;">    Clock</span></span>
<span class="line"><span style="color:#A6ACCD;">    ScreenSpaceEventHandler</span></span>
<span class="line"><span style="color:#A6ACCD;">    dataSourceDisplay</span></span>
<span class="line"><span style="color:#A6ACCD;">        dataSources</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">defaultDataSource</span><span style="color:#A6ACCD;">(CustomDataSource)</span></span>
<span class="line"><span style="color:#A6ACCD;">            entities</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">dataSources</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">DataSourceCollectior</span><span style="color:#676E95;font-style:italic;">//是dataSourceDisplay的属性的快捷方式</span></span>
<span class="line"><span style="color:#A6ACCD;">        DataSourceCollection </span></span>
<span class="line"><span style="color:#A6ACCD;">            GeoJsonDataSource</span></span>
<span class="line"><span style="color:#A6ACCD;">            CustomDataSource</span></span>
<span class="line"><span style="color:#A6ACCD;">			CzmIDataSource</span></span>
<span class="line"><span style="color:#A6ACCD;">			KmIDataSource</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">entities</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">EntityCollection</span><span style="color:#676E95;font-style:italic;">//是defaultDataSource的属性的快捷方式，primitive的简化版.底层用的还是primitive</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//Viewer.entities === Viewer.dataSourceDisplay.defaultDataSource.entities</span></span>
<span class="line"><span style="color:#A6ACCD;">        Entity </span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#82AAFF;">XXXGriaphics</span><span style="color:#A6ACCD;">(可修改样式)</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">availability</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">TimeIntervalCollection</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#82AAFF;">BillboardGraphics</span><span style="color:#A6ACCD;">(广告牌</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#82AAFF;">BoxGraphics</span><span style="color:#A6ACCD;">(盒子)</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#82AAFF;">CorridorGraphics</span><span style="color:#A6ACCD;">(走廊)</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#82AAFF;">CylinderGraphics</span><span style="color:#A6ACCD;">(圆柱、圆锥或者截断的圆锥)</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#82AAFF;">EllipseGraphics</span><span style="color:#A6ACCD;">(圆或者拉伸的椭圆)</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#82AAFF;">EllipsoidGraphics</span><span style="color:#A6ACCD;">(椭圆)</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#82AAFF;">LabelGraphics</span><span style="color:#A6ACCD;">(标签)</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#82AAFF;">ModelGraphics</span><span style="color:#A6ACCD;">(模型)</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#82AAFF;">Cesium3DTilesetGraphics</span><span style="color:#A6ACCD;">(三维瓦片</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#82AAFF;">PathGraphics</span><span style="color:#A6ACCD;">(路径)</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#82AAFF;">PlaneGraphics</span><span style="color:#A6ACCD;">(平面)</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#82AAFF;">PointGraphics</span><span style="color:#A6ACCD;">(点)</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#82AAFF;">PolygonGraphics</span><span style="color:#A6ACCD;">(多边形)</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#82AAFF;">PolylineGraphics</span><span style="color:#A6ACCD;">(多线段)</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#82AAFF;">PolylineVolumeGraphics</span><span style="color:#A6ACCD;">(多段线柱体)</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#82AAFF;">RectangleGraphics</span><span style="color:#A6ACCD;">(矩形)</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#82AAFF;">WallGraphics</span><span style="color:#A6ACCD;">(墙)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">PolygonGraphics和PolygonGeometry的区别</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> PolygonGraphics用于创建多边形或多边形网格效果的可视化对象，主要应用于地图呈现和展示等场景</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> PolygonGeometry用于储存和编辑多边形的坐标和相关信息，主要用于几何计算和数据处理的场景。</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> PolygonGraphics可以通过Cesium API提供的多种属性来调整和修改多边形对象的外观效果，如边框、填充颜色、透明度、轮廓线等</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> PolygonGeometry则需要手动设置每个点的坐标、索引等信息。</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> PolygonGraphics支持一些交互事件，如鼠标点击、悬浮等，可以在用户与界面进行交互时进行响应</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> PolygonGeometry不支持这些事件，只是简单的几何体。</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> PolygonGraphics更加适用于可视化的场景</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> PolygonGeometry则更适合于几何计算和数据处理的场景。</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Ellipsoid</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">WGS84</span></span>
<span class="line"><span style="color:#A6ACCD;">	定义了一个符合WGS84椭球体标准的椭球体	</span></span>
<span class="line"><span style="color:#A6ACCD;">	radii：表示椭球体在x、y和z轴上的半径。</span></span>
<span class="line"><span style="color:#A6ACCD;">	maximumRadius：表示椭球体的最大半径。</span></span>
<span class="line"><span style="color:#A6ACCD;">	minimumRadius：表示椭球体的最小半径。</span></span>
<span class="line"><span style="color:#A6ACCD;">	radiiSquared：表示椭球体在x、y和z轴上的半径的平方。</span></span>
<span class="line"><span style="color:#A6ACCD;">	radiiToTheFourth：表示椭球体在x、y和z轴上的半径的四次方。</span></span>
<span class="line"><span style="color:#A6ACCD;">	oneOverRadii：表示椭球体在x、y和z轴上的半径的倒数。</span></span>
<span class="line"><span style="color:#A6ACCD;">	oneOverRadiiSquared：表示椭球体在x、y和z轴上的半径的平方的倒数。</span></span>
<span class="line"><span style="color:#A6ACCD;">	用于各种计算，例如在地球表面上绘制点、线、面、矢量等时，需要将其投影到三维椭球体上进行计算。</span></span></code></pre></div><h2 id="源码-创建worker" tabindex="-1">源码-创建worker <a class="header-anchor" href="#源码-创建worker" aria-label="Permalink to &quot;源码-创建worker&quot;">​</a></h2><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">TaskProcessor 的创建</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">	1</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">在加载Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js就触发各种TaskProcessor的创建</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#82AAFF;">TaskProcessor</span><span style="color:#A6ACCD;"> (TaskProcessor</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js:</span><span style="color:#F78C6C;">204</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">		（匿名） (HeightmapTerrainData</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js:</span><span style="color:#F78C6C;">187</span><span style="color:#A6ACCD;">) </span><span style="color:#FFCB6B;">类似还有</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">			各自用TaskProcessor对应创建的worker</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">HeightmapTerrainData</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Workers</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">createVerticesFromHeightmap </span><span style="color:#676E95;font-style:italic;">//NoThrottle</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">HeightmapTerrainData</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Workers</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">createVerticesFromHeightma  </span><span style="color:#676E95;font-style:italic;">//Throttle</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">QuantizedMeshTerrainData</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Workers</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">createVerticesFromQuantizedTerrainMesh </span><span style="color:#676E95;font-style:italic;">//NoThrottle</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">QuantizedMeshTerrainData</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Workers</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">createVerticesFromQuantizedTerrainMesh </span><span style="color:#676E95;font-style:italic;">//Throttle</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">QuantizedMeshTerrainData</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Workers</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">upsampleQuantizedTerrainMesh</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">GoogleEarthEnterpriseMetadata</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Workers</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">decodeGoogleEarthEnterprisePacket</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">GoogleEarthEnterpriseTerrainData</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Workers</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">createVerticesFromGoogleEarthEnterpriseBuffer </span><span style="color:#676E95;font-style:italic;">//NoThrottle</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">GoogleEarthEnterpriseTerrainData</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Workers</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">createVerticesFromGoogleEarthEnterpriseBuffer </span><span style="color:#676E95;font-style:italic;">//Throttle</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">GoogleEarthEnterpriseTerrainData</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Workers</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">upsampleQuantizedTerrainMesh</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">GoogleEarthEnterpriseTerrainProvider</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Workers</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">decodeGoogleEarthEnterprisePacket</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">KTX2Transcoder</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Workers</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">transcodeKTX2</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">Primitive</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Workers</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">combineGeometry</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">Vector3DTileGeometry</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Workers</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">createVectorTileGeometries</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">Vector3DTilePoints</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Workers</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">createVectorTilePoints</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">Vector3DTilePolygons</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Workers</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">createVectorTilePolygons</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">Vector3DTilePolylines</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Workers</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">createVectorTilePolylines</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">Vector3DTileClampedPolylines</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Workers</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">createVectorTileClampedPolylinesVector3DTileClampedPolylines</span></span>
<span class="line"><span style="color:#A6ACCD;">		（匿名） (Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js:</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	2</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Primitive</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">update</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">loadAsynchronous 时创建</span></span>
<span class="line"><span style="color:#A6ACCD;">		createGeometryTaskProcessors[navigator</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hardwareConcurrency] </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">TaskProcessor</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">createGeometry</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">		</span><span style="color:#676E95;font-style:italic;">//创建cpu核数创建n个Workers/createGeometry</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">主线程</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">Viewer</span><span style="color:#A6ACCD;"> (Viewer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js:</span><span style="color:#F78C6C;">488</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">CesiumWidget</span><span style="color:#A6ACCD;"> (CesiumWidget</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js:</span><span style="color:#F78C6C;">399</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">set</span><span style="color:#A6ACCD;"> (CesiumWidget</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js:</span><span style="color:#F78C6C;">621</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">startRenderLoop</span><span style="color:#A6ACCD;"> (CesiumWidget</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js:</span><span style="color:#F78C6C;">69</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	requestAnimationFrame（异步）</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">render2</span><span style="color:#A6ACCD;"> (CesiumWidget</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js:</span><span style="color:#F78C6C;">42</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	CesiumWidget</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">render</span><span style="color:#A6ACCD;"> (CesiumWidget</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js:</span><span style="color:#F78C6C;">842</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	Scene4</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">render</span><span style="color:#A6ACCD;"> (Scene</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js:</span><span style="color:#F78C6C;">3859</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">tryAndCatchError</span><span style="color:#A6ACCD;"> (Scene</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js:</span><span style="color:#F78C6C;">3769</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">render</span><span style="color:#A6ACCD;"> (Scene</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js:</span><span style="color:#F78C6C;">3750</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	Scene4</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">updateAndExecuteCommands</span><span style="color:#A6ACCD;"> (Scene</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js:</span><span style="color:#F78C6C;">2860</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">executeCommandsInViewport</span><span style="color:#A6ACCD;"> (Scene</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js:</span><span style="color:#F78C6C;">3115</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">updateAndRenderPrimitives</span><span style="color:#A6ACCD;"> (Scene</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js:</span><span style="color:#F78C6C;">3339</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	PrimitiveCollection</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">update</span><span style="color:#A6ACCD;"> (PrimitiveCollection</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js:</span><span style="color:#F78C6C;">377</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	Primitive</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">update</span><span style="color:#A6ACCD;"> (Primitive</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js:</span><span style="color:#F78C6C;">2170</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	Primitive</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">update</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">loadAsynchronous</span><span style="color:#A6ACCD;"> (Primitive</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js:</span><span style="color:#F78C6C;">1270</span><span style="color:#A6ACCD;">) </span></span>
<span class="line"><span style="color:#A6ACCD;">	TaskProcessor</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">scheduleTask</span><span style="color:#A6ACCD;"> (TaskProcessor</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js:</span><span style="color:#F78C6C;">251</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#82AAFF;">createWorker</span><span style="color:#A6ACCD;"> (TaskProcessor</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js:</span><span style="color:#F78C6C;">151</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">			Worker</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">postMessage（异步）TaskProcessor的worker线程发消息给 cesiumWorkerBootstrapper的worker线程</span></span>
<span class="line"><span style="color:#A6ACCD;">		TaskProcessor的worker线程发消息给之前createTaskProcessorWorker创建出来的worker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">		</span></span>
<span class="line"><span style="color:#A6ACCD;">cesiumWorkerBootstrapper 的worker线程</span></span>
<span class="line"><span style="color:#A6ACCD;">	self</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onmessage</span><span style="color:#A6ACCD;"> (cesiumWorkerBootstrapper</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js:</span><span style="color:#F78C6C;">30</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#FFCB6B;">接收到</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">loaderConfig</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">				</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">paths</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">					</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">Workers</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://sandcastle.cesium.com/CesiumUnminified/Workers</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">				</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">				</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">baseUrl</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://sandcastle.cesium.com/CesiumUnminified/</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">workerModule</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Workers/createGeometry</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">或</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Workers/createVerticesFromQuantizedTerrainMesh</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">或</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Workers/combineGeometry</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">等</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">createTaskProcessorWorker根据</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">workerModule</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">匹配 TaskProcessor根据传入的workerPath 创建出来的worker线程</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> 见</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">TaskProcessor 的创建</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#FFCB6B;">接收到</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">parameters</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">				</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">subTasks</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#F07178;">					</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">						</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">moduleName</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">createBoxGeometry</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">						</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">geometry</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">200000</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">150000</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">250000</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">3</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200000</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">4</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">150000</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">5</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">250000</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">6</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">7</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">9</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">10</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">11</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">12</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">						</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">offset</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#F07178;">					</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">				]</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">canTransferArrayBuffer</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">}</span></span></code></pre></div><h2 id="实践" tabindex="-1">实践 <a class="header-anchor" href="#实践" aria-label="Permalink to &quot;实践&quot;">​</a></h2><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">概念</span></span>
<span class="line"><span style="color:#A6ACCD;">    Cesium ion是一个提供瓦片图和3D地理空间数据的平台</span></span>
<span class="line"><span style="color:#A6ACCD;">    使用geojson加载线数据在30万左右，矢量建筑面8万左右尚可</span></span>
<span class="line"><span style="color:#A6ACCD;">    OSGB</span><span style="color:#676E95;font-style:italic;">//Open Scene Gragh Binary 是模型的二进制表示，所有纹理都包含在一个独立文件中。 OpenSceneGraph 是一个开源的高性能 3D 图形工具包 </span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    Matrix4</span><span style="color:#676E95;font-style:italic;">//4x4转换矩阵，用于转换图块的根图块</span></span>
<span class="line"><span style="color:#A6ACCD;">    Ellipsoid</span><span style="color:#676E95;font-style:italic;">//由方程在笛卡尔坐标系中定义的二次曲面//椭球体    </span></span>
<span class="line"><span style="color:#A6ACCD;">    I3S</span><span style="color:#676E95;font-style:italic;">//(索引3D场景)Esri针对3D场景提出的一种数据格式，ArcGIS的场景服务都默认采用这种数据格式</span></span>
<span class="line"><span style="color:#A6ACCD;">    报错：</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//我发现原因是KHR_technique_webgl扩展新版Cesium已经不支持的缘故，需要升级一下gltf数据，使用KHR_techniques_webgl扩展即可(注意多了一个s)</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//Cesium在使用这个扩展时，gltf2.0也在逐步进化，居然连KHR_technique_webgl这个扩展的名字都改了，technique后面加了一个s。。所以现在的扩展名叫KHR_techniques_webgl</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span></span>
<span class="line"><span style="color:#82AAFF;">ECEF</span><span style="color:#A6ACCD;"> (Earth</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">Centered</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Earth</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">Fixed)是一种表示地球中物体位置的坐标系，它是以地球的中心为原点并固定在地球上的坐标系。在ECEF坐标系中，三维坐标（x</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> y</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> z）表示物体与地球中心的距离。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">坐标</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//详见 https://github.com/Fang-Lansheng/Cesium</span></span>
<span class="line"><span style="color:#A6ACCD;">    pick：屏幕坐标 </span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Cartesian2</span><span style="color:#A6ACCD;">(x</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> y)     </span><span style="color:#676E95;font-style:italic;">// 表示一个二维笛卡尔坐标系，也就是直角坐标系（屏幕坐标系）</span></span>
<span class="line"><span style="color:#A6ACCD;">    Cartesian3 </span><span style="color:#676E95;font-style:italic;">//世界坐标（三维坐标） 3D笛卡尔点对象 //米单位;原点是地球几何中心； +x是中央经线，-x是180度经线</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Cartesian3</span><span style="color:#A6ACCD;">(x</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> y</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> z)  </span><span style="color:#676E95;font-style:italic;">// 表示一个三维笛卡尔坐标系，也是直角坐标系（就是真实世界的坐标系）</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//二维屏幕坐标系到三维坐标系的转换</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> pick </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Cartesian2</span><span style="color:#A6ACCD;">(window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">innerWidth</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> window</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">innerHeight)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">	</span><span style="color:#676E95;font-style:italic;">// 屏幕坐标</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> cartesian</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> scene</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">globe</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">pick</span><span style="color:#A6ACCD;">(viewer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">camera</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getPickRay</span><span style="color:#A6ACCD;">(pick)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> scene) </span><span style="color:#676E95;font-style:italic;">// 世界坐标</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">Cartographic</span><span style="color:#A6ACCD;">(longitude</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> latitude</span><span style="color:#676E95;font-style:italic;">/*弧度*/</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> height) </span><span style="color:#676E95;font-style:italic;">//地理坐标（弧度）</span></span>
<span class="line"><span style="color:#A6ACCD;">    point：经纬度坐标</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">实体模型分2种：</span></span>
<span class="line"><span style="color:#A6ACCD;">       Primitive </span><span style="color:#82AAFF;">API针对图形开发人员的低级应用程序</span><span style="color:#A6ACCD;">(定制化高</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">更偏底层)</span></span>
<span class="line"><span style="color:#A6ACCD;">       Entity </span><span style="color:#82AAFF;">API针对数据驱动的可视化的高级应用程序</span><span style="color:#A6ACCD;">(定制化低)</span></span>
<span class="line"><span style="color:#A6ACCD;">           </span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">   </span></span>
<span class="line"><span style="color:#A6ACCD;">Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Ion</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">defaultAccessToken </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">your_access_token</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> viewer </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Viewer</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cesiumContainer</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//viewer用于构建应用程序的基本小部件。它将所有标准Cesium小部件组合到一个可重用的程序包中</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">animation</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">              </span><span style="color:#676E95;font-style:italic;">// 是否显示动画小部件（左下角仪表盘）</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">baseLayerPicker</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">// 是否显示图层选择器</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">fullscreenButton</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">       </span><span style="color:#676E95;font-style:italic;">// 是否显示全屏按钮</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">geocoder</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">               </span><span style="color:#676E95;font-style:italic;">// 是否显示 geocoder 小部件（右上角查询按钮）</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">vrButton</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">              </span><span style="color:#676E95;font-style:italic;">// 是否显示 VR 按钮</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">homeButton</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">             </span><span style="color:#676E95;font-style:italic;">// 是否显示 Home 按钮</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">infoBox</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">                </span><span style="color:#676E95;font-style:italic;">// 是否显示信息框</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">sceneModePicker</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">// 是否显示 3D/2D 选择器</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">selectionIndicator</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">// 是否显示指示器组件</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">timeline</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">              </span><span style="color:#676E95;font-style:italic;">// 是否显示时间轴</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">navigationHelpButton</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">// 是否显示右上角的帮助按钮</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">scene3DOnly</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">           </span><span style="color:#676E95;font-style:italic;">// 如果设置为 true，则所有几何图形以 3D 模式绘制以节约GPU资源</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">shadows </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">               </span><span style="color:#676E95;font-style:italic;">// 是否显示阴影</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">shouldAnimate </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">         </span><span style="color:#676E95;font-style:italic;">// 是否显示动画</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">imageryProvider</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">BingMapsImageryProvider</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">							   </span><span style="color:#F07178;">url</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://dev.virtualearth.net</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">							   </span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">YourBingMapKey</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">							   </span><span style="color:#F07178;">mapStyle</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">BingMapsStyle</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">AERIAL</span></span>
<span class="line"><span style="color:#A6ACCD;">						   </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span><span style="color:#676E95;font-style:italic;">//亦可viewer.imageryLayers.addImageryProvider</span></span>
<span class="line"><span style="color:#A6ACCD;">								var imageryViewModels </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createDefaultImageryProviderViewModels</span><span style="color:#A6ACCD;">();</span><span style="color:#676E95;font-style:italic;">//选择不同的地图图层</span></span>
<span class="line"><span style="color:#A6ACCD;">								viewer.imageryLayers.addImageryProvider(imageryViewModels</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">].createProvider());</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// 加载地形系统</span></span>
<span class="line"><span style="color:#F07178;">      terrainProvider </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createWorldTerrain</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">								</span><span style="color:#F07178;">requestWaterMask </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">// 动态水纹</span></span>
<span class="line"><span style="color:#A6ACCD;">								</span><span style="color:#F07178;">requestVertexNormals</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#A6ACCD;">      </span><span style="color:#676E95;font-style:italic;">// 光效</span></span>
<span class="line"><span style="color:#A6ACCD;">							  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">viewer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">cesiumWidget</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">creditContainer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">style</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">display </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">none</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">//隐藏版权信息</span></span>
<span class="line"><span style="color:#A6ACCD;">viewer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">entities</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">add  </span><span style="color:#676E95;font-style:italic;">//点、标记、标签、线、模型、形状和物体\\</span></span>
<span class="line"><span style="color:#A6ACCD;">viewer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">trackedEntity </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> entity</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 镜头追踪，将镜头固定在对象上</span></span>
<span class="line"><span style="color:#A6ACCD;">viewer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">scene</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">globe</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">enableLighting</span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 阳光照射区域不高亮</span></span>
<span class="line"><span style="color:#A6ACCD;">viewer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">scene</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">debugShowFramesPerSecond </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">// 显示帧率</span></span>
<span class="line"><span style="color:#A6ACCD;">viewer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">scene</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">globe</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">depthTestAgainstTerrain </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 控制视角不转到地下（确保在地形后面的物体被正确地遮挡，只有最前端的对象可见）</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 初始化相机参数</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> initialOrientation </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">HeadingPitchRoll</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">fromDegrees</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">90</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> homeCameraView </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F07178;">destination</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Cartesian3</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">fromDegrees</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">114.29045969</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">30.56173526</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">40000</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F07178;">orientation</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">		</span><span style="color:#676E95;font-style:italic;">//Heading //想象再飞机头,左右方向的改变</span></span>
<span class="line"><span style="color:#89DDFF;">		</span><span style="color:#676E95;font-style:italic;">//Pitch //飞机头俯仰角度的改变</span></span>
<span class="line"><span style="color:#89DDFF;">		</span><span style="color:#676E95;font-style:italic;">//Roll //飞机身向左右翻滚</span></span>
<span class="line"><span style="color:#89DDFF;">		</span><span style="color:#676E95;font-style:italic;">//Range //距中心的距离，以米为单位。</span></span>
<span class="line"><span style="color:#89DDFF;">		</span><span style="color:#676E95;font-style:italic;">//HeadingPitchRange【目标物与相机之间的距离和角度】指的是目标物距离相机的距离、相机的垂直角度和水平角度</span></span>
<span class="line"><span style="color:#89DDFF;">		</span><span style="color:#676E95;font-style:italic;">//HeadingPitchRoll【相机的旋转角度】指的是相机在水平、垂直和平面的旋转角度。</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#F07178;">heading</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> initialOrientation</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">heading </span><span style="color:#676E95;font-style:italic;">//不知道设多少可以从控制台的camera.heading获取！！</span></span>
<span class="line"><span style="color:#A6ACCD;">		pitch: initialOrientation</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">pitch</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#F07178;">roll</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> initialOrientation</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">roll</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#A6ACCD;">viewer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">scene</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">camera</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setView</span><span style="color:#A6ACCD;">(homeCameraView) </span><span style="color:#676E95;font-style:italic;">// 设置初始视野视角</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//也可以重写 homeButton</span></span>
<span class="line"><span style="color:#A6ACCD;">viewer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">homeButton</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">viewModel</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">command</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">beforeExecute</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addEventListener</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">e</span><span style="color:#89DDFF;">)</span><span style="color:#C792EA;">=&gt;</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">cancel</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">viewer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">camera</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">flyTo</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">homeCameraView</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//viewer.zoomTo(tileset);//定位过去</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">viewer</span></span>
<span class="line"><span style="color:#A6ACCD;">	canvas</span></span>
<span class="line"><span style="color:#A6ACCD;">	scene</span></span>
<span class="line"><span style="color:#A6ACCD;">		globe</span></span>
<span class="line"><span style="color:#A6ACCD;">			ellipsoid</span></span>
<span class="line"><span style="color:#A6ACCD;">		camera</span></span>
<span class="line"><span style="color:#A6ACCD;">	entities</span></span>
<span class="line"><span style="color:#A6ACCD;">	clock</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Radian、Degree和Cartesian3数据类型的示例值：</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> Radian类型：</span></span>
<span class="line"><span style="color:#A6ACCD;">	  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> π：Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">PI</span></span>
<span class="line"><span style="color:#A6ACCD;">	  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> π</span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">：Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">PI_OVER_TWO</span></span>
<span class="line"><span style="color:#A6ACCD;">	  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> 2π：Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">TWO_PI</span></span>
<span class="line"><span style="color:#A6ACCD;">	  </span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> Degree类型：</span></span>
<span class="line"><span style="color:#A6ACCD;">	  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> 90度：Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toRadians</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">90</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> 45度：Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toRadians</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">45</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> 180度：Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toRadians</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">180</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	  </span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> Cartesian3类型：</span></span>
<span class="line"><span style="color:#A6ACCD;">	  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)：</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Cartesian3</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)：</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Cartesian3</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">)：</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Cartesian3</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">	其中，Radian类型表示弧度值，Degree类型表示角度值，Cartesian3类型表示三维笛卡尔坐标系中的点。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">获取当前视图中心的经纬度：</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> center </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> viewer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">camera</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">positionCartographic</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> longitude </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toDegrees</span><span style="color:#A6ACCD;">(center</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">longitude)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> latitude </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toDegrees</span><span style="color:#A6ACCD;">(center</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">latitude)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> height </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> center </span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">height</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	[longitude</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">latitude</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">height]</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">笛卡尔3转弧度 </span><span style="color:#676E95;font-style:italic;">//Cesium.Cartographic.fromCartesian(center)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> center </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> tileset</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">boundingSphere</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">center</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> cartographic </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Cartographic</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">fromCartesian</span><span style="color:#A6ACCD;">(center)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> longitude </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toDegrees</span><span style="color:#A6ACCD;">(cartographic</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">longitude)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> latitude </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toDegrees</span><span style="color:#A6ACCD;">(cartographic</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">latitude)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> height </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> cartographic</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">height</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	[longitude</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">latitude</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">height]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">弧度</span><span style="color:#A6ACCD;">(小数形式的经纬度)转经纬度</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> longitude </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toDegrees</span><span style="color:#A6ACCD;">(cartographic</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">longitude)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	  </span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> latitude </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toDegrees</span><span style="color:#A6ACCD;">(cartographic</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">latitude)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> height </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> cartographic</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">height</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">      [longitude</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">latitude</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">height] </span></span>
<span class="line"><span style="color:#A6ACCD;">      </span></span>
<span class="line"><span style="color:#A6ACCD;">笛卡尔3坐标转成经纬度</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;font-style:italic;">// 将笛卡尔坐标系转换为地理坐标系</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> cartographic </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> viewer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">scene</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">globe</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ellipsoid</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cartesianToCartographic</span><span style="color:#A6ACCD;">(笛卡尔3)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;font-style:italic;">// 获取经度和纬度</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> longitude </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toDegrees</span><span style="color:#A6ACCD;">(cartographic</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">longitude)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> latitude </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toDegrees</span><span style="color:#A6ACCD;">(cartographic</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">latitude)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> height</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">cartographic</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">height</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">     [longitude</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">latitude</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">height] </span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">完美修正拟合tileset的高度到地面上</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> cartographic </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Cartographic</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">fromCartesian</span><span style="color:#A6ACCD;">(tileset</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">boundingSphere</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">center)</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">//获得原始中心</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> surface </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Cartesian3</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">fromRadians</span><span style="color:#A6ACCD;">(cartographic</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">longitude</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">cartographic</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">latitude</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0.0</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> offset </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Cartesian3</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">fromRadians</span><span style="color:#A6ACCD;">(cartographic</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">longitude</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">cartographic</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">latitude</span><span style="color:#89DDFF;">,-</span><span style="color:#A6ACCD;">cartographic</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">height )</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">//减去高度      </span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> translation </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Cartesian3</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">subtract</span><span style="color:#A6ACCD;">(offset</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">surface</span><span style="color:#89DDFF;">,new</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Cartesian3</span><span style="color:#A6ACCD;">())</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">//计算偏移</span></span>
<span class="line"><span style="color:#A6ACCD;">      tileset</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">modelMatrix </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Matrix4</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">fromTranslation</span><span style="color:#A6ACCD;">(translation)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span></span>
<span class="line"><span style="color:#82AAFF;">根据geojson生成城市粗模</span><span style="color:#A6ACCD;">(多边形</span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;">拉伸高度即可)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#FFCB6B;">看https</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;font-style:italic;">//sandcastle.cesium.com/gallery/GeoJSON%20and%20TopoJSON.html</span></span>
<span class="line"><span style="color:#A6ACCD;">		  </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> promise </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">GeoJsonDataSource</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">load</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">XXX./geojson</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">          promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">dataSource</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#A6ACCD;">viewer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">dataSources</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">dataSource</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">              </span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">entities</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dataSource</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">entities</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">values</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">i</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">i</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">entities</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">++</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">entity</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">entities</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">i</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">                </span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">entity</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">polygon</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">extrudedHeight</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">entity</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">properties</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">geojson属性里的高度</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	设置颜色</span></span>
<span class="line"><span style="color:#A6ACCD;">	dataSource</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">entities</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">values</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">filter</span><span style="color:#A6ACCD;">(</span><span style="color:#A6ACCD;font-style:italic;">i</span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">includes</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">200_</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forEach</span><span style="color:#A6ACCD;">(</span><span style="color:#A6ACCD;font-style:italic;">i</span><span style="color:#C792EA;">=&gt;</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">	    </span><span style="color:#676E95;font-style:italic;">//dataSource.entities.remove(i)</span></span>
<span class="line"><span style="color:#F07178;">	    </span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">polygon</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">material</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Color</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">RED</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">withAlpha</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">0.5</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span></span>
<span class="line"><span style="color:#A6ACCD;">Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">CallbackProperty </span><span style="color:#676E95;font-style:italic;">//用回调函数传入time,用于处理随时间变化的属性,如随时间改变,位置属性改变</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">viewer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">scene</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">screenSpaceCameraController</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">inertiaZoom</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0.9</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//设置丝滑惯性缩放，默认0.8，越接近1惯性越大</span></span></code></pre></div><h2 id="向量" tabindex="-1">向量 <a class="header-anchor" href="#向量" aria-label="Permalink to &quot;向量&quot;">​</a></h2><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">一个平面可以由两个非平行的向量确定，而这两个向量的叉积即为法线向量</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">根据向量投影的定义，对于一个向量v和一个单位向量u，v在u方向上的投影向量proj_vu可以通过以下公式计算：</span></span>
<span class="line"><span style="color:#A6ACCD;">proj_vu </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">dot</span><span style="color:#A6ACCD;">(v</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> u) </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> u</span></span>
<span class="line"><span style="color:#82AAFF;">其中dot</span><span style="color:#A6ACCD;">(v</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> u)是v和u的点积，表示v在u方向上的投影长度，u是一个单位向量，表示u的长度为1，方向与投影方向相同。</span></span>
<span class="line"><span style="color:#A6ACCD;">在这个例子中，</span><span style="color:#82AAFF;">杯子的移动向量为向右的单位向量</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)，</span><span style="color:#82AAFF;">桌面法线向量为向上的单位向量</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)。根据上述公式，投影向量proj_right_up可以计算为：</span></span>
<span class="line"><span style="color:#A6ACCD;">proj_right_up </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">dot</span><span style="color:#A6ACCD;">((</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)) </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">	我不懂向量运算</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">dot</span><span style="color:#A6ACCD;">((</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)) </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">) 的具体计算过程是</span><span style="color:#89DDFF;">?</span></span>
<span class="line"><span style="color:#A6ACCD;">		首先，</span><span style="color:#82AAFF;">dot</span><span style="color:#A6ACCD;">((</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">))</span><span style="color:#82AAFF;">表示向量</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span><span style="color:#82AAFF;">和向量</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)的点积，也称为内积。点积的计算公式是将两个向量对应位置的数值相乘，然后将乘积相加，即：		</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#82AAFF;">dot</span><span style="color:#A6ACCD;">((</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)) </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">*</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">*</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">*</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">		</span></span>
<span class="line"><span style="color:#A6ACCD;">		所以，</span><span style="color:#82AAFF;">dot</span><span style="color:#A6ACCD;">((</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">))的结果为0。		</span></span>
<span class="line"><span style="color:#A6ACCD;">		接下来，</span><span style="color:#82AAFF;">我们将0乘以</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)。</span><span style="color:#82AAFF;">这个操作实际上是将向量</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)的每个分量都乘以0，</span><span style="color:#82AAFF;">得到的结果向量仍然是</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)本身。因此，		</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#82AAFF;">dot</span><span style="color:#A6ACCD;">((</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)) </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)		</span></span>
<span class="line"><span style="color:#A6ACCD;">		所以，</span><span style="color:#82AAFF;">这个计算的结果是</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)。		</span></span>
<span class="line"><span style="color:#A6ACCD;">		总结一下，这个计算的过程是：</span><span style="color:#82AAFF;">将向量</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span><span style="color:#82AAFF;">和向量</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)做点积，得到0，</span><span style="color:#82AAFF;">然后将0乘以向量</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)，</span><span style="color:#82AAFF;">得到的结果是</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)。</span></span></code></pre></div><h2 id="矩阵" tabindex="-1">矩阵 <a class="header-anchor" href="#矩阵" aria-label="Permalink to &quot;矩阵&quot;">​</a></h2><p><img src="`+o+`" alt=""></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">T如何移动一个点，举例矩阵相乘的详细步骤</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">假设有一个点P</span><span style="color:#A6ACCD;">(x</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> y</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> z)，现在想要将该点沿着X轴平移2个单位，沿着Y轴平移3个单位，沿着Z轴平移4个单位。可以使用变换矩阵来实现这个操作。变换矩阵可以表示为：	</span></span>
<span class="line"><span style="color:#A6ACCD;">	T </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">	    [</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">	    [</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">	    [</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">]	</span></span>
<span class="line"><span style="color:#A6ACCD;">	其中，第一列表示X轴的变换，第二列表示Y轴的变换，第三列表示Z轴的变换，最后一列表示平移向量。	</span></span>
<span class="line"><span style="color:#A6ACCD;">	现在，需要将点P应用该变换矩阵，以实现平移操作。可以按照以下步骤进行矩阵相乘：	</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">1.</span><span style="color:#A6ACCD;">  将点P表示为一个4维向量，即增加一个齐次坐标分量w</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">：	</span></span>
<span class="line"><span style="color:#A6ACCD;">	P</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> = [x]</span></span>
<span class="line"><span style="color:#A6ACCD;">	     [y]</span></span>
<span class="line"><span style="color:#A6ACCD;">	     [z]</span></span>
<span class="line"><span style="color:#A6ACCD;">	     [</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">]	</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">2.</span><span style="color:#A6ACCD;">  将变换矩阵T表示为一个4x4的矩阵：		</span></span>
<span class="line"><span style="color:#A6ACCD;">	T </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">	    [</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">	    [</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">	    [</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">]	</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">3.</span><span style="color:#A6ACCD;">  将点P</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">和变换矩阵T相乘，得到一个新的4维向量P</span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#C3E88D;">：		</span></span>
<span class="line"><span style="color:#A6ACCD;">	P</span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> T </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> P</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> = [1 0 0 2]   [x]</span></span>
<span class="line"><span style="color:#A6ACCD;">	               [</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> [y]</span></span>
<span class="line"><span style="color:#A6ACCD;">	               [</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;">]   [z]</span></span>
<span class="line"><span style="color:#A6ACCD;">	               [</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">]   [</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">]	</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">4.</span><span style="color:#A6ACCD;">  对于新的4维向量P</span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#A6ACCD;">，将其前三个分量（x</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> y</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> z）除以最后一个分量（w</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">），即可得到平移后的新点坐标：		</span></span>
<span class="line"><span style="color:#A6ACCD;">	x</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> = P</span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#C3E88D;">[0] / P</span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#C3E88D;">[3] = x + 2</span></span>
<span class="line"><span style="color:#A6ACCD;">	y</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> = P</span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#C3E88D;">[1] / P</span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#C3E88D;">[3] = y + 3</span></span>
<span class="line"><span style="color:#A6ACCD;">	z</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> = P</span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#C3E88D;">[2] / P</span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#C3E88D;">[3] = z + 4		</span></span>
<span class="line"><span style="color:#A6ACCD;">	综上，通过矩阵相乘的方式，可以将点P沿着X轴平移2个单位，沿着Y轴平移3个单位，沿着Z轴平移4个单位。</span></span>
<span class="line"><span style="color:#A6ACCD;">	这种方法非常高效，可以同时对多个点进行平移操作，而且可以方便地组合不同的变换操作。</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Matrix4要注意阅读顺序的问题</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;font-style:italic;">//不符合直觉的写法</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> v </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">		        </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">		        </span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">6</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">7</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">8</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">		        </span><span style="color:#F78C6C;">9</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">11</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">12</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">		        </span><span style="color:#F78C6C;">13</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">14</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">16</span></span>
<span class="line"><span style="color:#A6ACCD;">		        ]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> m </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Matrix4</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">fromArray</span><span style="color:#A6ACCD;">(v)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">		console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(m</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#A6ACCD;">())</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;font-style:italic;">//(1, 5, 9, 13)</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;font-style:italic;">//(2, 6, 10, 14)</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;font-style:italic;">//(3, 7, 11, 15)</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;font-style:italic;">//(4, 8, 12, 16)</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;font-style:italic;">//符合直觉的写法</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> v </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">		        </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">		        </span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">6</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">7</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">8</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">		        </span><span style="color:#F78C6C;">9</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">11</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">12</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">		        </span><span style="color:#F78C6C;">13</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">14</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">16</span></span>
<span class="line"><span style="color:#A6ACCD;">		        ]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> m </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Matrix4</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">fromRowMajorArray</span><span style="color:#A6ACCD;">(v)</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">//fromColumnMajorArray</span></span>
<span class="line"><span style="color:#A6ACCD;">		console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(m</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#A6ACCD;">())</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;font-style:italic;">//(1, 2, 3, 4)</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;font-style:italic;">//(5, 6, 7, 8)</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;font-style:italic;">//(9, 10, 11, 12)</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;font-style:italic;">//(13, 14, 15, 16)</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">缩放模板，将z轴值放大1</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">00002</span><span style="color:#A6ACCD;">，相当于向上移动了</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> v </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">1.0000</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1.0000</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1.00002</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1.0</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> m </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Matrix4</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">fromArray</span><span style="color:#A6ACCD;">(v)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  tileset</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">modelMatrix </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">cesium的tileset的modelMatix为</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">描述做了什么样的变化</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> 每行每列各有什么作用</span><span style="color:#89DDFF;">?</span></span>
<span class="line"><span style="color:#A6ACCD;">	(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">6378137</span><span style="color:#A6ACCD;">)</span><span style="color:#676E95;font-style:italic;">//因为1在第三个,所以作用于z轴,将模型的z轴（垂直于模型表面的轴）沿着地球的表面朝向正上方，即垂直于地球表面，同时将模型的原点移动到地球表面上，距离地心的距离为6378137米（地球半径）。</span></span>
<span class="line"><span style="color:#A6ACCD;">	(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span><span style="color:#676E95;font-style:italic;">//将模型的x轴（水平于模型表面的轴）指向地球上的经度为0度的位置，即 Greenwich 本初子午线。</span></span>
<span class="line"><span style="color:#A6ACCD;">	(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span><span style="color:#676E95;font-style:italic;">//将模型的y轴（与x、z轴垂直的轴）指向地球上的纬度为0度的位置，即赤道。</span></span>
<span class="line"><span style="color:#A6ACCD;">	(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">)</span><span style="color:#676E95;font-style:italic;">//不进行任何透视变换，即模型在投影到地球表面时大小不会发生变化。</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">这个矩阵如何作用于点</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">描述一下结果和计算过程</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">		</span></span>
<span class="line"><span style="color:#A6ACCD;">		首先，</span><span style="color:#82AAFF;">将点</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;">)表示为一个列向量：		</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">		接下来，将该向量与模型矩阵相乘，即：		</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">6378137</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> x </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span></span>
<span class="line"><span style="color:#A6ACCD;">		按照矩阵乘法的规则，可以将该计算分解为以下四个部分：		</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#F78C6C;">1.</span><span style="color:#A6ACCD;"> 第一列乘以向量的第一个元素：(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">6378137</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">12756274</span><span style="color:#A6ACCD;">)。		</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#F78C6C;">2.</span><span style="color:#A6ACCD;"> 第二列乘以向量的第二个元素：(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)。		</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#F78C6C;">3.</span><span style="color:#A6ACCD;"> 第三列乘以向量的第三个元素：(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)。		</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#F78C6C;">4.</span><span style="color:#A6ACCD;"> 最后一列乘以向量的第四个元素：(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">)。		</span></span>
<span class="line"><span style="color:#A6ACCD;">		将上述四个部分相加，得到最终的结果向量：		</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">12756274</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">         </span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">         </span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">         </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">		</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span></span>
<span class="line"><span style="color:#A6ACCD;">		因此，</span><span style="color:#82AAFF;">点</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;">)</span><span style="color:#82AAFF;">在该模型矩阵的作用下被转换为点</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">6.2756274e+06</span><span style="color:#A6ACCD;">)，位于地球表面上的一个点。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Matrix4</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">multiplyByMatrix3</span><span style="color:#A6ACCD;">(m</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> rotation</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> m);替代了Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Matrix4</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">multiply</span><span style="color:#A6ACCD;">(m</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Matrix4</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">fromRotationTranslation</span><span style="color:#A6ACCD;">(rotation)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> m);</span></span></code></pre></div><h3 id="坐标系" tabindex="-1">坐标系 <a class="header-anchor" href="#坐标系" aria-label="Permalink to &quot;坐标系&quot;">​</a></h3><p><img src="`+e+`" alt=""></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> 在左手坐标系中，“east”对应笛卡尔坐标系中的x轴，即东方向；“north”对应笛卡尔坐标系中的y轴，即北方向；“up”对应笛卡尔坐标系中的z轴，即垂直于地面向上的方向。</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> 在右手坐标系中，“east”对应笛卡尔坐标系中的x轴，即东方向；“north”对应笛卡尔坐标系中的y轴，即北方向；“up”则与笛卡尔坐标系中的z轴相反，即指向地心的方向。</span></span></code></pre></div><p><img src="`+t+`" alt=""></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Transforms</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">eastNorthUpToFixedFrame </span><span style="color:#676E95;font-style:italic;">//是回退变换, 在地球上，每个点都有一个本地坐标系，它是以该点为原点，以地球表面的法线方向为z轴建立的一个坐标系。然而，当我们需要在计算机中对地球上的点进行处理时，通常需要将这些点转换为一个固定的坐标系，方便进行计算和可视化。</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">eastNorthUp 坐标系主要用于处理经纬度和高度等地理信息数据</span><span style="color:#89DDFF;">/</span></span>
<span class="line"><span style="color:#A6ACCD;">	东北天坐标系（East</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">North</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">Up，ENU）是绿色的那个</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">是局部坐标系</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"># 垂直于当前地表的垂直坐标系</span></span>
<span class="line"><span style="color:#A6ACCD;">	固定坐标系（Fixed Frame）是蓝色的那个</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">是全局坐标系</span></span></code></pre></div><h3 id="quaternion-四元数" tabindex="-1">Quaternion 四元数 <a class="header-anchor" href="#quaternion-四元数" aria-label="Permalink to &quot;Quaternion 四元数&quot;">​</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">Cesium还提供了许多方便的函数来创建和操作四元数，</span><span style="color:#82AAFF;">如</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">fromAxisAngle</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">、</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">fromRotationMatrix</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">、</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">multiply</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">等。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Cesium中的四元数（Quaternion）可以使用以下公式进行计算：</span></span>
<span class="line"><span style="color:#A6ACCD;">q </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> w </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> xi </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> yj </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> zk</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">其中，</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">w</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">、</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">x</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">、</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">y</span><span style="color:#89DDFF;">\`</span><span style="color:#82AAFF;">和</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">z</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">是四元数的四个分量。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">在Cesium中，通常使用单位四元数来表示旋转，因此四元数的长度应该为1，即：</span></span>
<span class="line"><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">q</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">sqrt</span><span style="color:#A6ACCD;">(w</span><span style="color:#89DDFF;">^</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> x</span><span style="color:#89DDFF;">^</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> y</span><span style="color:#89DDFF;">^</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> z</span><span style="color:#89DDFF;">^</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">四元数的乘法运算可以使用以下公式进行计算：</span></span>
<span class="line"><span style="color:#A6ACCD;">q1 </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> q2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> (w1</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">w2 </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> x1</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">x2 </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> y1</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">y2 </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> z1</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">z2) </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> (w1</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">x2 </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> x1</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">w2 </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> y1</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">z2 </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> z1</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">y2)i </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> (w1</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">y2 </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> x1</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">z2 </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> y1</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">w2 </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> z1</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">x2)j </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> (w1</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">z2 </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> x1</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">y2 </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> y1</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">x2 </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> z1</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">w2)k</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">其中，</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">q1</span><span style="color:#89DDFF;">\`</span><span style="color:#82AAFF;">和</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">q2</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">是两个四元数，</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">*</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">表示乘法运算，</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">i</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">、</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">j</span><span style="color:#89DDFF;">\`</span><span style="color:#82AAFF;">和</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">k</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">是虚部系数。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">在上面的代码中，我们创建了一个绕 Z 轴旋转 </span><span style="color:#F78C6C;">45</span><span style="color:#A6ACCD;"> 度的四元数，代码如下：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> rotationQuaternion </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Quaternion</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">fromAxisAngle</span><span style="color:#A6ACCD;">(Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Cartesian3</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">UNIT_Z</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toRadians</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">45</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">这里我们使用了 </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">fromAxisAngle()</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> 方法来创建四元数。该方法接受两个参数：旋转轴和旋转角度（以弧度为单位）。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">其中，</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">Cesium.Cartesian3.UNIT_Z</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> 表示 Z 轴的单位向量，</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">Cesium.Math.toRadians(45)</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> 将角度值从度转换为弧度。因此，这行代码创建的四元数表示绕 Z 轴旋转 </span><span style="color:#F78C6C;">45</span><span style="color:#A6ACCD;"> 度的旋转。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">具体来说，它的四个分量值分别为：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">x</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#FFCB6B;">y</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#FFCB6B;">z</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.3826834323650898</span><span style="color:#A6ACCD;"> （等于 </span><span style="color:#82AAFF;">sin</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">45</span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">)）</span></span>
<span class="line"><span style="color:#FFCB6B;">w</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.9238795325112867</span><span style="color:#A6ACCD;"> （等于 </span><span style="color:#82AAFF;">cos</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">45</span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">)）</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">这个四元数可以用来对任何物体进行绕 Z 轴旋转 </span><span style="color:#F78C6C;">45</span><span style="color:#A6ACCD;"> 度的变换操作。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">在四元数中，</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">w</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> 分量也称为实部或标量部分，而 </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">x</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">、</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">y</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> 和 </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">z</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> 分量则称为虚部或向量部分。一个四元数可以表示为：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">q </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> w </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> xi </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> yj </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> zk</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">其中，</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">i</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">、</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">j</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> 和 </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">k</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> 是虚部的基本单位向量。在 Cesium 中，我们通常使用 </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">x</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">、</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">y</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> 和 </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">z</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> 来表示虚部。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">当使用 </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">Cesium.Quaternion.fromAxisAngle()</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> 方法创建一个四元数时，旋转轴和旋转角度的正弦余弦值用于计算虚部的分量（即 </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">x</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">、</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">y</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> 和 </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">z</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">）。而 </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">w</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> 分量的值等于旋转角度一半的余弦值。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">这是因为四元数中的</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">w</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">分量与向量部分相乘后得到的是一个旋转的余弦值，而余弦值就是旋转矩阵中对角线上的元素之和的一半。所以，将余弦值除以2，就可以得到四元数的 </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">w</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> 分量。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">同时，根据四元数的定义，每个四元数都应该满足其范数为1。通过简单的代数运算可以证明，如果虚部的长度为1，则实部的平方加上虚部的平方和应该等于1。因此，如果我们将旋转角度一半的余弦值作为实部，那么虚部的长度就应该等于旋转角度一半的正弦值。这样，我们就可以保证四元数的范数为1。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">w </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">cos</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">45</span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">) ≈ </span><span style="color:#F78C6C;">0.9239</span></span>
<span class="line"><span style="color:#A6ACCD;">x </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> y </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#A6ACCD;">z </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">sin</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">45</span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">) ≈ </span><span style="color:#F78C6C;">0.3827</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">因此，这个四元数可以表示为 </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">(0, 0, 0.3827, 0.9239)</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">从几何角度来看，这个四元数表示绕 Z 轴旋转 </span><span style="color:#F78C6C;">45</span><span style="color:#A6ACCD;"> 度的旋转。如果我们将其转换成旋转矩阵，则可以得到：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">[ </span><span style="color:#82AAFF;">cos</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">45</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">-</span><span style="color:#82AAFF;">sin</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">45</span><span style="color:#A6ACCD;">)   </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> ]</span></span>
<span class="line"><span style="color:#A6ACCD;">[ </span><span style="color:#82AAFF;">sin</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">45</span><span style="color:#A6ACCD;">)  </span><span style="color:#82AAFF;">cos</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">45</span><span style="color:#A6ACCD;">)   </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> ]</span></span>
<span class="line"><span style="color:#A6ACCD;">[    </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">        </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">这是一个绕 Z 轴旋转 </span><span style="color:#F78C6C;">45</span><span style="color:#A6ACCD;"> 度的旋转矩阵。我们可以看到，对角线上的元素之和为 </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">cos(45) + cos(45) = 2cos(45/2)^2</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">，即四元数中的 </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">w</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> 分量的平方。因此，实际上，四元数中的 </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">w</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> 分量等于旋转矩阵中对角线元素之和的一半的平方根，也就是旋转角度一半的余弦值。</span></span></code></pre></div><h3 id="为什么将变换矩阵中的前三行设置为局部坐标系的三个方向向量-第四行设置为-origin。我们就得到了一个将本地参考系中的向量转换为椭球体固定参考系中的向量的变换矩阵。" tabindex="-1">为什么将变换矩阵中的前三行设置为局部坐标系的三个方向向量，第四行设置为 origin。我们就得到了一个将本地参考系中的向量转换为椭球体固定参考系中的向量的变换矩阵。 <a class="header-anchor" href="#为什么将变换矩阵中的前三行设置为局部坐标系的三个方向向量-第四行设置为-origin。我们就得到了一个将本地参考系中的向量转换为椭球体固定参考系中的向量的变换矩阵。" aria-label="Permalink to &quot;为什么将变换矩阵中的前三行设置为局部坐标系的三个方向向量，第四行设置为 origin。我们就得到了一个将本地参考系中的向量转换为椭球体固定参考系中的向量的变换矩阵。&quot;">​</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">对于任意一个在局部坐标系中的向量 v，都可以通过以下方式将其转换为椭球体固定参考系中的向量：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">v_global = M * (v_local - origin)</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">其中，</span></span>
<span class="line"><span style="color:#A6ACCD;">M 表示我们构建的变换矩阵，</span></span>
<span class="line"><span style="color:#A6ACCD;">v_local 表示在局部坐标系中表示的向量，</span></span>
<span class="line"><span style="color:#A6ACCD;">v_global 表示在椭球体固定参考系中表示的向量。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">这个式子的含义是：</span></span>
<span class="line"><span style="color:#A6ACCD;">首先将 v_local 减去 origin，得到相对于局部坐标系原点的偏移量；</span></span>
<span class="line"><span style="color:#A6ACCD;">然后用变换矩阵 M 将这个偏移量转换为椭球体固定参考系中的向量。</span></span>
<span class="line"><span style="color:#A6ACCD;">最终得到的 v_global 就是我们要求的结果。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">因此，将变换矩阵中的前三行设置为局部坐标系的三个方向向量，第四行设置为 origin，就可以构建一个能够将本地参考系中的向量转换为椭球体固定参考系中的向量的变换矩阵。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">可以代入一个最简单的实际例子让我更容易看懂吗</span></span>
<span class="line"><span style="color:#A6ACCD;">	假设有一个位于地球表面上的点 P，</span><span style="color:#82AAFF;">其经纬度坐标分别为</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">40.0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">120.0</span><span style="color:#A6ACCD;">)，高度为 </span><span style="color:#F78C6C;">1000</span><span style="color:#A6ACCD;"> 米。现在我们想将 P 的坐标转换到一个以赤道为 XY 平面、以北极为 Z 轴的固定参考系中。</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	首先，需要通过经纬度坐标计算出 P 点所在的地心位置坐标。这个过程可以用一些地理工具库来实现，不过这里不展开讲解了。</span><span style="color:#82AAFF;">假设我们得到的地心位置坐标为</span><span style="color:#A6ACCD;"> (x</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">y</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">z) </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">4000</span><span style="color:#A6ACCD;"> km</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3000</span><span style="color:#A6ACCD;"> km</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5000</span><span style="color:#A6ACCD;"> km)，那么 P 点在地球表面的位置就可以表示为：</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	P_local </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">1000</span><span style="color:#A6ACCD;"> m</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> m</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> m)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	其中，P_local 表示相对于地心的局部坐标系中的位置向量。</span><span style="color:#82AAFF;">我们将其设置为</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">1000</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)，是因为 P 点的高度为 </span><span style="color:#F78C6C;">1000</span><span style="color:#A6ACCD;"> 米，且位于经度为 </span><span style="color:#F78C6C;">120</span><span style="color:#A6ACCD;"> 度的地球表面上，也就是东经 </span><span style="color:#F78C6C;">120</span><span style="color:#A6ACCD;"> 度的交点处，因此它相对于经线和纬线交点的偏移量应该是东向 </span><span style="color:#F78C6C;">1000</span><span style="color:#A6ACCD;"> 米，北向 </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> 米，垂直于地球表面的距离为 </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> 米。</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	接下来，需要构建一个从局部坐标系到全局坐标系的变换矩阵。在这个例子中，全局坐标系应该是以赤道为 XY 平面、以北极为 Z 轴的坐标系。根据上面提到的步骤，我们可以先计算出相对于 P 点的东向、北向和垂直于地球表面的向上的三个单位向量。具体来说，可以用以下式子计算它们：</span></span>
<span class="line"><span style="color:#A6ACCD;">	scratchThirdCartesian </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">normalize</span><span style="color:#A6ACCD;">(P_local)</span></span>
<span class="line"><span style="color:#A6ACCD;">	scratchFirstCartesian </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">normalize</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">cross</span><span style="color:#A6ACCD;">([</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> scratchThirdCartesian))</span></span>
<span class="line"><span style="color:#A6ACCD;">	scratchSecondCartesian </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">cross</span><span style="color:#A6ACCD;">(scratchThirdCartesian</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> scratchFirstCartesian)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	其中，normalize 表示将向量归一化，cross 表示向量的叉积。由于我们已经知道了 P 点的经纬度坐标，因此也就知道了 scratchThirdCartesian 这个向量（它指向地球表面的法线方向），可以通过简单的几何计算得到 scratchFirstCartesian 和 scratchSecondCartesian。</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	最后，将 scratchFirstCartesian、scratchSecondCartesian 和 scratchThirdCartesian 作为变换矩阵的前三行，P_local 作为变换矩阵的第四行，就得到了局部坐标系到全局坐标系的变换矩阵 M。具体来说，变换矩阵的元素可以表示为：</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	M </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [ scratchFirstCartesian</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">x    scratchSecondCartesian</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">x    scratchThirdCartesian</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">x    P_local</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">x ]</span></span>
<span class="line"><span style="color:#A6ACCD;">	    [ scratchFirstCartesian</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">y    scratchSecondCartesian</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">y    scratchThirdCartesian</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">y    P_local</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">y ]</span></span>
<span class="line"><span style="color:#A6ACCD;">	    [ scratchFirstCartesian</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">z    scratchSecondCartesian</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">z    scratchThirdCartesian</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">z    P_local</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">z ]</span></span>
<span class="line"><span style="color:#A6ACCD;">	    [           </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">                        </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">                          </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">                    </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">        ]</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	其中，</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">x、</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">y、</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">z 表示向量的 x、y、z 分量。这个变换矩阵可以将局部坐标系中的向量 P_local 转换为全局坐标系中的向量 P_global：</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	P_global </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> M </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> (P_local </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> origin) </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> M </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> P_local</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	由于 origin 在本例中为零向量，因此可以简化计算。最终得到的 P_global 就是 P 点相对于赤道</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">北极坐标系的位置向量。</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	希望上面的解释已经让你对这个函数有了更深入的理解。下面来继续解释一下最后的部分。</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	在本例中，origin 表示局部坐标系原点的位置向量，也就是 P 点在地心参考系中的位置向量。根据前面的假设，P 点的高度为 </span><span style="color:#F78C6C;">1000</span><span style="color:#A6ACCD;"> 米，因此 origin 的长度为：</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">length</span><span style="color:#A6ACCD;">(origin) </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">sqrt</span><span style="color:#A6ACCD;">(x</span><span style="color:#89DDFF;">^</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> y</span><span style="color:#89DDFF;">^</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> z</span><span style="color:#89DDFF;">^</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">7453.05</span><span style="color:#A6ACCD;"> km</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	由于 origin 在本例中为零向量，所以可以简化计算，得到以下式子：</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	P_global </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> M </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> P_local</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	其中，M 是变换矩阵，P_local 是相对于 origin 的 P 点在局部坐标系中的表示。具体来说，P_local 可以表示为：</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	P_local </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> P </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> origin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">1000</span><span style="color:#A6ACCD;"> m</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> m</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> m) </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">4000</span><span style="color:#A6ACCD;"> km</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3000</span><span style="color:#A6ACCD;"> km</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5000</span><span style="color:#A6ACCD;"> km)</span></span>
<span class="line"><span style="color:#A6ACCD;">	        </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">3999999</span><span style="color:#A6ACCD;"> m</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">3000000</span><span style="color:#A6ACCD;"> m</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">4999000</span><span style="color:#A6ACCD;"> m)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	将 P_local 代入变换矩阵中，得到：</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	P_global </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> M </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> P_local</span></span>
<span class="line"><span style="color:#A6ACCD;">	         </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [ scratchFirstCartesian</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">x    scratchSecondCartesian</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">x    scratchThirdCartesian</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">x    P_local</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">x ]   [ </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">3999999</span><span style="color:#A6ACCD;"> ]</span></span>
<span class="line"><span style="color:#A6ACCD;">	           [ scratchFirstCartesian</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">y    scratchSecondCartesian</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">y    scratchThirdCartesian</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">y    P_local</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">y ] </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> [ </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">3000000</span><span style="color:#A6ACCD;"> ]</span></span>
<span class="line"><span style="color:#A6ACCD;">	           [ scratchFirstCartesian</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">z    scratchSecondCartesian</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">z    scratchThirdCartesian</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">z    P_local</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">z ]   [ </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">4999000</span><span style="color:#A6ACCD;"> ]</span></span>
<span class="line"><span style="color:#A6ACCD;">	           [           </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">                        </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">                              </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">                </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">        ]   [     </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">    ]</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	         </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [ </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">2971.03</span><span style="color:#A6ACCD;"> ]</span></span>
<span class="line"><span style="color:#A6ACCD;">	           [ </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">7607.76</span><span style="color:#A6ACCD;"> ]</span></span>
<span class="line"><span style="color:#A6ACCD;">	           [  </span><span style="color:#F78C6C;">5701.89</span><span style="color:#A6ACCD;"> ]</span></span>
<span class="line"><span style="color:#A6ACCD;">	           [     </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">    ]</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	因此，P 点相对于赤道</span><span style="color:#89DDFF;">-</span><span style="color:#82AAFF;">北极坐标系的位置向量为</span><span style="color:#A6ACCD;"> (X</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">Y</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">Z) </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">2971.03</span><span style="color:#A6ACCD;"> m</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">7607.76</span><span style="color:#A6ACCD;"> m</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5701.89</span><span style="color:#A6ACCD;"> m)。</span></span></code></pre></div><h2 id="概念" tabindex="-1">概念 <a class="header-anchor" href="#概念" aria-label="Permalink to &quot;概念&quot;">​</a></h2><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">与ClampToGround不同，clampToHeight属性允许您将对象放置在地球表面之上或之下的指定高度</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;font-style:italic;">//clampToHeight属性通常用于放置对象，例如气球、无人机或飞行器等，这些对象需要在指定的高度上悬停或飞行</span></span></code></pre></div><h2 id="相机" tabindex="-1">相机 <a class="header-anchor" href="#相机" aria-label="Permalink to &quot;相机&quot;">​</a></h2><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">鼠标选转的其实是整个场景或者宇宙</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> 而不是相机</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">如果将相机viewer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">camera</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">lookRight</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;">)偏移开</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">在再怎么旋转也看不到地球</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> transform </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Transforms</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">eastNorthUpToFixedFrame</span><span style="color:#A6ACCD;">(点)</span><span style="color:#676E95;font-style:italic;">//根据传入的点坐标生成以该点为中心，x轴指向正东、y轴指向正北、z轴指向地表法线方向的右手笛卡尔坐标系</span></span>
<span class="line"><span style="color:#A6ACCD;">camera</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">lookAtTransform</span><span style="color:#A6ACCD;">(transform</span><span style="color:#89DDFF;">,</span><span style="color:#676E95;font-style:italic;">/*相机相对点的位置*/</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Cartesian3</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">120000.0</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">//让相机以该点为中心,而不是地心</span></span>
<span class="line"><span style="color:#A6ACCD;">camera</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">position</span><span style="color:#676E95;font-style:italic;">//相对于transform的位置</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">在 Cesium 中，</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">camera.*WC</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> 表示相机的属性在世界坐标系中的值。具体来说，</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">camera</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> 是 </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">Viewer</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> 对象中的一个属性，用于表示当前的相机状态。</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">camera.*WC</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> 中的 </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">*</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> 可以是以下几个属性：</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">positionWC</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">：相机在世界坐标系中的位置，即相机在地球表面上的位置。相对于地心的位置</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">取位置转经纬度要取这个</span><span style="color:#89DDFF;">!!!!!!!!!!</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">directionWC</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">：相机在世界坐标系中的方向向量，即相机从当前位置朝向的方向。</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">upWC</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">：相机在世界坐标系中的上向量，即相机坐标系的 y 轴方向在世界坐标系中的方向。</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">rightWC</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">：相机在世界坐标系中的右向量，即相机坐标系的 x 轴方向在世界坐标系中的方向。</span></span></code></pre></div><p><img src="`+c+`" alt=""></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">Ion使用Durandal开发</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">https</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;font-style:italic;">//ion.cesium.com/main.js</span></span>
<span class="line"><span style="color:#A6ACCD;">	是一个基于 Knockout</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js 和 RequireJS 的前端 MVVM 框架</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">用来开发SPA。</span></span>
<span class="line"><span style="color:#A6ACCD;">	Durandal 的核心思想是模块化和组件化，它通过模块化的方式管理应用程序的各个部分，并且提供了一个强大的组件系统，可以让开发者轻松地构建可重用的 UI 组件。</span></span>
<span class="line"><span style="color:#A6ACCD;">	durandal</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">activator	</span></span>
<span class="line"><span style="color:#A6ACCD;">		Durandal 提供了一个名为 Activator 的工具，它用于管理 ViewModel 的生命周期。</span></span>
<span class="line"><span style="color:#A6ACCD;">		Activator 可以帮助开发者创建和销毁 ViewModel 实例，并且提供了一组方法，用于激活和停用 ViewModel 实例。	</span></span>
<span class="line"><span style="color:#A6ACCD;">		Activator 的主要作用是实现 ViewModel 的惰性加载和缓存，它可以在需要时动态地创建 ViewModel 实例，在不需要时销毁实例，并且可以缓存已经创建的实例，以提高性能和减少资源消耗。</span></span>
<span class="line"><span style="color:#A6ACCD;">		Activator 还提供了一些事件和钩子函数，可以让开发者在 ViewModel 的生命周期中执行一些自定义逻辑。</span></span>
<span class="line"><span style="color:#A6ACCD;">		例如：</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> MyViewModel </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">			  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">displayName</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Hello, Durandal!</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;">};</span><span style="color:#A6ACCD;">		</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> activator </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">DurandalActivator</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> viewModel </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> activator</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#A6ACCD;">(MyViewModel)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;font-style:italic;">// 激活 ViewModel</span></span>
<span class="line"><span style="color:#A6ACCD;">			activator</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">activate</span><span style="color:#A6ACCD;">(viewModel)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">		</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;font-style:italic;">// 停用 ViewModel</span></span>
<span class="line"><span style="color:#A6ACCD;">			activator</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">deactivate</span><span style="color:#A6ACCD;">(viewModel)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	路由匹配</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#FFCB6B;">https</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;font-style:italic;">//ion.cesium.com/tilesetLocationEditor/1626609</span></span>
<span class="line"><span style="color:#A6ACCD;">		到了tilesetLocationEditor</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> 到了TilesetTransformEditor</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">define</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Views/TilesetTransformEditor/TilesetTransformEditor 48250</span></span>
<span class="line"><span style="color:#A6ACCD;">		调用了它的activate方法</span><span style="color:#676E95;font-style:italic;">//\`activate\`函数是Durandal中一个最常用的生命周期钩子函数，它会在路由激活时执行			</span></span>
<span class="line"><span style="color:#A6ACCD;">			const v </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">D</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">48440</span><span style="color:#F07178;"> TransformEditor		</span></span>
<span class="line"><span style="color:#F07178;">	</span></span>
<span class="line"><span style="color:#F07178;">https</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;font-style:italic;">//ion.cesium.com/ThirdParty/@cesiumgs/cesium-analytics/Cesium.js</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Ja</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">182222</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">TransformEditorViewModel</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#FFCB6B;">jA</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prototype</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">handleLeftDown</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">182153</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">TranslationEditor</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">	</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">transformEditor</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">TransformEditor</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">TransformEditorViewModel</span><span style="color:#89DDFF;">/</span><span style="color:#82AAFF;">TranslationEditor</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      container</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">viewer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">container</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      scene</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">viewer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">scene</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      transform</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">tileset</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">modelMatrix</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      boundingSphere</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">tileset</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">boundingSphere</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      originOffset</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">tileset</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">boundingSphere</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">center</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// 可选, 是控件的原点偏移量cartesian值,</span></span>
<span class="line"><span style="color:#89DDFF;">	      </span><span style="color:#676E95;font-style:italic;">//TranslationEditor.prototype.update时</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 根据transform, 如果在地球球心即0,0,0 则将其移动到地球表面,也就是移动一个地球半径即z轴+6378137米</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">TranslationEditor</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prototype</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">handleLeftDown获得offset</span></span>
<span class="line"><span style="color:#FFCB6B;">TranslationEditor</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prototype</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">handleMouseMove改变transform为moveVector</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">offset</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//更新控件位置, 基于transform和设置的控件偏移originOffset</span></span>
<span class="line"><span style="color:#FFCB6B;">TranslationEditor</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prototype</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">update</span></span></code></pre></div><h2 id="viewer-entities-add和scene-primitives-add的区别" tabindex="-1">viewer.entities.add和scene.primitives.add的区别 <a class="header-anchor" href="#viewer-entities-add和scene-primitives-add的区别" aria-label="Permalink to &quot;viewer.entities.add和scene.primitives.add的区别&quot;">​</a></h2><p>Cesium 中的 Primitive 和 Entity 都是用于在地图上显示图形、模型和其他可视化对象的抽象概念。</p><p>主要区别在于，Primitive 是一种基本图形结构，用于表示几何形状或集合，例如点、线或多边形等。您可以直接访问和修改 <code>primitive</code> 对象，从而控制其外观和行为。但是，在使用 Primitive 时需要编写更多的代码来控制其细节。</p><p>Entity 是一种高级图形结构，它提供了一种简单的方法来添加和更新与时间和空间有关的元数据（例如位置，方向和速度）以及任意数量的属性（例如名称、详细信息和样式）。</p><p>创建 Primitive 需要更多的代码，并且需要精细控制其样式和行为。而对于 Entity，只需提供一组初始化参数，并将其添加到场景中即可方便地更新其状态和外观。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">scene</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">groundPrimitives</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//地面Primitive可以使图元沿着地球表面平铺，并且可以用于创建地面网格、地形剖面或其他需要沿着地球曲面分布的图元。 Ground Primitives 的渲染效率比常规 Primitive 高，因为它们不需要进行深度测试，而且可以通过强制将对象沿着地球曲面绘制来减少过程中的计算量。</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">GroundPrimitive</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#F07178;">geometryInstances</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">GeometryInstance</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		  </span><span style="color:#F07178;">geometry</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">PolygonGeometry</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#F07178;">polygonHierarchy</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">positions</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> positions </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#F07178;">textureCoordinates</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> textureCoordinates</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">		  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#F07178;">appearance</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">EllipsoidSurfaceAppearance</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		  </span><span style="color:#F07178;">aboveGround</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">		  </span><span style="color:#F07178;">material</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Material</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#F07178;">fabric</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">			  </span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Image</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">			  </span><span style="color:#F07178;">uniforms</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">				</span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">../images/Cesium_Logo_Color.jpg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">			  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">		  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#F07178;">classificationType</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ClassificationType</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">TERRAIN</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">viewer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">entities</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> position</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">height</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toFixed</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">position</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> ellipsoid</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cartographicToCartesian</span><span style="color:#A6ACCD;">(position)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">billboard</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F07178;">verticalOrigin</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">VerticalOrigin</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">BOTTOM</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F07178;">scale</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.7</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">../images/facility.gif</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">label</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F07178;">text</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> position</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">height</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toFixed</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F07178;">font</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">10pt monospace</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F07178;">horizontalOrigin</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">HorizontalOrigin</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">CENTER</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F07178;">pixelOffset</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Cartesian2</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">14</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F07178;">fillColor</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Color</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">BLACK</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F07178;">outlineColor</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Color</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">BLACK</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F07178;">showBackground</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F07178;">backgroundColor</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Color</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">0.9</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.9</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.9</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.7</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F07178;">backgroundPadding</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Cartesian2</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h2 id="drawcommand-的-渲染的通道-pass" tabindex="-1">DrawCommand 的 渲染的通道 pass <a class="header-anchor" href="#drawcommand-的-渲染的通道-pass" aria-label="Permalink to &quot;DrawCommand 的 渲染的通道 pass&quot;">​</a></h2><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> drawCommand </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">DrawCommand</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">boundingVolume</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> primitive</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">boundingSphere</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">modelMatrix</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> primitive</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">modelMatrix</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">pass</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Pass</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">OPAQUE</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">shaderProgram</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> shaderProgram</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">renderState</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> renderState</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">vertexArray</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> vertexArray</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">count</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> indexCount</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">primitiveType</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">PrimitiveType</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">TRIANGLES</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">uniformMap</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> uniformMap</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  primitive</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">drawCommand </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> drawCommand</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">pass表示渲染过程中的通道，主要用于渲染优化。在Cesium中，渲染过程会被划分为不同的通道，每个通道都会对场景中的物体进行不同的处理，比如：深度测试、透明度排序、光照计算等。不同的通道之间可能会有依赖关系，想要在正确的顺序下进行渲染，就需要指定正确的pass。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">在这段代码中，pass指定为OPAQUE不透明的通道。这意味着所有不透明的物体（无论是地形、建筑、树木等）都会在这个通道中被渲染。这是渲染的第一个基础阶段，所有不透明的像素（即alpha小于1）都会被绘制。</span></span></code></pre></div><p><img src="`+r+'" alt=""><img src="'+C+`" alt=""></p><h2 id="着色器源码" tabindex="-1">着色器源码 <a class="header-anchor" href="#着色器源码" aria-label="Permalink to &quot;着色器源码&quot;">​</a></h2><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#A6ACCD;">着色器程序使用原始 GLSL 源代码作为key进行缓存，以减少为初始化和使用着色器而进行的 WebGL 调用次数。</span></span>
<span class="line"><span style="color:#A6ACCD;">执行命令</span></span>
<span class="line"><span style="color:#A6ACCD;">	使用Context</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">draw执行命令 ，其中	</span></span>
<span class="line"><span style="color:#A6ACCD;">		如果它与上一个命令不同，则绑定帧缓冲区。</span></span>
<span class="line"><span style="color:#A6ACCD;">		应用与先前命令不同的渲染状态。由于渲染状态是不可变且被缓存的，所以可以通过比较前一个和当前的渲染状态，找到两者之间不同的部分，然后只设置这些不同的部分，而不是全部重新设置一遍渲染状态，这样可以提高效率。因此，会生成一个函数，这个函数只会设置发生了更改的状态，而不会重复设置已经存在且没有更改的状态。</span></span>
<span class="line"><span style="color:#A6ACCD;">		绑定着色器程序（并在需要时编译</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">链接它）并设置更改的制服，包括 Cesium 的AutomaticUniforms。</span></span>
<span class="line"><span style="color:#A6ACCD;">		绑定顶点数组并发出 drawElements 或 drawArrays。</span></span>
<span class="line"><span style="color:#A6ACCD;">		在每一帧结束时，  Context</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">endFrame 通过解除绑定着色器程序、帧缓冲区、绘图缓冲区和纹理来清理状态。这有助于减少渲染器在每次命令执行之间管理的状态量。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">czm_material结构体包含以下属性：</span></span>
<span class="line"><span style="color:#F78C6C;">1.</span><span style="color:#A6ACCD;"> diffuse：散射光线对材质表面的影响，均匀地在所有方向上散射。</span></span>
<span class="line"><span style="color:#F78C6C;">2.</span><span style="color:#A6ACCD;"> specular：镜面反射的强度。</span></span>
<span class="line"><span style="color:#F78C6C;">3.</span><span style="color:#A6ACCD;"> shininess：镜面反射的锐度。数值越大，反射高光区域越小，锐度越高。</span></span>
<span class="line"><span style="color:#F78C6C;">4.</span><span style="color:#A6ACCD;"> normal：表面法线在眼空间中的方向。用于实现法线映射等效果。如果没有被修改，则默认为表面的法线方向。</span></span>
<span class="line"><span style="color:#F78C6C;">5.</span><span style="color:#A6ACCD;"> emission：材质发射的均匀光源。</span><span style="color:#82AAFF;">默认为vec3</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">0.0</span><span style="color:#A6ACCD;">)，即不发出任何光线。</span></span>
<span class="line"><span style="color:#F78C6C;">6.</span><span style="color:#A6ACCD;"> alpha：该材质的透明度。0</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">0表示完全透明，1</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">0表示完全不透明。</span></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">AutomaticUniforms </span></span>
<span class="line"><span style="color:#A6ACCD;">	是cesium内置的 GLSL Uniform</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> 指的是以czm_开头的变量。这些变量可以在shader中直接使用，无需手动传递。</span></span>
<span class="line"><span style="color:#A6ACCD;">	包括光照信息（如 czm_lightColor、czm_sunDirectionEC 等）、视锥体信息、时间、相机位置、视口大小等。</span></span>
<span class="line"><span style="color:#A6ACCD;">	ShaderProgram 中，会先区分哪些是需要手动更新的 Uniform 变量，哪些是自动更新的 Uniform 变量，</span></span>
<span class="line"><span style="color:#A6ACCD;">		continueDraw中执行shaderProgram</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_setUniforms</span></span>
<span class="line"><span style="color:#A6ACCD;">			ShaderProgram 的 _setUniforms 执行所有 uniforms 的 WebGL 设置，这其中就会进行自动刷新</span></span></code></pre></div><h2 id="杂" tabindex="-1">杂 <a class="header-anchor" href="#杂" aria-label="Permalink to &quot;杂&quot;">​</a></h2><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">ArcType</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">RHUMB</span></span>
<span class="line"><span style="color:#A6ACCD;">	RHUMB 是弧线类型之一，用于创建在两个点之间呈现为大圆航线的分段线。RHUMB 弧线不遵循大圆弧规则，但对于长距离导航来说，它通常比标准的直接线更符合实际情况，因为它能够绕过地球转折的曲面造成的略微偏转。</span></span></code></pre></div><p><a href="http://marsgis.cn/doc/study-cesium.pdf" target="_blank" rel="noreferrer">marsgis的study-cesium.pdf</a></p><ol><li>dae转gltf转换:<a href="https://qithub.com/KhronosGroup/COLLADA2GLTF" target="_blank" rel="noreferrer">https://qithub.com/KhronosGroup/COLLADA2GLTF</a></li><li>obj转gltf转换:<a href="https://qithub.com/AnalyticalGraphicsInc/obi2gltf" target="_blank" rel="noreferrer">https://qithub.com/AnalyticalGraphicsInc/obi2gltf</a></li><li>或 <a href="https://github.com/PrincessGod/objTo3d-tiles" target="_blank" rel="noreferrer">https://github.com/PrincessGod/objTo3d-tiles</a></li><li>或 <a href="https://github.com/fanvanzh/3DTiles" target="_blank" rel="noreferrer">https://github.com/fanvanzh/3DTiles</a></li><li>gltf内部优化处理: <a href="https://github.com/AnalyticalGraphicsInc/altf-pipeline" target="_blank" rel="noreferrer">https://github.com/AnalyticalGraphicsInc/altf-pipeline</a></li></ol><h2 id="cdn" tabindex="-1">CDN <a class="header-anchor" href="#cdn" aria-label="Permalink to &quot;CDN&quot;">​</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">https://cesium.com/downloads/cesiumjs/releases/1.104/Build/Cesium/Cesium.js</span></span>
<span class="line"><span style="color:#FFCB6B;">https://cesium.com/downloads/cesiumjs/releases/1.104/Build/CesiumUnminified/Cesium.js</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#FFCB6B;">200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://cesium.com/downloads/cesiumjs/releases/1.104/Build/CesiumUnminified/Assets/approximateTerrainHeights.json</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#676E95;font-style:italic;">#404 https://cesium.com/downloads/cesiumjs/releases/1.104/Build/CesiumUnminified/Widgets/widgets.css</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#676E95;font-style:italic;">#404 https://cesium.com/downloads/cesiumjs/releases/1.104/Build/CesiumUnminified/Widgets/Images/ImageryProviders/bingAerial.png</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#FFCB6B;">要设置</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">window.CESIUM_BASE_URL</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://cesium.com/downloads/cesiumjs/releases/1.104/Build/Cesium</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">才能解决404</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">https://cdn.bootcdn.net/ajax/libs/cesium/1.104.0/Cesium.js</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">https://unpkg.com/cesium@1.104.0/Build/CesiumUnminified/Cesium.js</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#浏览https://unpkg.com/browse/cesium@1.104.0/Build/CesiumUnminified/Cesium.js</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Cesium</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://esm.sh/cesium@1.104.0</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">或</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">es-module-shims配合importmap导入https://ga.jspm.io/npm:cesium@1.105.1/Source/Cesium.js使用</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#FFCB6B;">在jspm.io官网自动生成:</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">script</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">type=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">importmap</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">		 </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">&quot;imports&quot;</span><span style="color:#82AAFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">cesium</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://ga.jspm.io/npm:cesium@1.105.1/Source/Cesium.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">},</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">scopes</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{...}</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">}</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">/script&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">默认情况下，JSPM</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">支持jspm.io、nodemodules、esm.sh、denoland、unpkg、skypack和jsdelivr包提供程序</span></span></code></pre></div><h2 id="兼容性" tabindex="-1">兼容性 <a class="header-anchor" href="#兼容性" aria-label="Permalink to &quot;兼容性&quot;">​</a></h2><h3 id="cesiumjs-1-102-发布" tabindex="-1">CesiumJS 1.102 发布 <a class="header-anchor" href="#cesiumjs-1-102-发布" aria-label="Permalink to &quot;CesiumJS 1.102 发布&quot;">​</a></h3><p>CesiumJS 1.102 现已可用。CesiumJS 现在默认使用 WebGL2 上下文进行渲染。WebGL2 在所有平台上都得到广泛支持，这导致跨设备（尤其是移动设备）更好的功能支持。仍然支持 WebGL1。如果 WebGL2 不可用，CesiumJS 将自动回退到 WebGL1。</p><ol><li>在WebGL 2中，texture2D 已经被废弃，而 texture 是新的</li><li>使用PixelFormat.RED代替PixelFormat.LUMINANCE，是因为在WebGL 2.0中，LUMINANCE也已经被废弃。</li><li>将uniform中的texture重命名为noiseTexture，是为了避免与WebGL中的texture关键字产生冲突。</li></ol><p>迁移到1.102以上：</p><ol><li>texture2D替换为texture</li><li>自定义hack了<code>tileset.content.getFeature(index).content._model._rendererResources.sourceShaders</code>的改为用[[Cesium-CustomShader#Cesium 1.97 发布]]</li><li></li></ol><h2 id="高阶学习" tabindex="-1">高阶学习 <a class="header-anchor" href="#高阶学习" aria-label="Permalink to &quot;高阶学习&quot;">​</a></h2><p><a href="https://sandcastle.cesium.com/#c=xRqLbts48le4wR5OThTFjzxcOynOzas5pGkQe7dYbIIsLdE2EVrSSlQSb+F/v+FTlGyn7d0C10cqkfOe4XBm1GecoWdKXkiGTlBMXtApyWkxD36Va979VijfT5OYYxqT7H7LR1/vY4TyWVKwaBDTOeakh3hWEF+sc5JlAHmbJc80IlkP4RdMuSEbZgTAvyQZi0YKcJAv4tBr3MfLRv8+vo/pBHk/KYmCPCQxCULgTV55MGEJ5jSe3iY05iNYKTLSUMK80DhKXgLMSMZB5gsNiVIBiriCzVGccJQXaZpknET3W4LhUvDc20NnZALqIYBKWMFpEqNkAvA0J2ia0eg+fgZDiacvNOIzsFWr3e2Xqx8Jnc64XZYkB4wlIWiL+IyskJLvv2JWgFjK8FLoTnsAVll4Jadth36jX5VWEA4TlggZcEQJ6DpJNG30LIk73IY8SQWz3w8PgqaPjpryp3zuyucuPD/0HYxTQVuiCCM70SE3PIkkf7T0U8PfDNhyAA++CahpH24AbNUBu28BVgSFUHtYY8d8hlOCPBqjOYEYzhvKDjPMJsblB80mEOmXG9brdkdSPZVBjjD4JmU4BuA0YYspxNSUJEA9W6CXGcncwFDOgjhmDI1FGMZwdogJO4N1UtVPEb9VtC81kCcPhGb4kZIMZ+Fs0XMxb2ubnnRv1XgYjkhOcdzxdq0JfLRbau34exPm34H4Q3i7byAKvAeF/gxZgrxeJBmkrp41Csmu4pzjOFRhP0hTgjPxGtx+Hl6Nrj7fPA5uzh6HI5uqJkUcylQRF/MxyUbJkGeQdTz1qlOTyGdqAf0DtdDJyQlq6i2ERJaIIoiUoIl4AlGRMKKp5ShPIEAwl1FyeT28hnCKxHmfp5SJgy0IZAQymxEg4MkFfSWR1xLyIbQUP+oQWkY3930oKIvqiQTOA4QgGi9QEWcJYyKdCklYkqQqLKnNfwplqDBOBNc/hHCQuHOORAZmJJ7KI/Tz1zIVBWp12b+/j/9AOxZN5nknZf2u4B7qcM8k3HfzVAUOZBOp0KPAtNlHFB2jFc59tLNDtS9qSuycKB6OFD9/pcsHpULN3SUMfWgsDfvlBgmUsD8ogtbQyCBU99YLoiHpQwD5o7H00bfAphkh8fcAjiFFfQ8cZukMN8QZsYZYUc06UaW/ExQyPE8VJd+1evPBXw0FtItaD4218aCiWFtInPuV6JI+gZgUfmkpv9R8UUUQv+QhlpIen6Cqv9fCl2EsbgeNulvBVDqgPVSNn7VQ/Q0sjLJz+lp1gkTzUdUxPuIbKY3hynpat7msrS21U8VvcfjzpMhCog99+Nf8UZSDGcUMiZcp4Z/0u+duXsVpwVHlbdWQFWr24cQQhrsbF6ykX6X2RlIBEroiVEbTpaRflSfIeSPIHDLyVz2QLX2DG0R0MilUSAvDB9l0XJfFwsqTYiFxHU6nbgPubpducOsNa6QXCocE6o8i58ncpHJ5mcgKQ5UXTvmh7aFc6pjauWatnWWumuBxRsOeuccKKNvhOs3tgj7Y2rS9OpFAO+9qjqfkKlI4S323q5Dq6X/lRaY6C7iNc1ZATwC3tr17rd/tparNNsEsJ+YeXDZqxhK6Y3vFy6wgltKMzimnz9oUDsRaY5RFgjKLkaVnn6TkEyYKjbJFqigixJTLIUtyErkryk9DLjssrV1EUj4bkZw7tiYxHrMqamlOifAJ50/VbUCII8je1jcf9IJkFwyubz8OHj9cn9+cvWXCmr3sa9Vct2ZZWcnUs6beyivV6WVt19NqGqyefZKaLFVNh0UbOcuSOClyV9HSgz3nWW1Bf/ZyS8MnaQWJskHLORReTB8O8QjaVbraT2IxmGTJ/JLxiepopdRFBqFwvxUEe/BnCDccI2eY4z1JJd9T6AOa6adHeAymbAxNtowmCt11Mb+Fmo4N6V+gQbfpuyKK2rHihVxUkbKbEZ0zSOz20SVUgKPIs6+C3FuAUljLc0hESQfbIsXjObQQcn5QI6F2gpxwMUhQxoggaGmM5antbajgW83Dw3a3Hbzrdt81293DFrQO+0fvOketVnDY7Xa6h0ddWNtvtVrtVjs4Oui+6zRb3ZbuE5NMJOc1LD4SLGL7lvJwdgfVLJQGraNmG9q29iEQPei8O+gAqyZQ3N/vdpqdzlFn/7D17tBHh0G722kdHXaa3U6n1Wm3FSs4LCNxjkXeQ26Cy+jrfnB1dn4zuhr9Zr0l70oOio7onOjCmeHcfY0hWf6SRhB0eqGQLxcZ+bMgcSjaPyhoDvpIegGK60h39yyJp5QXETkjjGMF1pFgZ0RUd7kRwAICzO7RUXBgBeFmeb8Z7JsO13S3baftFT0n+ejsOH2vEt50CJWISnJ+J5OZiKjzZ3DSNc05bGWeyeSeBIUiBSzi9E4/2WiEghZHi1qaLxsd8bcUQt1rBFq9hWikkgkwC9AIjoagD91hHMmWhuZwT47hKM9w+LQIZHtoTX+jy4XyKrFSaX9HcoAQeda1DSufXQICGvrfBYMoPxP5FZJ9TDwhi19CqrYN2cD4JqYBNIhlCAFqLXw0SFUzcSdVTSgDVUXXBSS0oZBtrRwa6AzqHQIXVbhBG0Ev+jEKVa2+3wLGOSviv3cMY/2zwRAVI+6st+Ky5OVQcbv6ShSaSVyNq5r+laM+35n0uU2P7w4LjafXchqZMk7v3STyAoOyDxIxNx28KU3+mZu6D5biAq7DBWL0SWDAqaBqXJoK+yUTdc0UY0ZDNLi9UhzsnFDztTGn373K/NZHb2mqtFujtmpfjNq2dDYVZ1ATwH3dlBvUHT4XqRqKD50kJhlcWQKuTJLg/Vpq3YZQllTLpCSJqbQP7EXDUy54Ft23OdbXedVfT0MpKhf+C9JOdvZXiciZT72+yaGWggT3VJtEyqghEBcCRlQ2atgMiRsaBx0PapptK/H/ObTV+alPXctR+B5q910Iew05E3gXRvRqhRhfg/qzIP8z4+VkEVxZPu+45Ladl0aF352hpwlvi0l2302cynjXZtq1foovMeQYQqC8qvHQKzouwcUk4tWmEwu6UKALDaqpAWx5KSoxxGhjoXkaDV/7LsRrMplATgC4V7RbWqICs7AwCw3jyF85/xUTG9LblsmOJbVtnhr9Sp9oDi6ASkJQWEXJ3GsAgmNrKGrqWK2gCbKVxdcscAZJEAyl25wPACtUSuHlyiqAy4CRLPU2T6hWpozuLKZGWcW9mPpo/fX20rRctnIMMwyV66me96x85ShrzFr+c+syHKO7yw8Dm/THGNpNBAe3/hli5UybfP63ZHL0dXMZ5UpfVlL1FF9qbwSz0a8l7JkH32ykoomqj/zLteDu/KwKK/o0vkhJFdqsBhfXnwcji2FGFlYO8UkSzNNzLFVuqQug55qu3MTi+9+HQpREonXqVYxqwJYlZ9lUZpVmRzWamedKk+F02KuZ7QssBqfXg0+3j6PPj+dnl+d+FWP0QxiiXZ3QUHZfF5RxIVUV/dMKRHB9dXM+uHOp4Ok3yayC1OksG/Zxwmj6W200or+PIGjCyboog5olXYj6sbTh/8vFy0a1jDHfc6rnfCVTmJa6li3KTrv2CetHCpeM5AXjznUdOtxWOMm5iG5E36arUc8ZeCxPaBR8uRx29/0VnZRFtCFMaJhePA8ItAQ3ScZnv6Qj9UHsQtR2npVyMyetmTLolr91nPMFI++NT/5F5+L/DoixjhcEe5zAOYP0mO+Ni/CJ8CDMbaF6vOeiHkf0GdHoZM1/pxBfPvIcdiYFk1Oe+633x3sAv4LKEjnD+AzlKsMLATZrvb9Wi0EQHO/B63pMniRsjLMa5f8A" target="_blank" rel="noreferrer">Hello World - Cesium Sandcastle</a>配套文章<a href="https://community.cesium.com/t/how-to-create-animated-heatmaps/15102/40" target="_blank" rel="noreferrer">如何创建动画热图？ - CesiumJS - Cesium 社区</a>可学习到cesium shader的编写 <a href="https://github.com/xuzhao123/cesium-graph/blob/master/Source/Sensor/RectangularSensor/RectangularSensorPrimitive.js" target="_blank" rel="noreferrer">cesium-graph/RectangularSensorPrimitive.js at master · xuzhao123/cesium-graph · GitHub</a> 雷达追踪圆锥体/相控阵雷达范围的最早开源实现 <a href="https://github.com/numtel/snorb/blob/master/lib/polygon.js" target="_blank" rel="noreferrer">snorb/polygon.js at master · numtel/snorb · GitHub</a> 3DCityDB-Web-Map/ThirdParty/Intersection/IntersectionAPI.js的原始来源 研究源码的正则：<strong>Cesium.(?!defined|defaultValue|Cartesian3|Cartesian2|Cartesian4|objectToQuery|Math|queryToObject)\\w+</strong></p>`,59),A=[D];function F(i,m,u,d,h,g){return n(),a("div",null,A)}const P=s(y,[["render",F]]);export{f as __pageData,P as default};
