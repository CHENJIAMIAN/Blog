import{_ as s,o as a,c as n,O as p}from"./chunks/framework.4afe7240.js";const l="/assets/9C5D4A939D7E49A7862D29097EBDBEC2.fa58f195.png",o="/assets/0F3F212968534B1BBF8685349EF7EC2E.118cd371.png",e="/assets/D99B6BBEFCDA4F548BFE34A0DFEA4451.d4eac484.png",t="/assets/E50AB78A5B4B4CFB95FEE995835E4892.90640087.png",c="/assets/ABE4180E9A704F76BD336134F59BE33D.0fcfc6b6.png",C="/assets/063BCCCBF1B642DA905B99B1FC8D5601.6ee4a98c.png",r="/assets/C2D7E521F8FB4C56994BE647B25BD4D9.1004e700.png",A="/assets/82215506A11644ACAF8BF30948562A5D.fdc02ffe.png",y="/assets/D857C0EF98C44F35ACA91A73C881F236.9536d04a.png",D="/assets/74C5B7106D8844EDA80EC2C66B7D2A55.c68403c1.png",i="/assets/8797E5BE84804387A2D7913461BC5098.0eafe20b.png",k=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"1 杂/《TCP IP 详解：协议》 2019年7月23日.md","filePath":"1 杂/《TCP IP 详解：协议》 2019年7月23日.md"}'),F={name:"1 杂/《TCP IP 详解：协议》 2019年7月23日.md"},d=p(`<blockquote><p>OSI模型（7层）：这是一种事实上被TCP/IP（4层）模型淘汰的协议。</p></blockquote><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">链路	以太网（硬件接口）</span></span>
<span class="line"><span style="color:#A6ACCD;">网络	IP（不可靠）</span></span>
<span class="line"><span style="color:#A6ACCD;">运输	TCP用于数据分块和确认接收（可靠）、超时重传等（与UDP的区别）</span></span>
<span class="line"><span style="color:#A6ACCD;">                TCP和UDP采用16 bit的端口号来识别应用程序</span></span>
<span class="line"><span style="color:#A6ACCD;">                任何TCP</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">IP实现所提供的服务都用知名的 </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">～1023之间的端口号（知名端口号分配机构（ IANA）来管理）</span></span>
<span class="line"><span style="color:#A6ACCD;">                有时，一个I P地址和一个端口号也称为一个插口（ s o c k e t）</span></span>
<span class="line"><span style="color:#A6ACCD;">                Telnet是采用端口号为23的TCP</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">IP标准</span></span>
<span class="line"><span style="color:#A6ACCD;">应用	HTTP</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">第7层 应用层 HTTP</span></span>
<span class="line"><span style="color:#A6ACCD;">第6层 表现层 数据转换、加密和压缩</span></span>
<span class="line"><span style="color:#A6ACCD;">第5层 会话层 确保打开足够长的时间可以传数据</span><span style="color:#676E95;font-style:italic;">//也可次设置几MB为检查点以备断传之后续传</span></span>
<span class="line"><span style="color:#A6ACCD;">第4层 传输层 TCP 数据   分 数据段</span></span>
<span class="line"><span style="color:#A6ACCD;">第3层 网络层 IP  数据段 分 数据包</span></span>
<span class="line"><span style="color:#A6ACCD;">第2层 数据链路层 Wi</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">Fi      数据包 分 帧</span></span>
<span class="line"><span style="color:#A6ACCD;">第1层 物理层                帧 分 二进制</span></span></code></pre></div><hr><blockquote><p>网关/IP路由器/路由器 是同个东西。</p></blockquote><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">网桥		在链路层连结网络</span></span>
<span class="line"><span style="color:#A6ACCD;">路由器		在网络层连接网络</span></span></code></pre></div><hr><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">InterNIC将IP地址分为五类</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    A类保留给ZF或大型企业，</span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">127.255</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">255.255</span><span style="color:#A6ACCD;">，默认子网掩码为255</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#A6ACCD;">    B类分配给中等规模的公司，</span><span style="color:#F78C6C;">128.0</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">191.255</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">255.255</span><span style="color:#A6ACCD;">，默认子网掩码为255</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">255.0</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#A6ACCD;">    C类分配给小公司或个人，</span><span style="color:#F78C6C;">192.0</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">223.255</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">255.255</span><span style="color:#A6ACCD;">，默认子网掩码是255</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">255.255</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#A6ACCD;">    D类用于组播，</span></span>
<span class="line"><span style="color:#A6ACCD;">    E类用于实验，</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">ABC的专用IP地址： 就是我们在3类地址中常见到内网的IP段</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">10.0</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">10.255</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">255.255</span><span style="color:#A6ACCD;">（一个A类地址）</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">172.16</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">0.0</span><span style="color:#A6ACCD;">－</span><span style="color:#F78C6C;">172.31</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">255.255</span><span style="color:#A6ACCD;">（16个B类地址）</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">192.168</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">0.0</span><span style="color:#A6ACCD;">－</span><span style="color:#F78C6C;">192.168</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">255.255</span><span style="color:#A6ACCD;">（256个C类地址）</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//你要建网络（局域网），网络数多，且网络内主机较少（254以下）用192开头的合适；</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//你要建网络（局域网），网络数一般，且网络内主机较少（254以上，64516以下）用172开头的合适</span></span></code></pre></div><p><img src="`+l+`" alt=""></p><blockquote><p>IP 分为：分类号、网络号（InterNIC分配）、主机号 （互联网络信息中心（InterNIC）)</p></blockquote><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">网络号标识某个网络，主机号标识在该网络上的一个特定的主机</span></span>
<span class="line"><span style="color:#A6ACCD;">    即网络信息中心 N I C负责分配顶级域和委派其他指定地区域的授权机构</span></span></code></pre></div><p><img src="`+o+'" alt=""></p><blockquote><p>这些32位的地址通常写成四个十进制的数，其中每个整数对应一个字节。(二进制1111 1111就是等于255)</p></blockquote><p><img src="'+e+`" alt=""></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">地址范围</span></span>
<span class="line"><span style="color:#F78C6C;">192.0</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">0</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">0到223</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">255.255</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">255</span></span>
<span class="line"><span style="color:#A6ACCD;">私有地址</span><span style="color:#676E95;font-style:italic;">//私有IP地址则是在局域网中使用的IP地址</span></span>
<span class="line"><span style="color:#F78C6C;">192.168</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">0</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">0到192</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">168.255</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">255</span></span>
<span class="line"><span style="color:#A6ACCD;">   NAT－Network Address Translation 网络地址转换</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> 当私有网络内的主机要与位于公网上的主机进行通讯时必须经过地址转换，将其私有地址转换为合法公网地址才能对外访问。</span></span></code></pre></div><blockquote><p>TCP/IP协议栈：边传输边加各传输层头部，各头部都有一段协议域标识段</p></blockquote><p><img src="`+t+'" alt=""></p><blockquote><p>TCP/IP协议栈 被解析分发</p></blockquote><p><img src="'+c+`" alt=""></p><hr><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">ARP</span><span style="color:#A6ACCD;">	(地址解析协议)		</span><span style="color:#82AAFF;">从</span><span style="color:#A6ACCD;">(IP)</span><span style="color:#82AAFF;">到</span><span style="color:#A6ACCD;">(MAC地址）进行动态映射</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">自动完成，不必关心</span></span>
<span class="line"><span style="color:#A6ACCD;">RARP	是被那些没有磁盘驱动器的系统使用（一般是无盘工作站或 X终端），它需要系统管理员进行手工设置</span></span>
<span class="line"><span style="color:#A6ACCD;">ICMP经常被认为是 I P层的一个组成部分。它传递差错报文以及其他需要注意的信息</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> ICMP封装在IP数据报内部</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">多播</span><span style="color:#A6ACCD;">(multicast) 处于单播和广播之间：帧仅传送给属于多播组的多个主机。</span></span></code></pre></div><hr><blockquote><p>子网掩码: 根据子网掩码就可知道子网号与主机号之间的分界线（值为1的比特（255）留给网络号和子网号，为0的比特（0）留给主机号）</p></blockquote><p><img src="`+C+`" alt=""></p><p>eg: 8bit子网号 8bit主机号</p><hr><p>域名系统（D N S）是一种用于T C P / I P应用程序的分布式数据库，它提供主机名字和 I P地址之间的转换及有关电子邮件的选路信息。</p><blockquote><p>D N S最常用的版本（包括解析器和名字服务器）</p></blockquote><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">主机名 转 IP ：称为 解析器</span></span>
<span class="line"><span style="color:#A6ACCD;">解析器 使用 TCP</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">IP协议（主要是UDP）与 名字服务器 通信来完成这种相互转换</span></span>
<span class="line"><span style="color:#A6ACCD;">解析器 通常是应用程序的一部分，在一个应用程序请求 TCP打开一个连接或使用UDP发送一个数据报之前。心须将一个主机名转换为一个 IP地址</span></span>
<span class="line"><span style="color:#A6ACCD;">Internet组管理协议（IGMP）</span></span></code></pre></div><hr><blockquote><p>TCP</p></blockquote><blockquote><p>这一过程与打电话很相似，先拨号振铃，等待对方摘机说“喂”，然后才说明是谁</p></blockquote><hr><blockquote><p>TCP头部，20个字节，160位，切分如下</p></blockquote><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">序号是32 bit的无符号数，包含该连接的初始序号ISN（由这个主机选择）</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">用于计数每个传输的字节，当某个主机开启一个TCP会话时，</span></span>
<span class="line"><span style="color:#A6ACCD;">他的初始序列号是随机的，可能是0和4</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">294</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">967</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">295之间的任意值， I S N随时间而变化，因此每个连接都将具有不同的 I S N</span></span></code></pre></div><p><img src="`+r+'" alt=""></p><p><img src="'+A+`" alt=""></p><blockquote><p>建立（三次握手确认双方都有发送和接受信息的能力）</p></blockquote><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">) 请求端（通常称为客户）发送一个 S Y N段指明客户打算连接的服务器的端口，以及初始序号（I S N，在这个例子中为1 </span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">）。这个S Y N段为报文段1。</span></span>
<span class="line"><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">) 服务器发回包含服务器的初始序号的 S Y N报文段（报文段2）作为应答。同时，将确认序号设置为客户的I S N加1以对客户的S Y N报文段进行确认。一个S Y N将占用一个序号。</span></span>
<span class="line"><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">) 客户必须将确认序号设置为服务器的 I S N加1以对服务器的S Y N报文段进行确认（报文段3）。</span></span></code></pre></div><p><img src="`+y+`" alt=""></p><blockquote><p>终止（四次挥手，tcp/ip双工传输，必须发送两次ack.）</p></blockquote><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">客户端发送一个F I N，用来关闭从客户到服务器的数据传送</span></span>
<span class="line"><span style="color:#A6ACCD;">当服务器收到这个 FIN，它发回一个ACK，确认序号为收到的序号加 </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">（报文段5） </span></span>
<span class="line"><span style="color:#A6ACCD;">同时TCP服务器还向应用程序传送一个文件结束符。接着这个服务器程序就关闭它的连接，导致它的 TCP端发送一个FIN（报文段6），</span></span>
<span class="line"><span style="color:#A6ACCD;">客户必须发回一个确认，并将确认序号设置为收到序号加1（报文段7）。客户端进入TIME_WAIT状态</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">服务器收到客户端的ACK报文段以后，就关闭连接</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">此时，客户端等待2MSL后依然没有收到回复，则证明Server端已正常关闭，客户端也可以关闭连接了。</span></span></code></pre></div><blockquote><p>看到这里有没有发现最后的挥手状态，并不是四次挥手，而是三次挥手？？？</p></blockquote><blockquote><pre><code>这是因为关闭连接有两种方式，当一方关闭连接，另外一方没有数据发送时，马上关闭连接，也就将第二步的ack与第三步的fin合并为一步了
</code></pre></blockquote><p><img src="`+D+`" alt=""></p><p>TCP首部中6个标志比特中的4个</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">URG 	紧急指针（u rgent pointer）有效（见2 </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;"> 8节）。</span></span>
<span class="line"><span style="color:#A6ACCD;">ACK 	确认序号有效。</span></span>
<span class="line"><span style="color:#A6ACCD;">PSH 	接收方应该尽快将这个报文段交给应用层。</span></span>
<span class="line"><span style="color:#A6ACCD;">RST 	重建连接。</span></span>
<span class="line"><span style="color:#A6ACCD;">SYN 	同步序号用来发起一个连接。这个标志和下一个标志将在第 </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> 8章介绍。</span></span>
<span class="line"><span style="color:#A6ACCD;">            为了应对 同时主动打开，但仅建立一个连接（每一方必须发送一个SYN，且这些SYN必须传递给对方）</span></span>
<span class="line"><span style="color:#A6ACCD;">            也就是说 ，你不能没等我说好就建立，不然你建一个我建一个，我们要一起说好再建立一个</span></span></code></pre></div><p><img src="`+i+`" alt=""></p><ol><li>FIN 发端完成发送任务。</li></ol><hr><blockquote><p>TCP与UDP的区别</p></blockquote><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">、TCP面向连接（如打电话要先拨号建立连接）</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">UDP是无连接的，即发送数据之前不需要建立连接</span></span>
<span class="line"><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">、TCP提供可靠的服务。也就是说，通过TCP连接传送的数据，无差错，不丢失，不重复，且按序到达</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">UDP尽最大努力交付，即不保 证可靠交付</span></span>
<span class="line"><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">、TCP面向字节流，实际上是TCP把数据看成一连串无结构的字节流</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">UDP是面向报文的</span></span>
<span class="line"><span style="color:#A6ACCD;">    例，TCP连接就像是打电话，两者之间必须有一条不间断的通路，数据不到达对方，对方就一直在等待，除非对方直接挂断电话。先说的话先到，后说的后到，有顺序。</span></span>
<span class="line"><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;">、每一条TCP连接只能是点到点的</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">UDP支持一对一，一对多，多对一和多对多的交互通信</span></span>
<span class="line"><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;">、TCP首部开销20字节</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">UDP的首部开销小，只有8个字节</span></span>
<span class="line"><span style="color:#F78C6C;">6</span><span style="color:#A6ACCD;">、TCP的逻辑通信信道是全双工的可靠信道，UDP则是不可靠信道</span></span></code></pre></div>`,51),P=[d];function u(g,_,b,m,I,v){return a(),n("div",null,P)}const T=s(F,[["render",u]]);export{k as __pageData,T as default};
