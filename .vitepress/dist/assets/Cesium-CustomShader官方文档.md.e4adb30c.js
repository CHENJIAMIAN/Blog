import{_ as s,o as a,c as n,O as l}from"./chunks/framework.4afe7240.js";const d=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"Cesium-CustomShader官方文档.md","filePath":"Cesium-CustomShader官方文档.md"}'),o={name:"Cesium-CustomShader官方文档.md"},p=l(`<h2 id="customshader文档" tabindex="-1"><a href="https://github.com/CesiumGS/cesium/blob/main/Documentation/CustomShaderGuide/README.md" target="_blank" rel="noreferrer">CustomShader文档</a> <a class="header-anchor" href="#customshader文档" aria-label="Permalink to &quot;[CustomShader文档](https://github.com/CesiumGS/cesium/blob/main/Documentation/CustomShaderGuide/README.md)&quot;">​</a></h2><h2 id="构造器" tabindex="-1">构造器 <a class="header-anchor" href="#构造器" aria-label="Permalink to &quot;构造器&quot;">​</a></h2><div class="language-JS"><button title="Copy Code" class="copy"></button><span class="lang">JS</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> customShader </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">CustomShader</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">//用户想要添加到着色器的任何自定义Uniforms。</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">//这些可以在运行时通过 customShader.setUniform() 改变</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">uniforms</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">u_time</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#676E95;font-style:italic;">//初始值</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">UniformType</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">FLOAT</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//可以从 URL、资源或 TypedArray 加载纹理。</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//更多细节参见 Uniforms 部分</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">u_externalTexture</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">TextureUniform</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">url</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://example.com/image.png</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">UniformType</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">SAMPLER_2D</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">//将出现在自定义顶点和片段着色器文本中的自定义变量。</span></span>
<span class="line"><span style="color:#A6ACCD;">  varyings: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">v_customTexCoords</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">VaryingType</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">VEC2</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">//配置CustomShader在片段着色器的材质/照明管道中的位置。后面会有更多关于此的内容。</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">mode</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">CustomShaderMode</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">MODIFY_MATERIAL</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">//PBR（基于物理的渲染）或 UNLIT，具体取决于所需的结果。</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">lightingModel</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">LightingModel</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">PBR</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">//强制着色器渲染为透明，即使图元具有不透明材质</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">translucencyMode</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">CustomShaderTranslucencyMode</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">TRANSLUCENT</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 自定义顶点着色器。这是一个从模型空间到模型空间的函数。</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// VertexInput 如下所述。</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">vertexShaderText</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#C3E88D;">    // 重要提示：函数签名必须使用这些参数名称。这会使运行时更容易生成着色器并进行优化。</span></span>
<span class="line"><span style="color:#C3E88D;">    void vertexMain(VertexInput vsInput, inout czm_modelVertexOutput vsOutput) {</span></span>
<span class="line"><span style="color:#C3E88D;">        //代码在这里。一个空的代码体不会有任何操作</span></span>
<span class="line"><span style="color:#C3E88D;">    }</span></span>
<span class="line"><span style="color:#C3E88D;">  </span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">//自定义的片段着色器。下面将会介绍 FragmentInput。不论mode如何，它始终接收一个材质，并直接在原地修改它。</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">fragmentShaderText</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#C3E88D;">    //重要提示：函数签名必须使用这些参数名称。这使得运行时更容易生成着色器并进行优化。</span></span>
<span class="line"><span style="color:#C3E88D;">    void fragmentMain(FragmentInput fsInput, inout czm_modelMaterial material) {</span></span>
<span class="line"><span style="color:#C3E88D;">        //代码在这里。例如将漫反射颜色设置为半透明的红色：</span></span>
<span class="line"><span style="color:#C3E88D;">        material.diffuse = vec3(1.0, 0.0, 0.0);</span></span>
<span class="line"><span style="color:#C3E88D;">        material.alpha = 0.5;</span></span>
<span class="line"><span style="color:#C3E88D;">    }</span></span>
<span class="line"><span style="color:#C3E88D;">  </span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h2 id="应用customshader" tabindex="-1">应用CustomShader <a class="header-anchor" href="#应用customshader" aria-label="Permalink to &quot;应用CustomShader&quot;">​</a></h2><p>CustomShader可以应用于 3D Tiles 或<code>Model</code>如下：</p><div class="language-JS"><button title="Copy Code" class="copy"></button><span class="lang">JS</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> customShader </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">CustomShader</span><span style="color:#A6ACCD;">(</span><span style="color:#676E95;font-style:italic;">/*...*/</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//应用于 tileset 中的所有 tile。</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> tileset </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Cesium3DTileset</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">fromUrl</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://example.com/tileset.json</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">customShader</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> customShader</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">viewer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">scene</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">primitives</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#A6ACCD;">(tileset)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//直接应用于模型</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> model </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Model</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">fromGltfAsync</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">url</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://example.com/model.gltf</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">customShader</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> customShader</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h2 id="uniforms" tabindex="-1">Uniforms <a class="header-anchor" href="#uniforms" aria-label="Permalink to &quot;Uniforms&quot;">​</a></h2><p>CustomShader目前支持以下Uniform类型：</p><table><thead><tr><th style="text-align:left;">Uniform类型</th><th style="text-align:left;">GLSL型</th><th style="text-align:left;">JS型</th></tr></thead><tbody><tr><td style="text-align:left;"><code>FLOAT</code></td><td style="text-align:left;"><code>float</code></td><td style="text-align:left;"><code>Number</code></td></tr><tr><td style="text-align:left;"><code>VEC2</code></td><td style="text-align:left;"><code>vec2</code></td><td style="text-align:left;"><code>Cartesian2</code></td></tr><tr><td style="text-align:left;"><code>VEC3</code></td><td style="text-align:left;"><code>vec3</code></td><td style="text-align:left;"><code>Cartesian3</code></td></tr><tr><td style="text-align:left;"><code>VEC4</code></td><td style="text-align:left;"><code>vec4</code></td><td style="text-align:left;"><code>Cartesian4</code></td></tr><tr><td style="text-align:left;"><code>INT</code></td><td style="text-align:left;"><code>int</code></td><td style="text-align:left;"><code>Number</code></td></tr><tr><td style="text-align:left;"><code>INT_VEC2</code></td><td style="text-align:left;"><code>ivec2</code></td><td style="text-align:left;"><code>Cartesian2</code></td></tr><tr><td style="text-align:left;"><code>INT_VEC3</code></td><td style="text-align:left;"><code>ivec3</code></td><td style="text-align:left;"><code>Cartesian3</code></td></tr><tr><td style="text-align:left;"><code>INT_VEC4</code></td><td style="text-align:left;"><code>ivec4</code></td><td style="text-align:left;"><code>Cartesian4</code></td></tr><tr><td style="text-align:left;"><code>BOOL</code></td><td style="text-align:left;"><code>bool</code></td><td style="text-align:left;"><code>Boolean</code></td></tr><tr><td style="text-align:left;"><code>BOOL_VEC2</code></td><td style="text-align:left;"><code>bvec2</code></td><td style="text-align:left;"><code>Cartesian2</code></td></tr><tr><td style="text-align:left;"><code>BOOL_VEC3</code></td><td style="text-align:left;"><code>bvec3</code></td><td style="text-align:left;"><code>Cartesian3</code></td></tr><tr><td style="text-align:left;"><code>BOOL_VEC4</code></td><td style="text-align:left;"><code>bvec4</code></td><td style="text-align:left;"><code>Cartesian4</code></td></tr><tr><td style="text-align:left;"><code>MAT2</code></td><td style="text-align:left;"><code>mat2</code></td><td style="text-align:left;"><code>Matrix2</code></td></tr><tr><td style="text-align:left;"><code>MAT3</code></td><td style="text-align:left;"><code>mat3</code></td><td style="text-align:left;"><code>Matrix3</code></td></tr><tr><td style="text-align:left;"><code>MAT4</code></td><td style="text-align:left;"><code>mat4</code></td><td style="text-align:left;"><code>Matrix4</code></td></tr><tr><td style="text-align:left;"><code>SAMPLER_2D</code></td><td style="text-align:left;"><code>sampler2D</code></td><td style="text-align:left;"><strong>TextureUniform</strong></td></tr></tbody></table><h3 id="texture-uniforms" tabindex="-1">Texture Uniforms <a class="header-anchor" href="#texture-uniforms" aria-label="Permalink to &quot;Texture Uniforms&quot;">​</a></h3><p>纹理uniforms有更多的选项，已经封装在 <code>TextureUniform</code>类中了。纹理可以从URL、资源或 <code>typedArray</code> 中加载。以下是一些示例：</p><blockquote><p>这里的&quot;资源&quot;指的是Cesium支持的一些资源类型，比如Blob、File和BlobURI等。可以通过将这些资源传递给TextureUniform类的构造函数，来创建纹理。</p></blockquote><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> textureFromUrl </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">TextureUniform</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">url</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://example.com/image.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> textureFromTypedArray </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">TextureUniform</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">typedArray</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Uint8Array</span><span style="color:#A6ACCD;">([</span><span style="color:#F78C6C;">255</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">255</span><span style="color:#A6ACCD;">])</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">width</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">height</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">pixelFormat</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">PixelFormat</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">RGBA</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">pixelDatatype</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">PixelDatatype</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">UNSIGNED_BYTE</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//TextureUniform 还提供了用于控制采样器的选项</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> textureWithSampler </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">TextureUniform</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">url</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://example.com/image.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">repeat</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">minificationFilter</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">TextureMinificationFilter</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">NEAREST</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">magnificationFilter</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">TextureMagnificationFilter</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">NEAREST</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h2 id="varyings" tabindex="-1">Varyings <a class="header-anchor" href="#varyings" aria-label="Permalink to &quot;Varyings&quot;">​</a></h2><p>Varyings 在<code>CustomShader</code>构造函数中声明。这会自动将诸如<code>out float v_userDefinedVarying;</code>和<code>in float v_userDefinedVarying;</code>之类的行分别添加到 GLSL 顶点和片段着色器的顶部。</p><p>用户负责在 <code>vertexShaderText</code> 中为这个 <code>varying</code> 赋值，并在 <code>fragmentShaderText</code> 中使用它。例如：</p><div class="language-c"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> customShader </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> new Cesium.</span><span style="color:#82AAFF;">CustomShader</span><span style="color:#89DDFF;">({</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">//在这里声明了变化</span></span>
<span class="line"><span style="color:#F07178;">  varyings: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    v_selectedColor: </span><span style="color:#A6ACCD;">Cesium</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">VaryingType</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">VEC4</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">//用户在顶点着色器中分配变量</span></span>
<span class="line"><span style="color:#F07178;">  vertexShaderText: \`</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">void</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">vertexMain</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">VertexInput vsInput</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> inout czm_modelVertexOutput vsOutput</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">float</span><span style="color:#F07178;"> positiveX </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">step</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">vsOutput</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">positionMC</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">        v_selectedColor </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">mix</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">vsInput</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">attributes</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">color_0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">vsInput</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">attributes</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">color_1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">vsOutput</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">positionMC</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">x</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  \`</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">//用户在片段着色器中使用 varying</span></span>
<span class="line"><span style="color:#F07178;">  fragmentShaderText: \`</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">void</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fragmentMain</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">FragmentInput fsInput</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> inout czm_modelMaterial material</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">material</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">diffuse</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">v_selectedColor</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">rgb</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  \`</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">});</span></span></code></pre></div><p>CustomShader支持以下不同类型：</p><table><thead><tr><th style="text-align:left;">Varyings</th><th style="text-align:left;">GLSL型</th></tr></thead><tbody><tr><td style="text-align:left;"><code>FLOAT</code></td><td style="text-align:left;"><code>float</code></td></tr><tr><td style="text-align:left;"><code>VEC2</code></td><td style="text-align:left;"><code>vec2</code></td></tr><tr><td style="text-align:left;"><code>VEC3</code></td><td style="text-align:left;"><code>vec3</code></td></tr><tr><td style="text-align:left;"><code>VEC4</code></td><td style="text-align:left;"><code>vec4</code></td></tr><tr><td style="text-align:left;"><code>MAT2</code></td><td style="text-align:left;"><code>mat2</code></td></tr><tr><td style="text-align:left;"><code>MAT3</code></td><td style="text-align:left;"><code>mat3</code></td></tr><tr><td style="text-align:left;"><code>MAT4</code></td><td style="text-align:left;"><code>mat4</code></td></tr></tbody></table><h2 id="customshader模式" tabindex="-1">CustomShader模式 <a class="header-anchor" href="#customshader模式" aria-label="Permalink to &quot;CustomShader模式&quot;">​</a></h2><p>自定义片段着色器是可配置的，因此它可以在材质或照明之前/之后运行。这是可用模式的摘要。</p><table><thead><tr><th style="text-align:left;">模式</th><th style="text-align:left;">片段着色器管线</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;"><code>MODIFY_MATERIAL</code>（默认）</td><td style="text-align:left;">材质 -&gt; CustomShader -&gt; 光照</td><td style="text-align:left;">CustomShader修改材质阶段的结果</td></tr><tr><td style="text-align:left;"><code>REPLACE_MATERIAL</code></td><td style="text-align:left;">CustomShader -&gt; 光照</td><td style="text-align:left;">根本不运行材质阶段，而是在CustomShader中按程序生成它</td></tr></tbody></table><p>在上面，“材质”对纹理进行了预处理，从而产生了一个<code>czm_modelMaterial</code>. 这主要与 PBR 相关，但即使对于 UNLIT，也会处理基色纹理。</p><h2 id="vertexinput结构" tabindex="-1"><code>VertexInput</code>结构 <a class="header-anchor" href="#vertexinput结构" aria-label="Permalink to &quot;\`VertexInput\`结构&quot;">​</a></h2><p>包含属性的自动生成的 GLSL 结构。</p><div class="language-c"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> VertexInput </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//处理过的属性。请参阅下面的属性结构部分。</span></span>
<span class="line"><span style="color:#F07178;">    Attributes attributes</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//Feature ID/Batch ID。请参阅下面的 FeatureIds 结构部分。</span></span>
<span class="line"><span style="color:#F07178;">    FeatureIds featureIds</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//元数据属性。请参阅下面的元数据结构部分。</span></span>
<span class="line"><span style="color:#F07178;">    Metadata metadata</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//元数据类属性。请参阅下面的元数据类结构部分。</span></span>
<span class="line"><span style="color:#F07178;">    MetadataClass metadataClass</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//元数据统计。请参阅下面的元数据统计结构部分</span></span>
<span class="line"><span style="color:#F07178;">    MetadataStatistics metadataStatistics</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span></code></pre></div><h2 id="fragmentinput结构" tabindex="-1"><code>FragmentInput</code>结构 <a class="header-anchor" href="#fragmentinput结构" aria-label="Permalink to &quot;\`FragmentInput\`结构&quot;">​</a></h2><p>这个结构类似于<code>VertexInput</code>，但是有一些更多的自动变量用于各种坐标空间中的位置。</p><div class="language-c"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> FragmentInput </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//处理的属性值。请参阅下面的属性结构部分。</span></span>
<span class="line"><span style="color:#F07178;">    Attributes attributes</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//Feature ID/Batch ID。请参阅下面的 FeatureIds 结构部分。</span></span>
<span class="line"><span style="color:#F07178;">    FeatureIds featureIds</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//元数据属性。请参阅下面的元数据结构部分。</span></span>
<span class="line"><span style="color:#F07178;">    Metadata metadata</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//元数据类属性。请参阅下面的元数据类结构部分。</span></span>
<span class="line"><span style="color:#F07178;">    MetadataClass metadataClass</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//元数据统计。请参阅下面的元数据统计结构部分</span></span>
<span class="line"><span style="color:#F07178;">    MetadataStatistics metadataStatistics</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span></code></pre></div><h2 id="attributes结构" tabindex="-1">Attributes结构 <a class="header-anchor" href="#attributes结构" aria-label="Permalink to &quot;Attributes结构&quot;">​</a></h2><p>该<code>Attributes</code>结构是根据CustomShader中使用的变量和要渲染的图元中可用的属性动态生成的。</p><p>例如，如果用户在着色器中使用，运行时将生成从模型中的<code>fsInput.attributes.texCoord_0</code>属性（如果可用）提供此值所需的代码<code>TEXCOORD_0</code></p><p>如果图元不具有满足CustomShader所需的属性，则将尽可能推断出默认值，以便着色器仍然可以编译。否则，将为该图元禁用自定义顶点/片段着色器部分。</p><p>内置属性的完整列表如下。<code>0, 1, 2, ...</code>一些属性有一个集合索引，它是（例如）之一<code>texCoord_0</code>，这些用<code>N</code>.</p><table><thead><tr><th style="text-align:left;">模型中对应的属性</th><th style="text-align:left;">着色器中的变量</th><th style="text-align:left;">类型</th><th style="text-align:left;">在顶点着色器中可用吗？</th><th style="text-align:left;">在片段着色器中可用吗？</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;"><code>POSITION</code></td><td style="text-align:left;"><code>positionMC</code></td><td style="text-align:left;"><code>vec3</code></td><td style="text-align:left;">是的</td><td style="text-align:left;">是的</td><td style="text-align:left;">在模型坐标中的位置</td></tr><tr><td style="text-align:left;"><code>POSITION</code></td><td style="text-align:left;"><code>positionWC</code></td><td style="text-align:left;"><code>vec3</code></td><td style="text-align:left;">不</td><td style="text-align:left;">是的</td><td style="text-align:left;">世界坐标中的位置 (WGS84 ECEF <code>(x, y, z)</code>)。精度低。</td></tr><tr><td style="text-align:left;"><code>POSITION</code></td><td style="text-align:left;"><code>positionEC</code></td><td style="text-align:left;"><code>vec3</code></td><td style="text-align:left;">不</td><td style="text-align:left;">是的</td><td style="text-align:left;">在眼睛坐标中的位置。</td></tr><tr><td style="text-align:left;"><code>NORMAL</code></td><td style="text-align:left;"><code>normalMC</code></td><td style="text-align:left;"><code>vec3</code></td><td style="text-align:left;">是的</td><td style="text-align:left;">不</td><td style="text-align:left;">模型坐标中的单位长度法向量。仅在顶点着色器中可用</td></tr><tr><td style="text-align:left;"><code>NORMAL</code></td><td style="text-align:left;"><code>normalEC</code></td><td style="text-align:left;"><code>vec3</code></td><td style="text-align:left;">不</td><td style="text-align:left;">是的</td><td style="text-align:left;">眼睛坐标中的单位长度法向量。仅在片段着色器中可用</td></tr><tr><td style="text-align:left;"><code>TANGENT</code></td><td style="text-align:left;"><code>tangentMC</code></td><td style="text-align:left;"><code>vec3</code></td><td style="text-align:left;">是的</td><td style="text-align:left;">不</td><td style="text-align:left;">模型坐标中的单位长度切向量。这始终是一个<code>vec3</code>. 对于提供<code>w</code>组件的模型，在计算双切线向量后将其删除。</td></tr><tr><td style="text-align:left;"><code>TANGENT</code></td><td style="text-align:left;"><code>tangentEC</code></td><td style="text-align:left;"><code>vec3</code></td><td style="text-align:left;">不</td><td style="text-align:left;">是的</td><td style="text-align:left;">眼睛坐标中的单位长度切向量。这始终是一个<code>vec3</code>. 对于提供<code>w</code>组件的模型，在计算双切线向量后将其删除。</td></tr><tr><td style="text-align:left;"><code>NORMAL</code>&amp;<code>TANGENT</code></td><td style="text-align:left;"><code>bitangentMC</code></td><td style="text-align:left;"><code>vec3</code></td><td style="text-align:left;">是的</td><td style="text-align:left;">不</td><td style="text-align:left;">模型坐标中的单位长度双切线向量。仅当法线和切线向量都可用时才可用。</td></tr><tr><td style="text-align:left;"><code>NORMAL</code>&amp;<code>TANGENT</code></td><td style="text-align:left;"><code>bitangentEC</code></td><td style="text-align:left;"><code>vec3</code></td><td style="text-align:left;">不</td><td style="text-align:left;">是的</td><td style="text-align:left;">眼睛坐标中的单位长度双切线向量。仅当法线和切线向量都可用时才可用。</td></tr><tr><td style="text-align:left;"><code>TEXCOORD_N</code></td><td style="text-align:left;"><code>texCoord_N</code></td><td style="text-align:left;"><code>vec2</code></td><td style="text-align:left;">是的</td><td style="text-align:left;">是的</td><td style="text-align:left;">第<code>N</code>组纹理坐标。</td></tr><tr><td style="text-align:left;"><code>COLOR_N</code></td><td style="text-align:left;"><code>color_N</code></td><td style="text-align:left;"><code>vec4</code></td><td style="text-align:left;">是的</td><td style="text-align:left;">是的</td><td style="text-align:left;">第<code>N</code>组顶点颜色。这总是一个<code>vec4</code>; 如果模型未指定 alpha 值，则假定为 1。</td></tr><tr><td style="text-align:left;"><code>JOINTS_N</code></td><td style="text-align:left;"><code>joints_N</code></td><td style="text-align:left;"><code>ivec4</code></td><td style="text-align:left;">是的</td><td style="text-align:left;">是的</td><td style="text-align:left;">第<code>N</code>组联合指数</td></tr><tr><td style="text-align:left;"><code>WEIGHTS_N</code></td><td style="text-align:left;"><code>weights_N</code></td><td style="text-align:left;"><code>vec4</code></td><td style="text-align:left;"></td><td style="text-align:left;"></td><td style="text-align:left;"></td></tr></tbody></table><p>自定义属性也可用，但它们被重命名为使用小写字母和下划线。例如，<code>_SURFACE_TEMPERATURE</code> 模型中调用的属性将成为<code>fsInput.attributes.surface_temperature</code>着色器中的属性。</p><h2 id="featureids结构" tabindex="-1"><code>FeatureIds</code>结构 <a class="header-anchor" href="#featureids结构" aria-label="Permalink to &quot;\`FeatureIds\`结构&quot;">​</a></h2><p>这个结构是动态生成的，以将所有不同的Feature ID 收集到一个集合中，而不管值是来自属性、纹理或varying。</p><blockquote><p>为什么要素id会来自属性、纹理或varying？ 在三维场景渲染中，要素ID可以来源于不同的数据，这是因为不同的要素ID需要用不同的数据来标识，这些数据可以是：</p><ol><li>属性(Attribute)：属性是与每个几何体（比如点、线或多边形）相关联的标量或向量值。例如，一个三角形的颜色可能是一个属性值，而且每个三角形的颜色可能不同。</li><li>纹理(Texture)：纹理是一个图像，可以应用到几何体表面上，从而赋予其颜色、图案或其他特征。如果在纹理图像中标记每个几何体或几何体的部分，这些标记就可以用作要素ID。</li><li>varying：varying在顶点着色器和片元着色器之间传递数据，可以用来传递每个顶点的颜色或法向量等信息。可以利用varying来传递要素ID值到片元着色器中进行处理。 因此，要素ID可以来自多种数据，可以根据实际需要选择使用哪种方式来标识要素ID。</li></ol></blockquote><p>Feature ID 表示为 GLSL <code>int</code>，但在 WebGL 1 中这有几个限制：</p><ul><li>以上<code>2^24</code>, values 可能会丢失精度，因为 WebGL 1 实现 <code>highp int</code>为浮点值。</li><li>理想情况下，类型应该是<code>uint</code>，但直到 WebGL 2 才可用</li></ul><h3 id="_3d-tiles-1-0-batch-id" tabindex="-1">3D Tiles 1.0 Batch ID <a class="header-anchor" href="#_3d-tiles-1-0-batch-id" aria-label="Permalink to &quot;3D Tiles 1.0 Batch ID&quot;">​</a></h3><p>在 3D Tiles 1.0 中，在图元中识别Feature的相同概念被称为<code>BATCH_ID</code>或 legacy <code>_BATCHID</code>。这些Batch ID 被重命名为单个Feature ID，索引始终为 0：</p><ul><li><code>vsInput.featureIds.featureId_0</code>（顶点着色器）</li><li><code>fsInput.featureIds.featureId_0</code>（片段着色器）</li></ul><h3 id="ext-mesh-features-ext-instance-features-feature-ids" tabindex="-1"><code>EXT_mesh_features</code>/<code>EXT_instance_features</code> Feature IDs <a class="header-anchor" href="#ext-mesh-features-ext-instance-features-feature-ids" aria-label="Permalink to &quot;\`EXT_mesh_features\`/\`EXT_instance_features\` Feature IDs&quot;">​</a></h3><p>当使用glTF 扩展<code>EXT_mesh_features</code>或时，Feature ID 出现在两个地方：<code>EXT_instance_features</code></p><ol><li>任何 glTF 基元都可以有一个<code>featureIds</code>数组。该<code>featureIds</code>数组可能包含Feature ID 属性、隐式Feature ID 属性和/或Feature ID 纹理。无论Feature ID 的类型如何，它们都会出现在CustomShader中，因为数组中Feature ID 的索引在<code>(vsInput|fsInput).featureIds.featureId_N</code>哪里。<code>NfeatureIds</code></li><li><code>EXT_mesh_gpu_instancing</code>任何带有和 的glTF 节点都<code>EXT_instance_features</code>可以定义Feature ID。这些可能是Feature ID 属性或隐式Feature ID 属性，但不是Feature ID 纹理。这些将出现在CustomShader中，因为数组中Feature ID 的索引在<code>(vsInput|fsInput).featureIds.instanceFeatureId_N</code>哪里。<code>NfeatureIds</code></li></ol><p>此外，Feature ID 纹理仅在片段着色器中受支持。</p><p>如果一组要素 ID 包含一个<code>label</code>属性（ 中的新增内容<code>EXT_mesh_features</code>），则该标签将作为别名使用。例如，如果<code>label: &quot;alias&quot;</code>，则将 <code>(vsInput|fsInput).featureIds.alias</code>与 一起在着色器中可用<code>featureId_N</code>。</p><p>例如，假设我们有一个具有以下Feature ID 的 glTF primitive：</p><div class="language-c"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">nodes</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">mesh</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">extensions</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">EXT_mesh_gpu_instancing</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">attributes</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">TRANSLATION</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">_FEATURE_ID_0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">4</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">EXT_instance_features</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">featureIds</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">//默认Feature ID（实例 ID）</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">//</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">//顶点着色器：vsInput.featureIds.instanceFeatureId_0 或 vsInput.featureIds.perInstance</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">//片段着色器：fsInput.featureIds.instanceFeatureId_0 或 fsInput.featureIds.perInstance</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">label</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">perInstance</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">propertyTable</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">//Feature ID 属性。这对应于上面实例化扩展中的 _FEATURE_ID_0。请注意，这被标记为 instanceFeatureId_1，因为它是 featureIds 数组中设置的第二个Feature ID</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">//</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">//顶点着色器：vsInput.featureIds.instanceFeatureId_1</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">//片段着色器：fsInput.featureIds.instanceFeatureId_1</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">//</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">//由于没有标签字段，因此必须使用 instanceFeatureId_1。</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">propertyTable</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">attribute</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">meshes</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">primitives</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">attributes</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">POSITION</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">_FEATURE_ID_0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">_FEATURE_ID_1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">2</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">extensions</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">EXT_mesh_features</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">featureIds</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//Feature ID 纹理</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//顶点着色器：（不支持）</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//片段着色器：fsInput.featureIds.featureId_0 或 fsInput.featureIds.texture</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">label</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">texture</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">propertyTable</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">index</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">texCoord</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">channel</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//默认要素 ID（顶点 ID）</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//顶点着色器：vsInput.featureIds.featureId_1 或 vsInput.featureIds.perVertex</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//片段着色器：fsInput.featureIds.featureId_1 或 fsInput.featureIds.perVertex</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">label</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">perVertex</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">propertyTable</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//Feature ID 属性 (_FEATURE_ID_0)。请注意，它在 featureIds 数组中的索引被标记为 featureId_2</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//顶点着色器：vsInput.featureIds.featureId_2</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//片段着色器：fsInput.featureIds.featureId_2</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//由于没有标签，因此必须使用 featureId_2。</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">propertyTable</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">attribute</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//Feature ID 属性 (_FEATURE_ID_1)。请注意，它在 featureIds 数组中的索引被标记为 featureId_3</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//顶点着色器：vsInput.featureIds.featureId_3</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//片段着色器：fsInput.featureIds.featureId_3</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">propertyTable</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">attribute</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">]</span></span></code></pre></div><h3 id="旧ext-feature-metadata-feature-ids" tabindex="-1">旧<code>EXT_feature_metadata</code> Feature IDs <a class="header-anchor" href="#旧ext-feature-metadata-feature-ids" aria-label="Permalink to &quot;旧\`EXT_feature_metadata\` Feature IDs&quot;">​</a></h3><p><code>EXT_feature_metadata</code>是 . 的早期草稿<code>EXT_mesh_features</code>。尽管要素 ID 概念没有太大变化，但 JSON 结构略有不同。在较旧的扩展中，分别<code>featureIdAttributes</code>存储<code>featureIdTextures</code> 。在这个 CesiumJS 实现中，Feature属性和Feature纹理被连接到一个列表中，本质上是 <code>featureIds = featureIdAttributes.concat(featureIdTextures)</code>. 除了扩展 JSON 中的这种差异外，Feature ID 集的标记方式与 相同<code>EXT_mesh_features</code>，即</p><ul><li><code>(vsInput|fsInput).featureIds.featureId_N</code>对应于来自每个基元的<code>N</code>组合数组中的第 - 个Feature ID 集。<code>featureIds</code></li><li><code>(vsInput|fsInput).featureIds.instanceFeatureId_N</code>对应于来自具有扩展名的节点的数组 <code>N</code>中的第 - 个Feature ID 集。<code>featureIdsEXT_mesh_gpu_instancing</code></li></ul><p>为了进行比较，这里是与上一节中相同的示例，已翻译为<code>EXT_feature_metadata</code>扩展名：</p><div class="language-c"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">nodes</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">mesh</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">extensions</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">EXT_mesh_gpu_instancing</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">attributes</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">TRANSLATION</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">_FEATURE_ID_0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">4</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">extensions</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">EXT_feature_metadata</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">featureIdAttributes</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//来自隐式范围的要素 ID 属性</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//顶点着色器：vsInput.featureIds.instanceFeatureId_0</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//片段着色器：fsInput.featureIds.instanceFeatureId_0</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">featureTable</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">perInstanceTable</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">featureIds</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">constant</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">divisor</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//Feature ID 属性。这对应于上面实例化扩展中的 _FEATURE_ID_0。请注意，这被标记为 instanceFeatureId_1，因为它是 featureIds 数组中设置的第二个Feature ID</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//顶点着色器：vsInput.featureIds.instanceFeatureId_1</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//片段着色器：fsInput.featureIds.instanceFeatureId_1</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">featureTable</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">perInstanceGroupTable</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">featureIds</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">attribute</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">_FEATURE_ID_0</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">meshes</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">primitives</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">attributes</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">POSITION</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">_FEATURE_ID_0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">_FEATURE_ID_1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">2</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">extensions</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">EXT_feature_metadata</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">featureIdAttributes</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//隐式Feature ID 属性</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//顶点着色器：vsInput.featureIds.featureId_0</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//片段着色器：fsInput.featureIds.featureId_0</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">featureTable</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">perFaceTable</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">featureIds</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">constant</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">divisor</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">3</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//Feature ID 属性 (_FEATURE_ID_0)。请注意，它在 featureIds 数组中的索引被标记为 featureId_1</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//顶点着色器：vsInput.featureIds.featureId_1</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//片段着色器：fsInput.featureIds.featureId_1</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">featureTable</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">perFeatureTable</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">featureIds</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">attribute</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">_FEATURE_ID_0</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//Feature ID 属性 (_FEATURE_ID_1)。请注意，它在 featureIds 数组中的索引被标记为 featureId_2</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//顶点着色器：vsInput.featureIds.featureId_2</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//片段着色器：fsInput.featureIds.featureId_2</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">featureTable</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">otherFeatureTable</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">featureIds</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">attribute</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">_FEATURE_ID_1</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">featureIdTextures</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//Feature ID 纹理。请注意，这被标记为 featureId_3，因为Feature ID 纹理列表连接到Feature ID 属性列表</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//顶点着色器：（不支持）</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//片段着色器：fsInput.featureIds.featureId_3</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">featureTable</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">perTexelTable</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">featureIds</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">texture</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">texCoord</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">index</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">channels</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">r</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">]</span></span></code></pre></div><h2 id="metadata结构" tabindex="-1"><code>Metadata</code>结构 <a class="header-anchor" href="#metadata结构" aria-label="Permalink to &quot;\`Metadata\`结构&quot;">​</a></h2><p>此结构包含模型可从 <a href="https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_structural_metadata" target="_blank" rel="noreferrer">EXT_structural_metadata</a> glTF 扩展（或较旧的 <a href="https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_feature_metadata" target="_blank" rel="noreferrer">EXT_feature_metadata</a>扩展）访问的相关元数据属性。</p><p>目前支持以下类型的元数据：</p><ul><li>glTF 扩展中的属性<code>EXT_structural_metadata</code>。</li><li>来自 glTF 扩展的属性纹理<code>EXT_structural_metadata</code>。当前仅<code>componentType: UINT8</code>支持带有的类型。</li></ul><p>无论元数据的来源如何，属性都按属性 ID 收集到一个结构中。考虑以下元数据类：</p><div class="language-c"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">schema</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">classes</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">wall</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">properties</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">temperature</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Surface Temperature</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">SCALAR</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">componentType</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">FLOAT32</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>这将在着色器中显示为结构字段，如下所示：</p><div class="language-c"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> Metadata </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">float</span><span style="color:#F07178;"> temperature</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p><code>vsInput.metadata.temperature</code>现在可以通过或 访问温度<code>fsInput.metadata.temperature</code>。</p><h3 id="normalized归一化值" tabindex="-1">Normalized归一化值 <a class="header-anchor" href="#normalized归一化值" aria-label="Permalink to &quot;Normalized归一化值&quot;">​</a></h3><p>如果类属性指定<code>normalized: true</code>，该属性将作为适当的浮点类型（例如<code>float</code>或<code>vec3</code>）出现在着色器中。<code>[0, 1]</code>所有组件都将在（无符号）或（有符号）的范围内<code>[-1, 1]</code> 。</p><p>例如，</p><div class="language-c"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">schema</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">classes</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">wall</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">properties</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//尽管存储为 UINT8，但伤害在 0.0 和 1.0 之间归一化</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//glTF</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">damageAmount</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Wall damage (normalized)</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">SCALAR</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">componentType</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">UINT32</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">normalized</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">true</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>这将显示为<code>float</code>0.0 到 1.0 之间的值，可通过 <code>(vsInput|fsInput).metadata.damageAmount</code></p><h3 id="偏移量和比例" tabindex="-1">偏移量和比例 <a class="header-anchor" href="#偏移量和比例" aria-label="Permalink to &quot;偏移量和比例&quot;">​</a></h3><p>如果属性提供了offset偏移量或scale缩放比例，它会在归一化（如果适用）后自动应用。这有助于将值预先缩放到方便的范围。</p><p>例如，考虑采用归一化温度值并自动将其转换为摄氏度或华氏度：</p><div class="language-c"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">schema</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">classes</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">wall</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">properties</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//缩放到范围 [0, 100]，单位为 °C</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">temperatureCelsius</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Temperature (°C)</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">SCALAR</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">componentType</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">UINT32</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">normalized</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">true,</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;">//offset 默认为 0，scale 默认为 1</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">scale</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#F78C6C;">100</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//缩放/移动到范围 [32, 212] °F</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">temperatureFahrenheit</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Temperature (°C)</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">SCALAR</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">componentType</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">UINT32</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">normalized</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">true,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">offset</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#F78C6C;">32</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">scale</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#F78C6C;">180</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>在着色器中，<code>(vsInput|fsInput).metadata.temperatureCelsius</code>将是一个<code>float</code> 介于 0.0 和 100.0 之间的值，而 <code>(vsInput|fsInput).metadata.temperatureFahrenheit</code>将是一个<code>float</code>范围为<code>[32.0, 212.0]</code>.</p><h3 id="property-id消毒" tabindex="-1">Property ID消毒 <a class="header-anchor" href="#property-id消毒" aria-label="Permalink to &quot;Property ID消毒&quot;">​</a></h3><blockquote><p>换句话说，就是通过一系列的处理方式将属性ID（通常是字符串）从潜在的安全威胁中清除掉，保护应用程序或系统不受攻击。这样做的目的是防止数据注入攻击，例如SQL注入或跨站脚本攻击等。</p></blockquote><p>GLSL 只支持字母数字标识符，即不以数字开头的标识符。此外，带有连续下划线 ( <code>__</code>) 的标识符，以及带有<code>gl_</code>前缀的标识符，在 GLSL 中是保留的。为了规避这些限制，Property ID 修改如下：</p><ol><li>将所有非字母数字字符序列替换为单个<code>_</code>.</li><li>删除保留<code>gl_</code>前缀（如果存在）。</li><li>如果标识符以数字 ( <code>[0-9]</code>) 开头，则前缀为<code>_</code></li></ol><p>以下是结构中CustomShader中属性 ID 和结果变量名称的几个示例<code>(vsInput|fsInput).metadata</code>：</p><ul><li><code>temperature ℃</code>-&gt;<code>metadata.temperature_</code></li><li><code>custom__property</code>-&gt;<code>metadata.custom_property</code></li><li><code>gl_customProperty</code>-&gt;<code>metadata.customProperty</code></li><li><code>12345</code>-&gt;<code>metadata._12345</code></li><li><code>gl_12345</code>-&gt;<code>metadata._12345</code></li></ul><p>如果以上结果导致空字符串或与其他属性 ID 的名称冲突，则行为未定义。例如：</p><ul><li><code>✖️✖️✖️</code>映射到空字符串，因此行为未定义。</li><li><code>temperature ℃</code>具有名称和的两个属性<code>temperature ℉</code>都将映射到<code>metadata.temperature</code>，因此行为未定义</li></ul><p>使用点云 ( <code>.pnts</code>) 格式时，每个点的属性被转码为属性属性。这些属性 ID 遵循相同的约定。</p><h2 id="metadataclass结构" tabindex="-1"><code>MetadataClass</code>结构 <a class="header-anchor" href="#metadataclass结构" aria-label="Permalink to &quot;\`MetadataClass\`结构&quot;">​</a></h2><p>此结构包含每个元数据属性的常量，如class模式中所定义。</p><p>无论元数据的来源如何，属性都按属性 ID 收集到一个结构中。考虑以下元数据类：</p><div class="language-c"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">schema</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">classes</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">wall</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">properties</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">temperature</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Surface Temperature</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">SCALAR</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">componentType</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">FLOAT32</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">noData</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">9999.0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">default</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#F78C6C;">72.0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">min</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">40.0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">max</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#F78C6C;">500.0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>这将显示在结构字段的着色器中，如下所示：</p><div class="language-c"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> floatMetadataClass </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">float</span><span style="color:#F07178;"> noData</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">float</span><span style="color:#F07178;"> defaultValue</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">//&#39;default&#39; 是 GLSL 中的保留字</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">float</span><span style="color:#F07178;"> minValue</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">//&#39;min&#39; 是 GLSL 中的保留字</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">float</span><span style="color:#F07178;"> maxValue</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">//&#39;max&#39; 是 GLSL 中的保留字</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> MetadataClass </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  floatMetadataClass temperature</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>将选择每个属性的子结构，以便各个属性（例如<code>noData</code>和<code>defaultValue</code>）与属性的实际值具有相同的类型。</p><p>现在可以在顶点着色器中按如下方式访问 noData 和默认值：</p><div class="language-c"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">float</span><span style="color:#A6ACCD;"> noData </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> vsInput.metadataClass.temperature.noData</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">//== -9999.0</span></span>
<span class="line"><span style="color:#C792EA;">float</span><span style="color:#A6ACCD;"> defaultTemp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> vsInput.metadataClass.temperature.defaultValue</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">//== 72.0</span></span>
<span class="line"><span style="color:#C792EA;">float</span><span style="color:#A6ACCD;"> minTemp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> vsInput.metadataClass.temperature.minValue</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">//== -40.0</span></span>
<span class="line"><span style="color:#C792EA;">float</span><span style="color:#A6ACCD;"> maxTemp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> vsInput.metadataClass.temperature.maxValue</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">//== 500.0</span></span></code></pre></div><p>或类似地来自<code>fsInput</code>片段着色器中的结构。</p><h2 id="metadatastatistics结构" tabindex="-1"><code>MetadataStatistics</code>结构 <a class="header-anchor" href="#metadatastatistics结构" aria-label="Permalink to &quot;\`MetadataStatistics\`结构&quot;">​</a></h2><p>如果该模型是从<a href="https://github.com/CesiumGS/3d-tiles/tree/main/specification" target="_blank" rel="noreferrer">3D Tiles tileset加载的，它可能在</a>tileset.json的statistics属性中定义了统计信息。这些信息可以从<code>CustomShader</code>的<code>MetadataStatistics</code>结构中获得。</p><h3 id="组织" tabindex="-1">组织 <a class="header-anchor" href="#组织" aria-label="Permalink to &quot;组织&quot;">​</a></h3><p>无论元数据的来源如何，属性都通过属性 ID 收集到一个源中。考虑以下元数据类：</p><div class="language-c"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">statistics</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">classes</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">exampleMetadataClass</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">count</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#F78C6C;">29338</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">properties</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">intensity</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">min</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">max</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#F78C6C;">0.6333333849906921</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">mean</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#F78C6C;">0.28973701532415364</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">median</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#F78C6C;">0.25416669249534607</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">standardDeviation</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#F78C6C;">0.18222664489583626</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">variance</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#F78C6C;">0.03320655011</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">sum</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#F78C6C;">8500.30455558002</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">classification</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">occurrences</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">MediumVegetation</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#F78C6C;">6876</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Buildings</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#F78C6C;">22462</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span></code></pre></div><p>这将显示在结构字段的着色器中，如下所示：</p><div class="language-c"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> floatMetadataStatistics </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">float</span><span style="color:#F07178;"> minValue</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">//&#39;min&#39; 是 GLSL 中的保留字</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">float</span><span style="color:#F07178;"> maxValue</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">//&#39;max&#39; 是 GLSL 中的保留字</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">float</span><span style="color:#F07178;"> mean</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">float</span><span style="color:#F07178;"> median</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">float</span><span style="color:#F07178;"> standardDeviation</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">float</span><span style="color:#F07178;"> variance</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">float</span><span style="color:#F07178;"> sum</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> MetadataStatistics </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  floatMetadataStatistics intensity</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>可以从顶点着色器中访问统计值，如下所示：</p><div class="language-c"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">float</span><span style="color:#A6ACCD;"> minValue </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> vsInput.metadataStatistics.intensity.minValue</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">float</span><span style="color:#A6ACCD;"> mean </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> vsInput.metadataStatistics.intensity.mean</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>或类似地来自<code>fsInput</code>片段着色器中的结构。</p><h3 id="类型" tabindex="-1">类型 <a class="header-anchor" href="#类型" aria-label="Permalink to &quot;类型&quot;">​</a></h3><p>对于<code>SCALAR</code>、<code>VECN</code>和<code>MATN</code>type 属性，统计结构字段<code>minValue</code>、<code>maxValue</code>、<code>median</code>和<code>sum</code>将使用与它们描述的元数据属性相同的类型声明。字段<code>mean</code>、<code>standardDeviation</code>和<code>variance</code>声明为与元数据属性具有相同维度的类型，但具有浮点组件。</p><p>对于<code>ENUM</code>类型元数据，该属性的统计结构应该包含一个<code>occurrence</code>字段，但该字段尚未实现。</p><h2 id="czm-modelvertexoutput结构" tabindex="-1"><code>czm_modelVertexOutput</code>结构 <a class="header-anchor" href="#czm-modelvertexoutput结构" aria-label="Permalink to &quot;\`czm_modelVertexOutput\`结构&quot;">​</a></h2><p>此结构是内置的，请参阅<a href="https://github.com/CesiumGS/cesium/blob/main/packages/engine/Source/Shaders/Builtin/Structs/modelVertexOutput.glsl" target="_blank" rel="noreferrer">文档注释</a>。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 表示自定义顶点着色器输出的结构。</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">property</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#89DDFF;font-style:italic;">{</span><span style="color:#FFCB6B;font-style:italic;">vec3</span><span style="color:#89DDFF;font-style:italic;">}</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#A6ACCD;font-style:italic;">positionMC</span><span style="color:#676E95;font-style:italic;"> 顶点在模型坐标中的位置</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">property</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#89DDFF;font-style:italic;">{</span><span style="color:#FFCB6B;font-style:italic;">float</span><span style="color:#89DDFF;font-style:italic;">}</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#A6ACCD;font-style:italic;">pointSize</span><span style="color:#676E95;font-style:italic;"> gl_PointSize 的自定义值。这仅用于点图元。</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#A6ACCD;">struct czm_modelVertexOutput </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">vec3</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">positionMC</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">float</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">pointSize</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span></code></pre></div><p>该结构包含自定义顶点着色器的输出。这包括：</p><ul><li><code>positionMC</code> - 模型空间坐标中的顶点位置。该结构字段可用于扰动或动画顶点。它被初始化为 <code>vsInput.attributes.positionMC</code>.  CustomShader可以修改它，结果用于计算<code>gl_Position</code>。</li><li><ul><li><code>pointSize</code> - 对应于<code>gl_PointSize</code>。这仅适用于呈现为<code>gl.POINTS</code> 的模型，否则将被忽略。这将覆盖由<code>Cesium3DTileStyle</code>应用于模型的任何点大小样式。</li></ul></li></ul><blockquote><p><strong>实施注意事项</strong>：<code>positionMC</code>不修改图元的边界球体。如果顶点移动到包围球之外，则图元可能会被无意中剔除，具体取决于视锥体。</p></blockquote><h2 id="czm-modelmaterial结构" tabindex="-1"><code>czm_modelMaterial</code>结构 <a class="header-anchor" href="#czm-modelmaterial结构" aria-label="Permalink to &quot;\`czm_modelMaterial\`结构&quot;">​</a></h2><p>此结构是内置的，请参阅<a href="https://github.com/CesiumGS/cesium/blob/main/packages/engine/Source/Shaders/Builtin/Structs/modelMaterial.glsl" target="_blank" rel="noreferrer">文档注释</a>。这与旧的 Fabric 系统类似，但由于支持 PBR 照明，因此字段略有不同。<code>czm_material</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 这是一个用于表示</span><span style="color:#89DDFF;font-style:italic;">{@</span><span style="color:#C792EA;font-style:italic;">link</span><span style="color:#FFCB6B;font-style:italic;"> </span><span style="color:#A6ACCD;font-style:italic;">Model</span><span style="color:#89DDFF;font-style:italic;">}</span><span style="color:#676E95;font-style:italic;">材质的结构体。模型渲染管道将在材质、自定义着色器和光照阶段之间传递此结构体。</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 这不应与</span><span style="color:#89DDFF;font-style:italic;">{@</span><span style="color:#C792EA;font-style:italic;">link</span><span style="color:#FFCB6B;font-style:italic;"> </span><span style="color:#A6ACCD;font-style:italic;">czm_material</span><span style="color:#89DDFF;font-style:italic;">}</span><span style="color:#676E95;font-style:italic;">混淆，后者是旧版Fabric材料系统使用的，尽管它们非常相似。</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * &lt;p&gt;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 所有颜色值（漫反射、镜面反射、发射）都在线性颜色空间中。</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * &lt;/p&gt;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">property</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#89DDFF;font-style:italic;">{</span><span style="color:#FFCB6B;font-style:italic;">vec3</span><span style="color:#89DDFF;font-style:italic;">}</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#A6ACCD;font-style:italic;">diffuse</span><span style="color:#676E95;font-style:italic;"> 入射光向各个方向均匀散射。</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">property</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#89DDFF;font-style:italic;">{</span><span style="color:#FFCB6B;font-style:italic;">float</span><span style="color:#89DDFF;font-style:italic;">}</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#A6ACCD;font-style:italic;">alpha</span><span style="color:#676E95;font-style:italic;"> 此材质的 Alpha。0.0 是完全透明的；1.0 是完全不透明的。</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">property</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#89DDFF;font-style:italic;">{</span><span style="color:#FFCB6B;font-style:italic;">vec3</span><span style="color:#89DDFF;font-style:italic;">}</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#A6ACCD;font-style:italic;">specular</span><span style="color:#676E95;font-style:italic;"> PBR 材质中法向入射反射光的镜面反射颜色。这有时在文献中称为 f0。</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">property</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#89DDFF;font-style:italic;">{</span><span style="color:#FFCB6B;font-style:italic;">float</span><span style="color:#89DDFF;font-style:italic;">}</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#A6ACCD;font-style:italic;">roughness</span><span style="color:#676E95;font-style:italic;"> 一个从 0.0 到 1.0 的数字，表示表面的粗糙程度。接近 0.0 的值会产生光滑的表面，接近 1.0反之</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">property</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#89DDFF;font-style:italic;">{</span><span style="color:#FFCB6B;font-style:italic;">vec3</span><span style="color:#89DDFF;font-style:italic;">}</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#A6ACCD;font-style:italic;">normalEC</span><span style="color:#676E95;font-style:italic;"> 表面在眼睛坐标中的法线。它用于法线贴图等效果。默认值为表面未修改的法线。</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">property</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#89DDFF;font-style:italic;">{</span><span style="color:#FFCB6B;font-style:italic;">float</span><span style="color:#89DDFF;font-style:italic;">}</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#A6ACCD;font-style:italic;">occlusion</span><span style="color:#676E95;font-style:italic;"> 在材质上此时收到的环境遮挡。1.0 表示完全点亮，0.0 表示完全遮挡。</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">property</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#89DDFF;font-style:italic;">{</span><span style="color:#FFCB6B;font-style:italic;">vec3</span><span style="color:#89DDFF;font-style:italic;">}</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#A6ACCD;font-style:italic;">emissive</span><span style="color:#676E95;font-style:italic;"> 材质向各个方向均匀发射的光。默认值为 vec3(0.0)，不发光。</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#A6ACCD;">struct czm_modelMaterial </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">vec3</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">diffuse</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">float</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">alpha</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">vec3</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">specular</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">//非常谈的的颜色</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">float</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">roughness</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">vec3</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">normalEC</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">float</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">occlusion</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">vec3</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">emissive</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">//更接近设置色的谈的颜色</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span></code></pre></div><p>此结构用作片段着色器管道阶段的基本输入/输出。例如：</p><ul><li>材质阶段产生材质</li><li>照明阶段接收材质，计算照明，并将结果存储到<code>material.diffuse</code></li><li>CustomShader（无论它在管线中的哪个位置）接收一种材质（即使它是具有默认值的材质）并对其进行修改。</li></ul><h3 id="材质色彩空间" tabindex="-1">材质色彩空间 <a class="header-anchor" href="#材质色彩空间" aria-label="Permalink to &quot;材质色彩空间&quot;">​</a></h3><ol><li>材质颜色（例如<code>material.diffuse</code>）始终在线性颜色空间中，即使<code>lightingModel</code>是<code>LightingModel.UNLIT</code>。</li><li>当<code>scene.highDynamicRange</code>是 时<code>false</code>，最终计算的颜色（在CustomShader和光照之后）被转换为<code>sRGB</code>.</li></ol>`,120),t=[p];function e(c,r,y,D,F,i){return a(),n("div",null,t)}const u=s(o,[["render",e]]);export{d as __pageData,u as default};
