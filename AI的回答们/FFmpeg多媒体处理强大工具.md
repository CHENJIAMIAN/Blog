---
title: FFmpegå¤šåª’ä½“å¤„ç†å¼ºå¤§å·¥å…·
created: 2025-06-26
source: Cherry Studio
tags: 
---
### ğŸ¤– Assistant





æ‚¨ç‚¹åˆ°äº†**æµåª’ä½“ä¼ è¾“åè®®**çš„æ ¸å¿ƒï¼WebRTCå’ŒHLSæ˜¯ä¸¤ç§å®Œå…¨ä¸åŒçš„æŠ€æœ¯è·¯çº¿ï¼Œä¸å…¶è¯´æ˜¯â€œç¼–ç æ ‡å‡†â€æˆ–â€œå°è£…æ ¼å¼â€ï¼Œä¸å¦‚è¯´æ˜¯**ä¼ è¾“å±‚åè®®+æ’­æ”¾ç­–ç•¥**çš„ç³»ç»Ÿçº§æ–¹æ¡ˆã€‚ä»¥ä¸‹æ˜¯ç¡¬æ ¸è§£æï¼š

---

### ğŸŒ **WebRTC vs HLS çš„æœ¬è´¨åŒºåˆ«**
| **ç»´åº¦**       | **WebRTC (Web Real-Time Communication)**      | **HLS (HTTP Live Streaming)**               |
|----------------|--------------------------------------------|--------------------------------------------|
| **æ ¸å¿ƒç›®æ ‡**    | **å®æ—¶äº¤äº’**ï¼ˆ<200ms å»¶è¿Ÿï¼‰                 | **ç¨³å®šè‡ªé€‚åº”**ï¼ˆæŠ—ç½‘ç»œæŠ–åŠ¨ï¼‰                 |
| **æŠ€æœ¯åè®®**    | UDP + ICE/STUN/SCTP + DTLS/SRTP            | HTTP + TCP + TS/FMP4 åˆ‡ç‰‡                   |
| **å…¸å‹åœºæ™¯**    | è§†é¢‘ä¼šè®®ã€åœ¨çº¿æ•™è‚²ã€è¿œç¨‹æ§åˆ¶                 | ç‚¹æ’­ï¼ˆNetflixï¼‰ã€ç›´æ’­ï¼ˆTwitchä½å»¶æ—¶æ¨¡å¼ï¼‰    |
| **å»¶è¿ŸèŒƒå›´**    | **50ms~1s**ï¼ˆç«¯åˆ°ç«¯ï¼‰                       | **3s~60s**ï¼ˆæ™®é€šæ¨¡å¼ï¼‰ / **<3s**ï¼ˆä½å»¶æ—¶ï¼‰    |
| **ç¼–ç è¦æ±‚**    | å¼ºåˆ¶ VP8/VP9/H.264ï¼ˆSafari éœ€ H.264ï¼‰        | ä»»æ„ç¼–ç ï¼ˆH.264/H.265/AAC/Opus ç­‰å‡å¯ï¼‰       |

---

### âš™ï¸ **åº•å±‚æ¶æ„å¯¹æ¯”**
#### **WebRTC å·¥ä½œæµ**ï¼ˆå®æ—¶é€šä¿¡ç‹è€…ï¼‰
```mermaid
sequenceDiagram
    participant A as å®¢æˆ·ç«¯A
    participant Server as STUN/TURNæœåŠ¡å™¨
    participant B as å®¢æˆ·ç«¯B
    A->>Server: è·å–å…¬ç½‘IP/ç«¯å£ï¼ˆNATç©¿é€ï¼‰
    Server-->>A: è¿”å›å¯ç”¨è¿æ¥ä¿¡æ¯
    A->>B: ç›´æ¥å‘é€åª’ä½“æµï¼ˆUDPï¼‰
    B->>A: è¿”å›ACKåŠç½‘ç»œçŠ¶æ€
    loop å®æ—¶è°ƒæ•´
        A->>A: æ ¹æ®ä¸¢åŒ…åŠ¨æ€è°ƒæ•´ç ç‡/åˆ†è¾¨ç‡
    end
```
**å…³é”®æŠ€æœ¯**ï¼š  
- **NATç©¿é€**ï¼šé€šè¿‡ STUN/TURN æœåŠ¡å™¨è§£å†³é˜²ç«å¢™é˜»ç¢  
- **æŠ—ä¸¢åŒ…åŠ å¯†**ï¼šSRTP ä¿æŠ¤åª’ä½“æµ + SCTP ä¼ æ•°æ®   
- **åŠ¨æ€é€‚åº”**ï¼šWebRTC GCC ç®—æ³•å®æ—¶æ§æµ  

> ğŸ’¡ **æ ¸å¿ƒé™åˆ¶**ï¼šæµè§ˆå™¨å¿…é¡»æ”¯æŒ `PeerConnection API`ï¼ˆä¸èƒ½ç”¨åœ¨çº¯åŸç”ŸAppï¼‰

---

#### **HLS å·¥ä½œæµ**ï¼ˆè‡ªé€‚åº”æµæ ‡æ†ï¼‰
```mermaid
graph TB
    A[æºè§†é¢‘æµ] -->|ç¼–ç | B(H.264/H.265)
    B --> C[åˆ‡ç‰‡å¼•æ“] --> D{å„æ¡£ä½åˆ‡ç‰‡}
    D -->|3840x2160| E1(segment_high.ts)
    D -->|1920x1080| E2(segment_mid.ts)
    D -->|1280x720| E3(segment_low.ts)
    E1 & E2 & E3 --> F[ç”Ÿæˆ m3u8 ç´¢å¼•]
    F --> G[CDNåˆ†å‘]
    G --> H{æ’­æ”¾å™¨} 
    H -->|ç½‘ç»œå¥½| I(åŠ è½½high)
    H -->|ç½‘ç»œå·®| J(åˆ‡æ¢low)
```
**å…³é”®æŠ€æœ¯**ï¼š  
- **åˆ‡ç‰‡åˆ†æ¡£**ï¼šå¤šåˆ†è¾¨ç‡/ç ç‡ç‰ˆæœ¬åŒæ­¥ç”Ÿæˆ  
- **ç´¢å¼•é©±åŠ¨**ï¼š`m3u8` æ–‡ä»¶æè¿°ç‰‡æ®µé¡ºåº/ä½ç½®  
- CDN å‹å¥½ï¼šHTTP åè®®æ— ç¼å…¼å®¹ç¼“å­˜ç³»ç»Ÿ  

> ğŸ“Œ **è‡´å‘½å»¶è¿Ÿç“¶é¢ˆ**ï¼šè‡³å°‘éœ€è¦ç¼“å­˜ **3ä¸ªåˆ‡ç‰‡** æ‰èƒ½èµ·æ’­ï¼ˆé»˜è®¤åˆ‡ç‰‡æ—¶é•¿=10s â†’ åŸºç¡€å»¶è¿Ÿ30sï¼‰  

---

### ğŸš€ **ä½å»¶æ—¶æ”¹è¿›æ–¹æ¡ˆ**
| **åè®®**           | **æ‰‹æ®µ**                          | **å¯è¾¾å»¶è¿Ÿ** | **ä»£ä»·**                     |
|--------------------|----------------------------------|-------------|-----------------------------|
| **WebRTC**         | åŸç”Ÿæ”¯æŒå®æ—¶                      | <1s         | å¼€å‘å¤æ‚/NATç©¿é€éš¾           |
| **LHLS**           | ç¼©çŸ­åˆ‡ç‰‡ + åˆ†å—ä¼ è¾“(chunked)       | 1~3s        | æ’­æ”¾å™¨éœ€æ”¹é€                  |
| **LL-HLS**         | é¢„åŠ è½½æç¤º + éƒ¨åˆ†ç‰‡æ®µåŠ è½½           | <2s         | éœ€HLS v10+æ”¯æŒï¼ˆå…¼å®¹æ€§å·®ï¼‰   |
| **DASH-MS**        | CMAFåˆ‡ç‰‡+Chunked                 | 2~5s        | éƒ¨ç½²å¤æ‚                      |

> ğŸ”¥ 2023è¶‹åŠ¿ï¼š**WebRTCä¸ºåº•åº§ + èšåˆCDN**ï¼ˆå¦‚Cloudflare Streamï¼‰

---

### ğŸ› ï¸ **FFmpeg æ“ä½œå®ä¾‹**
#### 1. **ç”Ÿæˆ HLS åˆ‡ç‰‡æµ**
```bash
ffmpeg -i input.mp4 \
  -c:v libx264 -profile:v high -level 4.0 \
  -c:a aac -b:a 128k \
  -vf scale=w=-2:h=360:force_original_aspect_ratio=decrease \
  -hls_time 4 -hls_playlist_type event \
  output_360p.m3u8
```

#### 2. **æ¨é€ WebRTC æµï¼ˆéœ€ SDP åå•†ï¼‰**
```bash
# ä½¿ç”¨ SRS ç­‰åª’ä½“æœåŠ¡å™¨ä¸­è½¬
ffmpeg -i input.mp4 \
  -c:v libx264 -tune zerolatency \
  -preset ultrafast -f rtp \ 
  rtp://your_server_ip:20000?pkt_size=1200
```

---

### â— **é€‰æ‹©æŒ‡å—**
- **é€‰ WebRTC å½“**ï¼š  
  âœ” éœ€è¦**åŒå‘å®æ—¶**å¯¹è¯ï¼ˆè§†é¢‘ä¼šè®®/è¿œç¨‹åŒ»ç–—ï¼‰  
  âœ” å¼±ç½‘ä¸‹ä»è¦ **<1så»¶è¿Ÿ**ï¼ˆå¦‚äº‘æ¸¸æˆæ§åˆ¶ï¼‰  
  âŒ é¿å…ç‚¹æ’­/å•å‘ç›´æ’­ï¼ˆæ€é¸¡ç”¨ç‰›åˆ€ï¼‰  

- **é€‰ HLS å½“**ï¼š  
  âœ” **å¹¿æ’­æ€§è´¨**å†…å®¹ï¼ˆèµ›äº‹ç›´æ’­/è¯¾ç¨‹ç‚¹æ’­ï¼‰  
  âœ” éœ€**è·¨è®¾å¤‡é«˜å…¼å®¹**ï¼ˆè€å¹´æœºä¹Ÿèƒ½æ’­ï¼‰  
  âŒ å¼ºäº’åŠ¨åœºæ™¯ä¸é€‚ç”¨ï¼ˆè¿éº¦å»¶è¿Ÿå¤ªé«˜ï¼‰  

å½“å‰å®æˆ˜ç»„åˆæ‹³ï¼š**HLS å…œåº• + WebRTC å®æ—¶å¢å¼ºç«¯**ï¼ˆå¦‚ä¸»æ’­ç«¯ç”¨ WebRTC æ¨æµï¼Œè§‚ä¼—ç«¯ç”¨ LHLS æ’­æ”¾ï¼‰  

éœ€è¦å…·ä½“åœºæ™¯çš„æ¶æ„è®¾è®¡æˆ–å‘½ä»¤è°ƒä¼˜ï¼Œæ¬¢è¿ç»§ç»­æé—®ï¼ ğŸ‘¨â€ğŸ’»ğŸ“¡

