---

title: ç›‘æ§è§†é¢‘æµæ–¹æ¡ˆ
created: 2025-06-12
source: Cherry Studio
tags: 
---
### ğŸ¤– Assistant




ä»¥ä¸‹æ˜¯ä½¿ç”¨ **mediamtx** æ—¶å‰ç«¯çš„å®Œæ•´å®ç°æ–¹æ¡ˆï¼ˆæ ¹æ®å»¶è¿Ÿè¦æ±‚/è®¾å¤‡å…¼å®¹æ€§é€‰æ‹©ä¸åŒæŠ€æœ¯ï¼‰ï¼Œæä¾›å¯ç›´æ¥è½åœ°çš„ä»£ç ï¼š

---

### ğŸŒ å‰ç«¯ä¸‰å¤§æ’­æ”¾æ–¹æ¡ˆ (é™„ä»£ç æ¨¡æ¿)
#### âš¡ æ–¹æ¡ˆä¸€ï¼š**WebRTCæ’­æ”¾ (è¶…ä½å»¶è¿Ÿ 200-500ms)**
```html
<!DOCTYPE html>
<video id="webrtc-video" autoplay muted controls width="800"></video>

<script>
// æ ¸å¿ƒæ’­æ”¾å‡½æ•°
async function playVideo(streamName) {
  const pc = new RTCPeerConnection({
    iceServers: [{ urls: "stun:stun.l.google.com:19302" }] // NATç©¿é€
  });

  // è§†é¢‘æµæ¥æ”¶å¤„ç†
  pc.ontrack = (event) => {
    if (event.track.kind === 'video') {
      document.getElementById('webrtc-video').srcObject = event.streams[0];
    }
  };

  // åˆ›å»ºOfferå¹¶å‘é€ç»™mediamtx
  const offer = await pc.createOffer();
  await pc.setLocalDescription(offer);
  
  const response = await fetch(
    `http://ä½ çš„æœåŠ¡å™¨IP:8889/${streamName}/whep`, // æ³¨æ„æ›¿æ¢IP
    {
      method: 'POST',
      headers: { 'Content-Type': 'application/sdp' },
      body: offer.sdp
    }
  );
  
  // è®¾ç½®è¿œç«¯SDP
  const answer = await response.json();
  await pc.setRemoteDescription(answer);
}

// å¯åŠ¨æ’­æ”¾ (ä¼ å…¥mediamtxä¸­é…ç½®çš„æµåç§°)
playVideo('front_door').catch(console.error);
</script>
```

#### ğŸ“¡ æ–¹æ¡ˆäºŒï¼š**HTTP-FLVæ’­æ”¾ (å»¶è¿Ÿ1-3s)**
```html
<script src="https://cdn.jsdelivr.net/npm/flv.js@1.6.2/dist/flv.min.js"></script>

<video id="flv-video" controls width="800"></video>

<script>
const streamName = 'front_door'; // å¯¹åº”mediamtxé…ç½®çš„è·¯å¾„å

// åˆå§‹åŒ–FLVæ’­æ”¾å™¨
if (flvjs.isSupported()) {
  const videoElement = document.getElementById('flv-video');
  const flvPlayer = flvjs.createPlayer({
    type: 'flv',
    url: `http://ä½ çš„æœåŠ¡å™¨IP:8888/${streamName}`, // HTTP-FLVåœ°å€
  });
  flvPlayer.attachMediaElement(videoElement);
  flvPlayer.load();
  flvPlayer.play(); // è‡ªåŠ¨æ’­æ”¾éœ€é¡µé¢å…ˆäº¤äº’
} else {
  alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒFLVæ’­æ”¾');
}
</script>
```

#### ğŸ“¼ æ–¹æ¡ˆä¸‰ï¼š**HLSæ’­æ”¾ (å»¶è¿Ÿçº¦10sï¼Œå…¼å®¹iOSæœ€ä½³)**
```html
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.10/dist/hls.min.js"></script>

<video id="hls-video" controls width="800"></video>

<script>
const streamName = 'front_door';
const video = document.getElementById('hls-video');

if (Hls.isSupported()) {
  const hls = new Hls();
  hls.loadSource(`http://ä½ çš„æœåŠ¡å™¨IP:8888/${streamName}/hls.m3u8`);
  hls.attachMedia(video);
  hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
} else if (video.canPlayType('application/vnd.apple.mpegurl')) {
  // iOSåŸç”Ÿæ”¯æŒ
  video.src = `http://ä½ çš„æœåŠ¡å™¨IP:8888/${streamName}/hls.m3u8`;
}
</script>
```

---

### ğŸ”§ å…³é”®é…ç½®è¯´æ˜ (mediamtxç«¯)
åœ¨ `mediamtx.yml` ä¸­ç¡®ä¿å¼€å¯ä»¥ä¸‹æœåŠ¡ï¼š
```yaml
httpEnabled: true       # å¯ç”¨HTTPæœåŠ¡ (ç”¨äºHLS/FLV)
httpPort: 8888          # å‰ç«¯è®¿é—®ç«¯å£

webrtcEnabled: true     # å¯ç”¨WebRTC
webrtcAllowOrigin: "*"  # å…è®¸è·¨åŸŸ

paths:
  front_door:           # ä¸å‰ç«¯streamNameå¯¹åº”
    source: rtsp://admin:123456@192.168.1.101 # å®é™…æ‘„åƒå¤´åœ°å€
    sourceProtocol: tcp
```

---

### ğŸ› ï¸ è°ƒè¯•æŠ€å·§ (å‰ç«¯å¼€å‘è€…å¿…çœ‹)
1. **è·å–æ’­æ”¾URL**ï¼š
   - WebRTC: `http://æœåŠ¡å™¨IP:8889/<æµå>/whep` (POST)
   - FLV: `http://æœåŠ¡å™¨IP:8888/<æµå>`
   - HLS: `http://æœåŠ¡å™¨IP:8888/<æµå>/hls.m3u8`

2. **è·¨åŸŸå¤„ç†**ï¼š
   ```yaml
   # mediamtx.yml æ·»åŠ 
   httpAllowOrigin: "*"
   ```

3. **HTTPSå¼ºåˆ¶ç¯å¢ƒ** (å¦‚Safari)ï¼š
   ```html
   <!-- æœ¬åœ°æµ‹è¯•å¯ç”¨nginxåä»£ -->
   <script>
     if (window.location.protocol === 'https:') {
       mediamtxUrl = mediamtxUrl.replace('http:', 'https:'); // è‡ªåŠ¨åè®®åˆ‡æ¢
     }
   </script>
   ```

---

### ğŸ“± å¤šè®¾å¤‡å…¼å®¹æ–¹æ¡ˆ
| è®¾å¤‡ç±»å‹        | æ¨èåè®®     | æ ¸å¿ƒä»£ç                           |
|----------------|-------------|----------------------------------|
| PCæµè§ˆå™¨       | WebRTC      | `new RTCPeerConnection()`        |
| å®‰å“/Chrome    | HTTP-FLV    | `flvjs.createPlayer()`           |
| iOS/Safari     | HLS         | `video.src = '*.m3u8'`           |
| å¾®ä¿¡å†…ç½®æµè§ˆå™¨  | ä¼˜å…ˆHLS     | æ£€æµ‹UAä½¿ç”¨ä¸åŒåŠ è½½é€»è¾‘           |

å®æ—¶è®¾å¤‡æ£€æµ‹ä»£ç ç¤ºä¾‹ï¼š
```javascript
function initPlayer() {
  const ua = navigator.userAgent;
  const isIOS = /iPhone|iPad|iPod/i.test(ua);
  
  if (isIOS) {
    initHLSPlayer(); // è°ƒç”¨HLSæ–¹æ¡ˆ
  } else if (typeof RTCPeerConnection !== 'undefined') {
    initWebRTC();    // WebRTCæ–¹æ¡ˆ
  } else {
    initFLVPlayer(); // é™çº§åˆ°FLV
  }
}
```

> âš ï¸ **ç”Ÿäº§ç¯å¢ƒå¿…åš**ï¼š  
> 1. WebRTCéœ€HTTPSç¯å¢ƒï¼Œå¯ç”¨Let's Encryptå…è´¹è¯ä¹¦  
> 2. å¤§å¹¶å‘åœºæ™¯ç”¨Nginxåšmediamtxè´Ÿè½½å‡è¡¡  
> 3. æ‘„åƒå¤´éªŒè¯å¤±è´¥æ—¶æ·»åŠ  `sourceOnDemand: yes` é…ç½®  

å®Œæ•´å‰ç«¯ç¤ºä¾‹é¡¹ç›®: [mediamtx-web-demo](https://github.com/mediamtx/web-demo)

